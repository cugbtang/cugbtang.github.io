<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>LLM on âœŒyesplease's blog</title><link>http://localhost:1313/tags/llm/</link><description>Recent content in LLM on âœŒyesplease's blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><managingEditor>cugbtang@sina.com (yesplease)</managingEditor><webMaster>cugbtang@sina.com (yesplease)</webMaster><lastBuildDate>Tue, 23 Dec 2025 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/tags/llm/index.xml" rel="self" type="application/rss+xml"/><item><title>ä»é¢„è®­ç»ƒåˆ°è’¸é¦ï¼šæ·±å…¥è§£æå¤§è¯­è¨€æ¨¡å‹è®­ç»ƒå…¨æµç¨‹</title><link>http://localhost:1313/post/llm/llm-4.1/</link><pubDate>Tue, 23 Dec 2025 00:00:00 +0000</pubDate><author>cugbtang@sina.com (yesplease)</author><guid>http://localhost:1313/post/llm/llm-4.1/</guid><description>&lt;h1 id="ä»é¢„è®­ç»ƒåˆ°è’¸é¦æ·±å…¥è§£æå¤§è¯­è¨€æ¨¡å‹è®­ç»ƒå…¨æµç¨‹"&gt;ä»é¢„è®­ç»ƒåˆ°è’¸é¦ï¼šæ·±å…¥è§£æå¤§è¯­è¨€æ¨¡å‹è®­ç»ƒå…¨æµç¨‹&lt;/h1&gt;
&lt;p&gt;ä¸€æ•´å¥—å¤§æ¨¡å‹ï¼ˆå¦‚å¤§è¯­è¨€æ¨¡å‹ï¼‰ä»é›¶å¼€å§‹åˆ°æœ€ç»ˆéƒ¨ç½²ä¼˜åŒ–çš„å®Œæ•´è®­ç»ƒæµç¨‹ï¼ŒåŒ…å«äº†å¤šä¸ªå…³é”®é˜¶æ®µå’Œæ–¹æ³•ã€‚ä¸‹é¢æˆ‘å°†é€ä¸€è§£é‡Šæ¯ä¸ªä¸“ä¸šç¼©å†™ï¼Œå¹¶ç”¨&lt;strong&gt;ç®€å•ã€å½¢è±¡çš„æ¯”å–»&lt;/strong&gt;å¸®åŠ©ç†è§£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="-1-pretrainé¢„è®­ç»ƒ"&gt;ğŸŒ± 1. &lt;strong&gt;Pretrainï¼ˆé¢„è®­ç»ƒï¼‰&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸“ä¸šè§£é‡Š&lt;/strong&gt;ï¼š&lt;br&gt;
æ¨¡å‹åœ¨å¤§é‡æ— æ ‡æ³¨æ–‡æœ¬ä¸Šè¿›è¡Œè‡ªç›‘ç£å­¦ä¹ ï¼ˆæ¯”å¦‚é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼‰ï¼ŒæŒæ¡è¯­è¨€çš„åŸºæœ¬ç»“æ„ã€å¸¸è¯†å’ŒçŸ¥è¯†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¯”å–»&lt;/strong&gt;ï¼š&lt;br&gt;
å°±åƒä¸€ä¸ªå­©å­ä»å°å¤§é‡é˜…è¯»ç™¾ç§‘å…¨ä¹¦ã€å°è¯´ã€æ–°é—»â€¦â€¦è™½ç„¶æ²¡äººæ•™ä»–â€œè¿™æ˜¯å¯¹æ˜¯é”™â€ï¼Œä½†ä»–æ…¢æ…¢å­¦ä¼šäº†â€œè¯­è¨€æ€ä¹ˆç”¨â€â€œä¸–ç•Œå¤§æ¦‚ä»€ä¹ˆæ ·â€ã€‚è¿™æ˜¯æ‰“åŸºç¡€çš„é˜¶æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-2-sftsupervised-fine-tuningç›‘ç£å¾®è°ƒ"&gt;ğŸ‘©â€ğŸ« 2. &lt;strong&gt;SFTï¼ˆSupervised Fine-Tuningï¼Œç›‘ç£å¾®è°ƒï¼‰&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸“ä¸šè§£é‡Š&lt;/strong&gt;ï¼š&lt;br&gt;
åœ¨é¢„è®­ç»ƒæ¨¡å‹åŸºç¡€ä¸Šï¼Œç”¨å°‘é‡é«˜è´¨é‡çš„äººå·¥æ ‡æ³¨æ•°æ®ï¼ˆå¦‚é—®ç­”å¯¹ã€æŒ‡ä»¤-å›ç­”å¯¹ï¼‰è¿›è¡Œå¾®è°ƒï¼Œè®©æ¨¡å‹å­¦ä¼šâ€œæŒ‰äººç±»è¦æ±‚åšäº‹â€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¯”å–»&lt;/strong&gt;ï¼š&lt;br&gt;
å­©å­ä¸Šäº†å°å­¦ï¼Œè€å¸ˆç»™ä»–ç¤ºèŒƒï¼šâ€œåˆ«äººé—®â€˜ä½ å¥½å—ï¼Ÿâ€™ï¼Œä½ åº”è¯¥ç­”â€˜æˆ‘å¾ˆå¥½ï¼Œè°¢è°¢ï¼â€™è€Œä¸æ˜¯èƒŒå”è¯—ã€‚â€â€”â€”è¿™æ˜¯æ•™ä»–â€œå¬è¯â€å’Œâ€œæœ‰ç¤¼è²Œâ€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-3-loralow-rank-adaptationä½ç§©é€‚é…"&gt;ğŸ”§ 3. &lt;strong&gt;LoRAï¼ˆLow-Rank Adaptationï¼Œä½ç§©é€‚é…ï¼‰&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸“ä¸šè§£é‡Š&lt;/strong&gt;ï¼š&lt;br&gt;
ä¸€ç§é«˜æ•ˆå¾®è°ƒæŠ€æœ¯ï¼šä¸ä¿®æ”¹åŸæ¨¡å‹çš„å¤§å‚æ•°ï¼Œè€Œæ˜¯åœ¨æ—è¾¹åŠ ä¸€ä¸ªå°çš„â€œæ’ä»¶â€ï¼ˆä½ç§©çŸ©é˜µï¼‰ï¼Œåªè®­ç»ƒè¿™ä¸ªå°æ’ä»¶ï¼ŒèŠ‚çœè®¡ç®—èµ„æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¯”å–»&lt;/strong&gt;ï¼š&lt;br&gt;
å°±åƒç»™ä¸€å°è€å¼æ”¶éŸ³æœºåŠ ä¸€ä¸ªå¤–æ¥è“ç‰™æ¨¡å—ï¼Œä¸ç”¨æ‹†å¼€æ•´ä¸ªæœºå™¨é‡åšï¼Œå°±èƒ½è®©å®ƒæ”¯æŒæ–°åŠŸèƒ½ã€‚ä¾¿å®œã€å¿«ã€ä¸ä¼¤æœ¬ä½“ï¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-4-rlhf-dporeinforcement-learning-from-human-feedback--direct-preference-optimization"&gt;ğŸ¤– 4. &lt;strong&gt;RLHF-DPOï¼ˆReinforcement Learning from Human Feedback + Direct Preference Optimizationï¼‰&lt;/strong&gt;&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨ï¼šä¸¥æ ¼æ¥è¯´ï¼Œ&lt;strong&gt;RLHF&lt;/strong&gt; å’Œ &lt;strong&gt;DPO&lt;/strong&gt; æ˜¯ä¸¤ç§ä¸åŒè·¯çº¿ï¼Œä½†å¸¸è¢«ä¸€èµ·è®¨è®ºã€‚è¿™é‡ŒæŒ‰å¸¸è§ç†è§£æ‹†è§£ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="a-rlhfåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ "&gt;a) &lt;strong&gt;RLHFï¼ˆåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ ï¼‰&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äººç±»å¯¹æ¨¡å‹è¾“å‡ºçš„åå¥½ï¼ˆA æ¯” B å¥½ï¼‰è®­ç»ƒä¸€ä¸ªâ€œå¥–åŠ±æ¨¡å‹â€ï¼Œå†ç”¨ PPO ç­‰ç®—æ³•ä¼˜åŒ–ä¸»æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="b-dpodirect-preference-optimizationç›´æ¥åå¥½ä¼˜åŒ–"&gt;b) &lt;strong&gt;DPOï¼ˆDirect Preference Optimizationï¼Œç›´æ¥åå¥½ä¼˜åŒ–ï¼‰&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è·³è¿‡å¥–åŠ±æ¨¡å‹ï¼Œç›´æ¥ç”¨åå¥½æ•°æ®ä¼˜åŒ–ç­–ç•¥ï¼Œæ•°å­¦ä¸Šæ›´ç®€æ´é«˜æ•ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¯”å–»ï¼ˆåˆèµ·æ¥ï¼‰&lt;/strong&gt;ï¼š&lt;br&gt;
æƒ³è±¡ä½ åœ¨ç»ƒä¹ æ¼”è®²ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RLHF&lt;/strong&gt;ï¼šå…ˆè¯·ä¸€ç¾¤è§‚ä¼—æ‰“åˆ†ï¼Œè®­ç»ƒä¸€ä¸ªâ€œAIè¯„å§”â€ï¼›ç„¶åä½ æ ¹æ® AI è¯„å§”çš„æ‰“åˆ†ä¸æ–­æ”¹è¿›æ¼”è®²ï¼ˆç”¨ PPOï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DPO&lt;/strong&gt;ï¼šè§‚ä¼—ç›´æ¥è¯´â€œç‰ˆæœ¬ A æ¯” B å¥½â€ï¼Œä½ ç«‹åˆ»è°ƒæ•´è‡ªå·±ï¼Œä¸å†ä¾èµ–ä¸­é—´è¯„å§”ï¼Œå­¦å¾—æ›´å¿«æ›´ç›´æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-5-rlaifreinforcement-learning-from-ai-feedback--ppo--grpo--spo"&gt;ğŸ¤¯ 5. &lt;strong&gt;RLAIFï¼ˆReinforcement Learning from AI Feedbackï¼‰ + (PPO / GRPO / SPO)&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸“ä¸šè§£é‡Š&lt;/strong&gt;ï¼š&lt;br&gt;
å½“äººç±»åé¦ˆæˆæœ¬å¤ªé«˜æ—¶ï¼Œç”¨å¦ä¸€ä¸ªå¼ºå¤§çš„ AI æ¨¡å‹ï¼ˆå¦‚ GPT-4ï¼‰ä»£æ›¿äººç±»æ¥æä¾›åå¥½ä¿¡å·ï¼Œå†ç”¨ PPOã€GRPO æˆ– SPO ç­‰ç®—æ³•ä¼˜åŒ–ç›®æ ‡æ¨¡å‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PPO&lt;/strong&gt;ï¼šç»å…¸ç¨³é‡å‹å¼ºåŒ–å­¦ä¹ æ›´æ–°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GRPO&lt;/strong&gt;ï¼šåœ¨ä¸€ç»„å¤šä¸ªå›ç­”ä¸­æ¯”è¾ƒä¼˜åŠ£ï¼Œé€‚åˆå¤šé€‰åå¥½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SPOï¼ˆSimPOï¼‰&lt;/strong&gt;ï¼šç®€åŒ–ç‰ˆåå¥½ä¼˜åŒ–ï¼Œç›´æ¥æ‹‰å¤§â€œå¥½å›ç­”â€å’Œâ€œå·®å›ç­”â€çš„æ¦‚ç‡å·®è·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¯”å–»&lt;/strong&gt;ï¼š&lt;br&gt;
ä½ è¯·ä¸èµ·çœŸäººå¯¼å¸ˆï¼Œä½†ä½ å¯ä»¥ç”¨â€œAIå­¦éœ¸â€å½“åŠ©æ•™ã€‚å®ƒå¸®ä½ æ‰¹æ”¹ä½œä¸šã€æŒ‡å‡ºå“ªç¯‡ä½œæ–‡æ›´å¥½ã€‚ä½ æ ¹æ®å®ƒçš„æ„è§åå¤ä¿®æ”¹â€”â€”è¿™å°±æ˜¯ RLAIFã€‚&lt;br&gt;
è€Œ PPO/GRPO/SPO å°±æ˜¯ä½ é‡‡ç”¨çš„ä¸åŒâ€œå­¦ä¹ ç­–ç•¥â€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PPOï¼šæ¯æ¬¡åªæ”¹ä¸€ç‚¹ç‚¹ï¼Œæ€•æ”¹è¿‡å¤´ï¼›&lt;/li&gt;
&lt;li&gt;GRPOï¼šä¸€æ¬¡äº¤ä¸‰ç¯‡ä½œæ–‡ï¼Œè®© AI æ’åï¼Œä½ é‡ç‚¹å­¦ç¬¬ä¸€åï¼›&lt;/li&gt;
&lt;li&gt;SPOï¼šAI åªè¯´â€œè¿™ç¯‡æ¯”é‚£ç¯‡å¥½â€ï¼Œä½ å°±æ‹¼å‘½æ¨¡ä»¿å¥½çš„é‚£ç¯‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-6-æ¨¡å‹è’¸é¦model-distillation"&gt;ğŸ«– 6. &lt;strong&gt;æ¨¡å‹è’¸é¦ï¼ˆModel Distillationï¼‰&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸“ä¸šè§£é‡Š&lt;/strong&gt;ï¼š&lt;br&gt;
ç”¨ä¸€ä¸ªå¤§è€Œå¼ºçš„â€œæ•™å¸ˆæ¨¡å‹â€ç”Ÿæˆé«˜è´¨é‡è¾“å‡ºï¼Œè®©ä¸€ä¸ªå°è€Œå¿«çš„â€œå­¦ç”Ÿæ¨¡å‹â€å»æ¨¡ä»¿å®ƒï¼Œä»è€Œå‹ç¼©æ¨¡å‹ä½“ç§¯ã€æå‡æ¨ç†é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ¯”å–»&lt;/strong&gt;ï¼š&lt;br&gt;
å°±åƒä¸€ä½å¤§å¸ˆå‚…ç†¬äº†ä¸€é”…é«˜æ±¤ï¼Œå‘³é“æå…¶å¤æ‚ã€‚ä»–è®©å­¦ç”Ÿå°è¿™é”…æ±¤ï¼Œç„¶åè®©å­¦ç”Ÿè¯•ç€ç”¨æ›´å°‘çš„ææ–™ã€æ›´å¿«çš„æ—¶é—´ï¼Œè°ƒå‡ºå‡ ä¹ä¸€æ ·çš„å‘³é“ã€‚æœ€åå­¦ç”Ÿåšå‡ºçš„â€œç®€åŒ–ç‰ˆé«˜æ±¤â€è™½ç„¶æ²¡é‚£ä¹ˆæµ“ï¼Œä½†åˆå¿«åˆä¾¿å®œï¼Œè¿˜èƒ½ä¸Šå¤§ä¼—é¤æ¡Œï¼&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id="-å…¨æµç¨‹æ¯”å–»æ€»ç»“æ•…äº‹ç‰ˆ"&gt;âœ… å…¨æµç¨‹æ¯”å–»æ€»ç»“ï¼ˆæ•…äº‹ç‰ˆï¼‰ï¼š&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸€ä¸ª AI æ¨¡å‹çš„æˆé•¿ä¹‹è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Pretrain&lt;/strong&gt;ï¼šå®ƒå°æ—¶å€™åšè§ˆç¾¤ä¹¦ï¼Œæˆäº†â€œçŸ¥è¯†é€šâ€ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SFT&lt;/strong&gt;ï¼šä¸ŠåŸ¹è®­ç­ï¼Œå­¦ä¼šå¬æŒ‡ä»¤ã€è®²äººè¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LoRA&lt;/strong&gt;ï¼šä¸ºäº†é€‚åº”ä¸åŒå®¢æˆ·ï¼Œå®ƒæˆ´ä¸Šå¯æ’æ‹”çš„â€œæŠ€èƒ½è€³ç¯â€ï¼Œçµæ´»åˆ‡æ¢è§’è‰²ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RLHF/DPO&lt;/strong&gt;ï¼šæ‰¾äººç±»è€å¸ˆç‚¹è¯„ä½œä¸šï¼Œè¶Šæ”¹è¶Šæ‡‚äººå¿ƒï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RLAIFï¼ˆPPO/GRPO/SPOï¼‰&lt;/strong&gt;ï¼šäººç±»å¤ªå¿™ï¼Œå°±è¯· AI åŠ©æ•™ä»£è¯„ï¼Œç»§ç»­ç²¾è¿›ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å‹è’¸é¦&lt;/strong&gt;ï¼šæœ€åï¼Œå®ƒæŠŠè‡ªå·±çš„æ¯•ç”Ÿæ‰€å­¦æµ“ç¼©æˆä¸€æœ¬â€œé€Ÿæˆæ‰‹å†Œâ€ï¼Œæ•™å‡ºä¸€ä¸ªè½»é‡çº§å°å¾’å¼Ÿï¼Œå»æœåŠ¡åƒå®¶ä¸‡æˆ·ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;è¿™å¥—æµç¨‹ä»£è¡¨äº†å½“å‰å¤§æ¨¡å‹ï¼ˆå¦‚ Llamaã€Qwenã€ChatGLM ç­‰ï¼‰ä»è®­ç»ƒåˆ°è½åœ°çš„ä¸»æµèŒƒå¼ï¼Œå…¼é¡¾æ•ˆæœã€æ•ˆç‡ä¸å¯æ‰©å±•æ€§ã€‚&lt;/p&gt;</description></item><item><title>ä»é¢„è®­ç»ƒåˆ°è’¸é¦ï¼šæ·±å…¥è§£æå¤§è¯­è¨€æ¨¡å‹è®­ç»ƒå…¨æµç¨‹</title><link>http://localhost:1313/post/llm/llm-4/</link><pubDate>Tue, 23 Dec 2025 00:00:00 +0000</pubDate><author>cugbtang@sina.com (yesplease)</author><guid>http://localhost:1313/post/llm/llm-4/</guid><description>&lt;h1 id="ä»é¢„è®­ç»ƒåˆ°è’¸é¦æ·±å…¥è§£æå¤§è¯­è¨€æ¨¡å‹è®­ç»ƒå…¨æµç¨‹"&gt;ä»é¢„è®­ç»ƒåˆ°è’¸é¦ï¼šæ·±å…¥è§£æå¤§è¯­è¨€æ¨¡å‹è®­ç»ƒå…¨æµç¨‹&lt;/h1&gt;
&lt;p&gt;åœ¨äººå·¥æ™ºèƒ½å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge Language Models, LLMsï¼‰å·²ç»æˆä¸ºæŠ€æœ¯åˆ›æ–°çš„æ ¸å¿ƒé©±åŠ¨åŠ›ã€‚ä»GPTç³»åˆ—åˆ°Llamaï¼Œä»ChatGLMåˆ°Qwenï¼Œè¿™äº›å¼ºå¤§çš„æ¨¡å‹èƒŒåéƒ½éµå¾ªç€ä¸€å¥—ç²¾å¿ƒè®¾è®¡çš„è®­ç»ƒæµç¨‹ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªç°ä»£åŒ–å¤§è¯­è¨€æ¨¡å‹çš„å®Œæ•´æµç¨‹ï¼Œæ­ç¤ºæ¯ä¸ªé˜¶æ®µçš„æŠ€æœ¯åŸç†å’Œå®è·µä»·å€¼ã€‚&lt;/p&gt;
&lt;h2 id="ä¸€åŸºç¡€æ„å»ºpretrainé¢„è®­ç»ƒ"&gt;ä¸€ã€åŸºç¡€æ„å»ºï¼šPretrainï¼ˆé¢„è®­ç»ƒï¼‰&lt;/h2&gt;
&lt;h3 id="æŠ€æœ¯åŸç†æ·±åº¦è§£æ"&gt;æŠ€æœ¯åŸç†æ·±åº¦è§£æ&lt;/h3&gt;
&lt;p&gt;é¢„è®­ç»ƒæ˜¯å¤§è¯­è¨€æ¨¡å‹çš„&lt;strong&gt;å¥ åŸºé˜¶æ®µ&lt;/strong&gt;ï¼Œæ¨¡å‹é€šè¿‡åœ¨TBçº§åˆ«çš„æ— æ ‡æ³¨æ–‡æœ¬ä¸Šè¿›è¡Œè‡ªç›‘ç£å­¦ä¹ ï¼ŒæŒæ¡è¯­è¨€çš„ç»Ÿè®¡è§„å¾‹å’Œä¸–ç•ŒçŸ¥è¯†ã€‚è¿™ä¸€è¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯åœ¨æµ·é‡æ•°æ®ä¸­æŒ–æ˜è¯­è¨€çš„&lt;strong&gt;æ½œåœ¨ç»“æ„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ ¸å¿ƒè®­ç»ƒä»»åŠ¡"&gt;æ ¸å¿ƒè®­ç»ƒä»»åŠ¡&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå›å½’è¯­è¨€å»ºæ¨¡ï¼ˆAutoregressive LMï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°å­¦å½¢å¼&lt;/strong&gt;ï¼š$P(x_1, x_2, &amp;hellip;, x_n) = \prod_{i=1}^n P(x_i | x_{&amp;lt;i})$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£è¡¨æ¨¡å‹&lt;/strong&gt;ï¼šGPTç³»åˆ—ã€Llamaã€Qwen&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šè‡ªç„¶é€‚åˆæ–‡æœ¬ç”Ÿæˆï¼Œå› æœæ³¨æ„åŠ›æœºåˆ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ©ç è¯­è¨€å»ºæ¨¡ï¼ˆMasked LMï¼‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°å­¦å½¢å¼&lt;/strong&gt;ï¼š$P(x_{masked} | x_{observed})$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£è¡¨æ¨¡å‹&lt;/strong&gt;ï¼šBERTã€RoBERTa&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼šåŒå‘ä¸Šä¸‹æ–‡ç†è§£ï¼Œé€‚åˆåˆ†ç±»å’Œè¡¨å¾ä»»åŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆè®­ç»ƒç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;T5æ¡†æ¶&lt;/strong&gt;ï¼šå°†æ‰€æœ‰NLPä»»åŠ¡ç»Ÿä¸€ä¸ºæ–‡æœ¬åˆ°æ–‡æœ¬è½¬æ¢&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;UL2&lt;/strong&gt;ï¼šç»Ÿä¸€å¤šç§å»å™ªç›®æ ‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GLM&lt;/strong&gt;ï¼šç»“åˆè‡ªå›å½’å’Œè‡ªç¼–ç ä¼˜åŠ¿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="å…³é”®æŠ€æœ¯å‚æ•°"&gt;å…³é”®æŠ€æœ¯å‚æ•°&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®è§„æ¨¡&lt;/strong&gt;ï¼šç°ä»£å¤§æ¨¡å‹é€šå¸¸è®­ç»ƒåœ¨1-10ä¸‡äº¿tokençš„æ•°æ®é›†ä¸Š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å‹å‚æ•°&lt;/strong&gt;ï¼šä»70äº¿åˆ°7000äº¿å‚æ•°ä¸ç­‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®­ç»ƒæ—¶é•¿&lt;/strong&gt;ï¼šæ•°åƒåˆ°æ•°ä¸‡GPUå¤©ï¼ˆA100/H100çº§åˆ«ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–å™¨&lt;/strong&gt;ï¼šAdamWã€Adafactorç­‰è‡ªé€‚åº”ä¼˜åŒ–ç®—æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å®é™…åº”ç”¨ä¸æŒ‘æˆ˜"&gt;å®é™…åº”ç”¨ä¸æŒ‘æˆ˜&lt;/h3&gt;
&lt;h4 id="æ•°æ®å·¥ç¨‹å®è·µ"&gt;æ•°æ®å·¥ç¨‹å®è·µ&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ç°ä»£é¢„è®­ç»ƒæ•°æ®å¤„ç†æµç¨‹ç¤ºä¾‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;preprocess_pretraining_data&lt;/span&gt;(texts):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 1. è´¨é‡è¿‡æ»¤ï¼ˆå»é™¤ä½è´¨é‡å†…å®¹ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; texts &lt;span style="color:#f92672"&gt;=&lt;/span&gt; filter_by_quality(texts)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 2. å»é‡ï¼ˆé¿å…è®°å¿†åå·®ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; texts &lt;span style="color:#f92672"&gt;=&lt;/span&gt; deduplicate(texts)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 3. å¤šè¯­è¨€æ··åˆï¼ˆå¦‚æœæ”¯æŒå¤šè¯­è¨€ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; texts &lt;span style="color:#f92672"&gt;=&lt;/span&gt; mix_languages(texts)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 4. é¢†åŸŸå¹³è¡¡ï¼ˆç¡®ä¿çŸ¥è¯†è¦†ç›–å…¨é¢ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; texts &lt;span style="color:#f92672"&gt;=&lt;/span&gt; balance_domains(texts)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; texts&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="è®­ç»ƒä¼˜åŒ–æŠ€æœ¯"&gt;è®­ç»ƒä¼˜åŒ–æŠ€æœ¯&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆç²¾åº¦è®­ç»ƒ&lt;/strong&gt;ï¼šFP16/BF16å‡å°‘æ˜¾å­˜å ç”¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¢¯åº¦ç´¯ç§¯&lt;/strong&gt;ï¼šæ¨¡æ‹Ÿæ›´å¤§æ‰¹é‡è®­ç»ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¿€æ´»æ£€æŸ¥ç‚¹&lt;/strong&gt;ï¼šç‰ºç‰²è®¡ç®—æ—¶é—´æ¢å–æ˜¾å­˜&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ZeROä¼˜åŒ–&lt;/strong&gt;ï¼šåˆ†å¸ƒå¼è®­ç»ƒä¸­çš„å‚æ•°åˆ†ç‰‡&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="è¡Œä¸šæœ€ä½³å®è·µ"&gt;è¡Œä¸šæœ€ä½³å®è·µ&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Metaçš„Llamaç³»åˆ—&lt;/strong&gt;ï¼šå¼ºè°ƒé«˜è´¨é‡æ•°æ®ç­›é€‰å’Œè§„æ¨¡åŒ–è®­ç»ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Googleçš„PaLM&lt;/strong&gt;ï¼šæ¢ç´¢è·¯å¾„waysï¼ˆPathwaysï¼‰æ¶æ„å’ŒæŒ‡ä»¤è°ƒä¼˜&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OpenAIçš„GPTç³»åˆ—&lt;/strong&gt;ï¼šé€æ­¥æ‰©å¤§è§„æ¨¡ä¸æ”¹è¿›è®­ç»ƒç¨³å®šæ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯æ´å¯Ÿ&lt;/strong&gt;ï¼šé¢„è®­ç»ƒé˜¶æ®µä¸ä»…å†³å®šäº†æ¨¡å‹çš„&lt;strong&gt;èƒ½åŠ›ä¸Šé™&lt;/strong&gt;ï¼Œä¹Ÿå½±å“äº†åç»­å¾®è°ƒçš„&lt;strong&gt;éš¾æ˜“ç¨‹åº¦&lt;/strong&gt;ã€‚é«˜è´¨é‡ã€å¤šæ ·åŒ–çš„è®­ç»ƒæ•°æ®æ˜¯æˆåŠŸçš„å…³é”®ã€‚&lt;/p&gt;
&lt;h2 id="äºŒæŒ‡ä»¤å¯¹é½sftç›‘ç£å¾®è°ƒ"&gt;äºŒã€æŒ‡ä»¤å¯¹é½ï¼šSFTï¼ˆç›‘ç£å¾®è°ƒï¼‰&lt;/h2&gt;
&lt;h3 id="æŠ€æœ¯åŸç†æ·±åº¦è§£æ-1"&gt;æŠ€æœ¯åŸç†æ·±åº¦è§£æ&lt;/h3&gt;
&lt;p&gt;SFTï¼ˆSupervised Fine-Tuningï¼‰æ˜¯å°†é€šç”¨è¯­è¨€æ¨¡å‹è½¬åŒ–ä¸ºæœ‰ç”¨åŠ©æ‰‹çš„&lt;strong&gt;å…³é”®è½¬æ¢ç‚¹&lt;/strong&gt;ã€‚è¿™ä¸€é˜¶æ®µé€šè¿‡é«˜è´¨é‡çš„äººå·¥æ ‡æ³¨æ•°æ®ï¼Œå°†æ¨¡å‹çš„&lt;strong&gt;çŸ¥è¯†èƒ½åŠ›&lt;/strong&gt;è½¬åŒ–ä¸º&lt;strong&gt;æ‰§è¡Œèƒ½åŠ›&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ•°å­¦åŸºç¡€"&gt;æ•°å­¦åŸºç¡€&lt;/h4&gt;
&lt;p&gt;ç›‘ç£å¾®è°ƒçš„æ ¸å¿ƒæ˜¯æœ€å°åŒ–&lt;strong&gt;äº¤å‰ç†µæŸå¤±&lt;/strong&gt;ï¼š
$$
\mathcal{L}&lt;em&gt;{SFT} = -\sum&lt;/em&gt;{i=1}^N \log P(y_i | x_i, \theta)
$$
å…¶ä¸­$(x_i, y_i)$æ˜¯æŒ‡ä»¤-å›ç­”å¯¹ï¼Œ$\theta$æ˜¯æ¨¡å‹å‚æ•°ã€‚&lt;/p&gt;
&lt;h4 id="æ•°æ®å·¥ç¨‹çš„æœ€ä½³å®è·µ"&gt;æ•°æ®å·¥ç¨‹çš„æœ€ä½³å®è·µ&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡ä»¤å¤šæ ·æ€§&lt;/strong&gt;ï¼šè¦†ç›–å¤šç§ä»»åŠ¡ç±»å‹ï¼ˆé—®ç­”ã€åˆ›ä½œã€åˆ†æã€ç¼–ç¨‹ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é£æ ¼ä¸€è‡´æ€§&lt;/strong&gt;ï¼šç¡®ä¿å›ç­”é£æ ¼ç¬¦åˆç›®æ ‡åº”ç”¨åœºæ™¯&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš¾åº¦æ¢¯åº¦&lt;/strong&gt;ï¼šåŒ…å«ä»ç®€å•åˆ°å¤æ‚çš„ä»»åŠ¡åºåˆ—&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè½®å¯¹è¯&lt;/strong&gt;ï¼šè®­ç»ƒæ¨¡å‹çš„å¤šè½®äº¤äº’èƒ½åŠ›&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="é«˜è´¨é‡sftæ•°æ®ç‰¹å¾"&gt;é«˜è´¨é‡SFTæ•°æ®ç‰¹å¾&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# è¯„ä¼°SFTæ•°æ®è´¨é‡çš„ç»´åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;evaluate_sft_data_quality&lt;/span&gt;(samples):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; quality_scores &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;instruction_clarity&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# æŒ‡ä»¤æ¸…æ™°åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;answer_correctness&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# å›ç­”æ­£ç¡®æ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;completeness&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# å›ç­”å®Œæ•´æ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;style_consistency&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# é£æ ¼ä¸€è‡´æ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;task_diversity&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# ä»»åŠ¡å¤šæ ·æ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;difficulty_level&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.0&lt;/span&gt; &lt;span style="color:#75715e"&gt;# éš¾åº¦ç­‰çº§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; sample &lt;span style="color:#f92672"&gt;in&lt;/span&gt; samples:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ†ææ¯ä¸ªæ ·æœ¬çš„è´¨é‡ç»´åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; quality_scores &lt;span style="color:#f92672"&gt;=&lt;/span&gt; analyze_sample(sample, quality_scores)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; calculate_overall_quality(quality_scores)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="å®é™…åº”ç”¨æ¡ˆä¾‹"&gt;å®é™…åº”ç”¨æ¡ˆä¾‹&lt;/h3&gt;
&lt;h4 id="æ¡ˆä¾‹1ä»£ç ç”Ÿæˆèƒ½åŠ›è®­ç»ƒ"&gt;æ¡ˆä¾‹1ï¼šä»£ç ç”Ÿæˆèƒ½åŠ›è®­ç»ƒ&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;instruction&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;å®ç°ä¸€ä¸ªLRUç¼“å­˜ç®—æ³•ï¼Œè¦æ±‚æ—¶é—´å¤æ‚åº¦O(1)&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;input&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;output&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;class LRUCache:\n def __init__(self, capacity: int):\n self.capacity = capacity\n self.cache = OrderedDict()\n \n def get(self, key: int) -&amp;gt; int:\n if key not in self.cache:\n return -1\n self.cache.move_to_end(key)\n return self.cache[key]\n \n def put(self, key: int, value: int) -&amp;gt; None:\n if key in self.cache:\n self.cache.move_to_end(key)\n self.cache[key] = value\n if len(self.cache) &amp;gt; self.capacity:\n self.cache.popitem(last=False)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="æ¡ˆä¾‹2å¤šè½®å¯¹è¯è®­ç»ƒ"&gt;æ¡ˆä¾‹2ï¼šå¤šè½®å¯¹è¯è®­ç»ƒ&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;&amp;#34;conversation&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#f92672"&gt;&amp;#34;role&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;, &lt;span style="color:#f92672"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;å¸®æˆ‘åˆ¶å®šä¸€ä¸ªå­¦ä¹ Pythonçš„è®¡åˆ’&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#f92672"&gt;&amp;#34;role&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;, &lt;span style="color:#f92672"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;å½“ç„¶ï¼ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¸ºæœŸä¸€ä¸ªæœˆçš„Pythonå­¦ä¹ è®¡åˆ’...&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#f92672"&gt;&amp;#34;role&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;, &lt;span style="color:#f92672"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;ç¬¬ä¸€å‘¨å…·ä½“å­¦ä»€ä¹ˆï¼Ÿ&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; {&lt;span style="color:#f92672"&gt;&amp;#34;role&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;, &lt;span style="color:#f92672"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;: &lt;span style="color:#e6db74"&gt;&amp;#34;ç¬¬ä¸€å‘¨å»ºè®®é‡ç‚¹æŒæ¡åŸºç¡€è¯­æ³•ï¼š\n1. å˜é‡å’Œæ•°æ®ç±»å‹\n2. æ¡ä»¶è¯­å¥å’Œå¾ªç¯\n3. å‡½æ•°å®šä¹‰å’Œä½¿ç”¨\n4. åˆ—è¡¨ã€å­—å…¸ç­‰æ•°æ®ç»“æ„&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="è®­ç»ƒç­–ç•¥ä¼˜åŒ–"&gt;è®­ç»ƒç­–ç•¥ä¼˜åŒ–&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯¾ç¨‹å­¦ä¹ ï¼ˆCurriculum Learningï¼‰&lt;/strong&gt;ï¼šä»ç®€å•ä»»åŠ¡å¼€å§‹ï¼Œé€æ­¥å¢åŠ éš¾åº¦&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä»»åŠ¡å­¦ä¹ &lt;/strong&gt;ï¼šåŒæ—¶è®­ç»ƒå¤šä¸ªç›¸å…³ä»»åŠ¡ï¼Œæå‡æ³›åŒ–èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å¢å¼º&lt;/strong&gt;ï¼šé€šè¿‡æ”¹å†™ã€ç¿»è¯‘ç­‰æ–¹å¼æ‰©å……æ•°æ®é›†&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—©åœç­–ç•¥&lt;/strong&gt;ï¼šé˜²æ­¢è¿‡æ‹Ÿåˆåˆ°è®­ç»ƒæ•°æ®åˆ†å¸ƒ&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ"&gt;å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç¾éš¾æ€§é—å¿˜&lt;/strong&gt;ï¼šä½¿ç”¨LoRAæˆ–ä¿ç•™éƒ¨åˆ†é¢„è®­ç»ƒæŸå¤±&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿‡æ‹Ÿåˆ&lt;/strong&gt;ï¼šå¢åŠ æ­£åˆ™åŒ–ã€æ•°æ®å¢å¼ºã€æ—©åœ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡ä»¤è·Ÿéšåå·®&lt;/strong&gt;ï¼šå¹³è¡¡ä¸åŒæŒ‡ä»¤ç±»å‹çš„åˆ†å¸ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾“å‡ºé•¿åº¦åå·®&lt;/strong&gt;ï¼šæ§åˆ¶å›ç­”é•¿åº¦çš„å¤šæ ·æ€§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯æ´å¯Ÿ&lt;/strong&gt;ï¼šSFTä¸ä»…æ˜¯&lt;strong&gt;æŠ€æœ¯è¿‡ç¨‹&lt;/strong&gt;ï¼Œæ›´æ˜¯&lt;strong&gt;è®¾è®¡è¿‡ç¨‹&lt;/strong&gt;ã€‚ä¼˜ç§€çš„SFTæ•°æ®åº”è¯¥åƒç²¾å¿ƒè®¾è®¡çš„æ•™æï¼Œå¼•å¯¼æ¨¡å‹å­¦ä¹ äººç±»æœŸæœ›çš„è¡Œä¸ºæ¨¡å¼ã€‚æ•°æ®è´¨é‡æ¯”æ•°æ®æ•°é‡æ›´é‡è¦ï¼Œ1000ä¸ªé«˜è´¨é‡æ ·æœ¬å¯èƒ½èƒœè¿‡10000ä¸ªä½è´¨é‡æ ·æœ¬ã€‚&lt;/p&gt;
&lt;h2 id="ä¸‰é«˜æ•ˆé€‚é…loraä½ç§©é€‚é…"&gt;ä¸‰ã€é«˜æ•ˆé€‚é…ï¼šLoRAï¼ˆä½ç§©é€‚é…ï¼‰&lt;/h2&gt;
&lt;h3 id="æŠ€æœ¯çªç ´æ·±åº¦è§£æ"&gt;æŠ€æœ¯çªç ´æ·±åº¦è§£æ&lt;/h3&gt;
&lt;p&gt;LoRAï¼ˆLow-Rank Adaptationï¼‰æ˜¯è¿‘å¹´æ¥&lt;strong&gt;å‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆPEFTï¼‰&lt;/strong&gt; é¢†åŸŸæœ€é‡è¦çš„çªç ´ä¹‹ä¸€ã€‚å®ƒåŸºäºä¸€ä¸ªæ ¸å¿ƒå‡è®¾ï¼šæ¨¡å‹åœ¨é€‚åº”æ–°ä»»åŠ¡æ—¶ï¼Œæƒé‡å˜åŒ–å…·æœ‰&lt;strong&gt;ä½ç§©ç‰¹æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ•°å­¦åŸç†è¯¦è§£"&gt;æ•°å­¦åŸç†è¯¦è§£&lt;/h4&gt;
&lt;p&gt;LoRAçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æƒé‡æ›´æ–°åˆ†è§£ä¸ºä¸¤ä¸ªä½ç§©çŸ©é˜µçš„ä¹˜ç§¯ï¼š
$$
\Delta W = BA \quad \text{å…¶ä¸­} \quad B \in \mathbb{R}^{d \times r}, A \in \mathbb{R}^{r \times k}
$$
å…¶ä¸­$r \ll \min(d, k)$æ˜¯ç§©ï¼ˆé€šå¸¸ä¸º4-64ï¼‰ï¼Œè¿™ä½¿å¾—å¯è®­ç»ƒå‚æ•°æ•°é‡ä»$d \times k$å‡å°‘åˆ°$r \times (d + k)$ã€‚&lt;/p&gt;
&lt;h4 id="ç†è®ºä¼˜åŠ¿"&gt;ç†è®ºä¼˜åŠ¿&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‚æ•°æ•ˆç‡&lt;/strong&gt;ï¼šä»…éœ€å¾®è°ƒåŸæ¨¡å‹0.1%-1%çš„å‚æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜ä¼˜åŒ–&lt;/strong&gt;ï¼šè®­ç»ƒæ—¶ä»…éœ€å­˜å‚¨ä½ç§©çŸ©é˜µï¼Œæ¨ç†æ—¶å¯åˆå¹¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨¡å—åŒ–è®¾è®¡&lt;/strong&gt;ï¼šæ”¯æŒå¤šä¸ªç‹¬ç«‹é€‚é…å™¨çš„ç»„åˆä½¿ç”¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŸ¥è¯†ä¿ç•™&lt;/strong&gt;ï¼šä¿æŒåŸå§‹æƒé‡ä¸å˜ï¼Œé¿å…ç¾éš¾æ€§é—å¿˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å®é™…å®ç°ä¸ä¼˜åŒ–"&gt;å®é™…å®ç°ä¸ä¼˜åŒ–&lt;/h3&gt;
&lt;h4 id="å®Œæ•´loraå®ç°"&gt;å®Œæ•´LoRAå®ç°&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch.nn &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; nn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch.nn.functional &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; F
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;LoRALayer&lt;/span&gt;(nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;å®Œæ•´çš„LoRAå±‚å®ç°&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; original_layer: nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Module,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; rank: int &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;8&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; alpha: float &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;16.0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; dropout: float &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0.1&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; super()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;original_layer &lt;span style="color:#f92672"&gt;=&lt;/span&gt; original_layer
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;rank &lt;span style="color:#f92672"&gt;=&lt;/span&gt; rank
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;alpha &lt;span style="color:#f92672"&gt;=&lt;/span&gt; alpha
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;scaling &lt;span style="color:#f92672"&gt;=&lt;/span&gt; alpha &lt;span style="color:#f92672"&gt;/&lt;/span&gt; rank
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å†»ç»“åŸå§‹å±‚å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;original_layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;requires_grad &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è·å–åŸå§‹å±‚ç»´åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; isinstance(original_layer, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; in_features &lt;span style="color:#f92672"&gt;=&lt;/span&gt; original_layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;in_features
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; out_features &lt;span style="color:#f92672"&gt;=&lt;/span&gt; original_layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;out_features
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;elif&lt;/span&gt; isinstance(original_layer, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Conv2d):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; in_features &lt;span style="color:#f92672"&gt;=&lt;/span&gt; original_layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;in_channels
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; out_features &lt;span style="color:#f92672"&gt;=&lt;/span&gt; original_layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;out_channels
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;raise&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ValueError&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Unsupported layer type: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;type(original_layer)&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆå§‹åŒ–LoRAçŸ©é˜µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_A &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Parameter(torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;randn(in_features, rank))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_B &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Parameter(torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zeros(rank, out_features))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;dropout &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Dropout(dropout)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆå§‹åŒ–ç­–ç•¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init&lt;span style="color:#f92672"&gt;.&lt;/span&gt;kaiming_uniform_(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_A, a&lt;span style="color:#f92672"&gt;=&lt;/span&gt;math&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sqrt(&lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zeros_(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_B)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; original_output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;original_layer(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# LoRAæ›´æ–°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lora_update &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;dropout(x) &lt;span style="color:#f92672"&gt;@&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_A &lt;span style="color:#f92672"&gt;@&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_B
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lora_update &lt;span style="color:#f92672"&gt;=&lt;/span&gt; lora_update &lt;span style="color:#f92672"&gt;*&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;scaling
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; original_output &lt;span style="color:#f92672"&gt;+&lt;/span&gt; lora_update
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;merge_weights&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;å°†LoRAæƒé‡åˆå¹¶åˆ°åŸå§‹å±‚ä¸­ï¼ˆç”¨äºæ¨ç†ä¼˜åŒ–ï¼‰&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; isinstance(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;original_layer, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; delta_w &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_A &lt;span style="color:#f92672"&gt;@&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_B &lt;span style="color:#f92672"&gt;*&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;scaling
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;original_layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;weight&lt;span style="color:#f92672"&gt;.&lt;/span&gt;data &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; delta_w&lt;span style="color:#f92672"&gt;.&lt;/span&gt;T
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å…¶ä»–å±‚ç±»å‹çš„åˆå¹¶é€»è¾‘...&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="é«˜çº§ä¼˜åŒ–æŠ€å·§"&gt;é«˜çº§ä¼˜åŒ–æŠ€å·§&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç§©é€‰æ‹©ç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å°æ¨¡å‹/ç®€å•ä»»åŠ¡&lt;/strong&gt;ï¼šrank=4-8&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸­ç­‰æ¨¡å‹/ä¸­ç­‰ä»»åŠ¡&lt;/strong&gt;ï¼šrank=8-16&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§æ¨¡å‹/å¤æ‚ä»»åŠ¡&lt;/strong&gt;ï¼šrank=16-32&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›®æ ‡å±‚é€‰æ‹©&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„åŠ›å±‚&lt;/strong&gt;ï¼šQã€Kã€Vã€OæŠ•å½±çŸ©é˜µ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FFNå±‚&lt;/strong&gt;ï¼šä¸ŠæŠ•å½±å’Œä¸‹æŠ•å½±çŸ©é˜µ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨è¿æ¥å±‚&lt;/strong&gt;ï¼šåˆ†ç±»å¤´ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®­ç»ƒç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å±‚å­¦ä¹ ç‡&lt;/strong&gt;ï¼šä¸ºä¸åŒå±‚è®¾ç½®ä¸åŒçš„å­¦ä¹ ç‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¸è¿›å¼è§£å†»&lt;/strong&gt;ï¼šé€æ­¥è§£å†»æ›´å¤šå±‚è¿›è¡Œå¾®è°ƒ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€‚é…å™¨ç»„åˆ&lt;/strong&gt;ï¼šå¤šä¸ªLoRAé€‚é…å™¨çš„åŠ æƒç»„åˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ"&gt;åº”ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ&lt;/h3&gt;
&lt;h4 id="åœºæ™¯1å¤šä»»åŠ¡å¿«é€Ÿé€‚é…"&gt;åœºæ™¯1ï¼šå¤šä»»åŠ¡å¿«é€Ÿé€‚é…&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ä¸ºä¸åŒä»»åŠ¡è®­ç»ƒç‹¬ç«‹çš„LoRAé€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;MultiTaskLoRA&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self, base_model, tasks):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; base_model
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_adapters &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; task &lt;span style="color:#f92672"&gt;in&lt;/span&gt; tasks:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„LoRAé€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_adapters[task] &lt;span style="color:#f92672"&gt;=&lt;/span&gt; create_lora_adapter(base_model)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;switch_task&lt;/span&gt;(self, task_name):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ‡æ¢åˆ°æŒ‡å®šä»»åŠ¡çš„é€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; current_adapter &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;lora_adapters[task_name]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; apply_adapter(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_model, current_adapter)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="åœºæ™¯2ä¸ªæ€§åŒ–æ¨¡å‹å®šåˆ¶"&gt;åœºæ™¯2ï¼šä¸ªæ€§åŒ–æ¨¡å‹å®šåˆ¶&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ç”¨æˆ·ä¸“å±çš„ä¸ªæ€§åŒ–å¾®è°ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;personalize_model_for_user&lt;/span&gt;(base_model, user_data, user_id):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 1. ä¸ºç”¨æˆ·åˆ›å»ºä¸“å±LoRAé€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; user_adapter &lt;span style="color:#f92672"&gt;=&lt;/span&gt; LoRALayerWrapper(base_model, rank&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;16&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 2. åœ¨ç”¨æˆ·æ•°æ®ä¸Šå¾®è°ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; train_adapter(user_adapter, user_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 3. ä¿å­˜é€‚é…å™¨æƒé‡ï¼ˆä»…å‡ MBï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; save_adapter_weights(user_adapter, &lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;user_&lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;user_id&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;_adapter.pt&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; user_adapter&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="åœºæ™¯3æŒç»­å­¦ä¹ ä¸çŸ¥è¯†ç§¯ç´¯"&gt;åœºæ™¯3ï¼šæŒç»­å­¦ä¹ ä¸çŸ¥è¯†ç§¯ç´¯&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# æŒç»­å­¦ä¹ æ¡†æ¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ContinualLearningWithLoRA&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self, base_model):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; base_model
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;task_adapters &lt;span style="color:#f92672"&gt;=&lt;/span&gt; [] &lt;span style="color:#75715e"&gt;# å­˜å‚¨å†å²ä»»åŠ¡çš„é€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;current_adapter &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;learn_new_task&lt;/span&gt;(self, task_data, task_name):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ›å»ºæ–°ä»»åŠ¡çš„é€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; new_adapter &lt;span style="color:#f92672"&gt;=&lt;/span&gt; create_lora_adapter(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_model)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å¾®è°ƒé€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; train_adapter(new_adapter, task_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ä¿å­˜åˆ°å†å²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;task_adapters&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append((task_name, new_adapter))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;current_adapter &lt;span style="color:#f92672"&gt;=&lt;/span&gt; new_adapter
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;recall_task&lt;/span&gt;(self, task_name):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å¬å›ç‰¹å®šä»»åŠ¡çš„é€‚é…å™¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; name, adapter &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;task_adapters:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; name &lt;span style="color:#f92672"&gt;==&lt;/span&gt; task_name:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; apply_adapter(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_model, adapter)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;current_adapter &lt;span style="color:#f92672"&gt;=&lt;/span&gt; adapter
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;False&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©æŒ‡å—"&gt;æ€§èƒ½å¯¹æ¯”ä¸é€‰æ‹©æŒ‡å—&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;å…¨å‚æ•°å¾®è°ƒ&lt;/th&gt;
&lt;th&gt;LoRAå¾®è°ƒ&lt;/th&gt;
&lt;th&gt;é€‚é…å™¨ï¼ˆAdapterï¼‰&lt;/th&gt;
&lt;th&gt;å‰ç¼€è°ƒä¼˜ï¼ˆPrefix Tuningï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å‚æ•°é‡&lt;/td&gt;
&lt;td&gt;100%&lt;/td&gt;
&lt;td&gt;0.1%-1%&lt;/td&gt;
&lt;td&gt;0.5%-3%&lt;/td&gt;
&lt;td&gt;0.1%-0.5%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è®­ç»ƒé€Ÿåº¦&lt;/td&gt;
&lt;td&gt;æ…¢&lt;/td&gt;
&lt;td&gt;å¿«&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;td&gt;å¿«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å†…å­˜å ç”¨&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ¨¡å—åŒ–&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆå¹¶æ¨ç†&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;æ˜¯&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;td&gt;å¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¤šä»»åŠ¡æ”¯æŒ&lt;/td&gt;
&lt;td&gt;å›°éš¾&lt;/td&gt;
&lt;td&gt;å®¹æ˜“&lt;/td&gt;
&lt;td&gt;å®¹æ˜“&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯æ´å¯Ÿ&lt;/strong&gt;ï¼šLoRAçš„æˆåŠŸä¸ä»…åœ¨äºå…¶&lt;strong&gt;å‚æ•°æ•ˆç‡&lt;/strong&gt;ï¼Œæ›´åœ¨äºå…¶&lt;strong&gt;è®¾è®¡å“²å­¦&lt;/strong&gt;â€”â€”é€šè¿‡ä½ç§©è¿‘ä¼¼æ•æ‰ä»»åŠ¡ç‰¹å®šçš„çŸ¥è¯†å˜åŒ–ï¼ŒåŒæ—¶ä¿ç•™é¢„è®­ç»ƒçš„é€šç”¨çŸ¥è¯†ã€‚è¿™ç§&amp;quot;å¢é‡å­¦ä¹ &amp;quot;æ¨¡å¼ä»£è¡¨äº†ç°ä»£AIç³»ç»Ÿè®¾è®¡çš„é‡è¦è¶‹åŠ¿ã€‚&lt;/p&gt;
&lt;h2 id="å››åå¥½ä¼˜åŒ–rlhfä¸dpo"&gt;å››ã€åå¥½ä¼˜åŒ–ï¼šRLHFä¸DPO&lt;/h2&gt;
&lt;h3 id="rlhfåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ "&gt;RLHFï¼šåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ &lt;/h3&gt;
&lt;p&gt;RLHFï¼ˆReinforcement Learning from Human Feedbackï¼‰æ˜¯è®©æ¨¡å‹è¾“å‡ºæ›´ç¬¦åˆäººç±»åå¥½çš„&lt;strong&gt;æ ‡å‡†æ–¹æ³•&lt;/strong&gt;ï¼ŒåŒ…å«ä¸‰ä¸ªå…³é”®æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç›‘ç£å¾®è°ƒ&lt;/strong&gt;ï¼šå»ºç«‹åŸºç¡€æŒ‡ä»¤è·Ÿéšèƒ½åŠ›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¥–åŠ±æ¨¡å‹è®­ç»ƒ&lt;/strong&gt;ï¼šé€šè¿‡äººç±»åå¥½æ•°æ®è®­ç»ƒåˆ¤åˆ«æ¨¡å‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PPOä¼˜åŒ–&lt;/strong&gt;ï¼šä½¿ç”¨è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ç®—æ³•å¯¹é½æ¨¡å‹&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯æŒ‘æˆ˜&lt;/strong&gt;ï¼šè®­ç»ƒä¸ç¨³å®šã€è®¡ç®—æˆæœ¬é«˜ã€éœ€è¦å¤§é‡äººç±»æ ‡æ³¨&lt;/p&gt;
&lt;h3 id="dpoç›´æ¥åå¥½ä¼˜åŒ–"&gt;DPOï¼šç›´æ¥åå¥½ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;DPOï¼ˆDirect Preference Optimizationï¼‰æ˜¯RLHFçš„&lt;strong&gt;é«˜æ•ˆæ›¿ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼Œç›´æ¥ä½¿ç”¨åå¥½æ•°æ®ä¼˜åŒ–ç­–ç•¥ï¼Œæ— éœ€ç‹¬ç«‹çš„å¥–åŠ±æ¨¡å‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•°å­¦ä¼˜åŠ¿&lt;/strong&gt;ï¼šé—­å¼è§£ï¼Œè®­ç»ƒæ›´ç¨³å®š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¡ç®—æ•ˆç‡&lt;/strong&gt;ï¼šçœå»å¥–åŠ±æ¨¡å‹è®­ç»ƒå’ŒPPOä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®è·µæ•ˆæœ&lt;/strong&gt;ï¼šåœ¨æŸäº›ä»»åŠ¡ä¸Šè¡¨ç°ä¼˜äºä¼ ç»ŸRLHF&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å¯¹æ¯”åˆ†æ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç‰¹æ€§&lt;/th&gt;
&lt;th&gt;RLHF&lt;/th&gt;
&lt;th&gt;DPO&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è®­ç»ƒå¤æ‚åº¦&lt;/td&gt;
&lt;td&gt;é«˜ï¼ˆä¸‰é˜¶æ®µï¼‰&lt;/td&gt;
&lt;td&gt;ä½ï¼ˆå•é˜¶æ®µï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¨³å®šæ€§&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ•°æ®éœ€æ±‚&lt;/td&gt;
&lt;td&gt;å¤§é‡åå¥½æ ‡æ³¨&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰åå¥½æ ‡æ³¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è®¡ç®—æˆæœ¬&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="äº”è‡ªåŠ¨åŒ–å¯¹é½rlaifä¸å˜ä½“"&gt;äº”ã€è‡ªåŠ¨åŒ–å¯¹é½ï¼šRLAIFä¸å˜ä½“&lt;/h2&gt;
&lt;h3 id="rlaifaiåé¦ˆçš„å¼ºåŒ–å­¦ä¹ "&gt;RLAIFï¼šAIåé¦ˆçš„å¼ºåŒ–å­¦ä¹ &lt;/h3&gt;
&lt;p&gt;RLAIFï¼ˆReinforcement Learning from AI Feedbackï¼‰ä½¿ç”¨å¼ºå¤§çš„AIæ¨¡å‹ï¼ˆå¦‚GPT-4ï¼‰ä»£æ›¿äººç±»æä¾›åå¥½ä¿¡å·ï¼Œè§£å†³äººç±»æ ‡æ³¨æˆæœ¬é«˜çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id="ä¼˜åŒ–ç®—æ³•æ¼”è¿›"&gt;ä¼˜åŒ–ç®—æ³•æ¼”è¿›&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;PPOï¼ˆè¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ï¼‰&lt;/strong&gt;ï¼šç»å…¸ç¨³å®šï¼Œä½†è®­ç»ƒå¤æ‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GRPOï¼ˆåˆ†ç»„æ’åç­–ç•¥ä¼˜åŒ–ï¼‰&lt;/strong&gt;ï¼šå¤šå€™é€‰æ’åï¼Œæå‡æ•ˆç‡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SPO/SimPOï¼ˆç®€åŒ–åå¥½ä¼˜åŒ–ï¼‰&lt;/strong&gt;ï¼šç›´æ¥ä¼˜åŒ–åå¥½æ¦‚ç‡å·®ï¼Œç®€æ´é«˜æ•ˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯è¶‹åŠ¿&lt;/strong&gt;ï¼šä»å¤æ‚å¤šé˜¶æ®µè®­ç»ƒå‘ç®€æ´å•é˜¶æ®µä¼˜åŒ–æ¼”è¿›ï¼Œæå‡è®­ç»ƒæ•ˆç‡å’Œç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;h2 id="å…­éƒ¨ç½²ä¼˜åŒ–æ¨¡å‹è’¸é¦"&gt;å…­ã€éƒ¨ç½²ä¼˜åŒ–ï¼šæ¨¡å‹è’¸é¦&lt;/h2&gt;
&lt;h3 id="æŠ€æœ¯åŸç†"&gt;æŠ€æœ¯åŸç†&lt;/h3&gt;
&lt;p&gt;æ¨¡å‹è’¸é¦ï¼ˆKnowledge Distillationï¼‰é€šè¿‡&amp;quot;æ•™å¸ˆ-å­¦ç”Ÿ&amp;quot;æ¡†æ¶ï¼Œå°†å¤§æ¨¡å‹çš„&lt;strong&gt;çŸ¥è¯†å‹ç¼©&lt;/strong&gt;åˆ°å°æ¨¡å‹ä¸­ï¼Œå®ç°éƒ¨ç½²æ•ˆç‡çš„æå‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŸå¤±å‡½æ•°&lt;/strong&gt;ï¼šç»“åˆç¡¬æ ‡ç­¾æŸå¤±å’Œè½¯æ ‡ç­¾è’¸é¦æŸå¤±&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è’¸é¦ç­–ç•¥&lt;/strong&gt;ï¼šå“åº”è’¸é¦ã€ç‰¹å¾è’¸é¦ã€å…³ç³»è’¸é¦ç­‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ€§èƒ½å¹³è¡¡&lt;/strong&gt;ï¼šåœ¨æ¨¡å‹å¤§å°å’Œæ€§èƒ½é—´å¯»æ‰¾æœ€ä¼˜å¹³è¡¡ç‚¹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å®è·µä»·å€¼"&gt;å®è·µä»·å€¼&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¾¹ç¼˜éƒ¨ç½²&lt;/strong&gt;ï¼šå°†æ•°åGBæ¨¡å‹å‹ç¼©åˆ°æ•°GB&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æ¨ç†&lt;/strong&gt;ï¼šæå‡æ¨ç†é€Ÿåº¦10-100å€&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æˆæœ¬ä¼˜åŒ–&lt;/strong&gt;ï¼šå¤§å¹…é™ä½æ¨ç†ç¡¬ä»¶éœ€æ±‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ¡ˆä¾‹ç ”ç©¶&lt;/strong&gt;ï¼šDistilBERTå°†BERTæ¨¡å‹å‹ç¼©40%ï¼Œæ¨ç†é€Ÿåº¦æå‡60%ï¼Œä¿ç•™97%çš„è¯­è¨€ç†è§£èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h2 id="ä¸ƒå®Œæ•´è®­ç»ƒæµç¨‹æ¶æ„ä¸æœ€ä½³å®è·µ"&gt;ä¸ƒã€å®Œæ•´è®­ç»ƒæµç¨‹æ¶æ„ä¸æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;h3 id="ç°ä»£llmè®­ç»ƒçš„å…¨æµç¨‹å¯è§†åŒ–"&gt;ç°ä»£LLMè®­ç»ƒçš„å…¨æµç¨‹å¯è§†åŒ–&lt;/h3&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;pre tabindex="0"&gt;&lt;code class="language-mermaid" data-lang="mermaid"&gt;graph TD
A[æ•°æ®å‡†å¤‡] --&amp;gt; B[é¢„è®­ç»ƒ Pretrain]
B --&amp;gt; C[SFTç›‘ç£å¾®è°ƒ]
C --&amp;gt; D[åå¥½å¯¹é½ RLHF/DPO]
D --&amp;gt; E[æ¨¡å‹è’¸é¦ Distillation]
E --&amp;gt; F[éƒ¨ç½²ä¼˜åŒ–]
A --&amp;gt; A1[æµ·é‡æ–‡æœ¬æ•°æ®]
B --&amp;gt; B1[åŸºç¡€è¯­è¨€èƒ½åŠ›]
C --&amp;gt; C1[æŒ‡ä»¤è·Ÿéšèƒ½åŠ›]
D --&amp;gt; D1[äººç±»åå¥½å¯¹é½]
E --&amp;gt; E1[çŸ¥è¯†å‹ç¼©]
F --&amp;gt; F1[ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²]
style A fill:#f9f,stroke:#333,stroke-width:2px
style B fill:#bbf,stroke:#333,stroke-width:2px
style C fill:#bfb,stroke:#333,stroke-width:2px
style D fill:#fbb,stroke:#333,stroke-width:2px
style E fill:#ffb,stroke:#333,stroke-width:2px
style F fill:#bff,stroke:#333,stroke-width:2px&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h3 id="å„é˜¶æ®µæŠ€æœ¯ç›®æ ‡ä¸äº§å‡º"&gt;å„é˜¶æ®µæŠ€æœ¯ç›®æ ‡ä¸äº§å‡º&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é˜¶æ®µ&lt;/th&gt;
&lt;th&gt;ä¸»è¦ç›®æ ‡&lt;/th&gt;
&lt;th&gt;å…³é”®æŠ€æœ¯&lt;/th&gt;
&lt;th&gt;äº§å‡ºæŒ‡æ ‡&lt;/th&gt;
&lt;th&gt;å…¸å‹è€—æ—¶&lt;/th&gt;
&lt;th&gt;èµ„æºéœ€æ±‚&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;é¢„è®­ç»ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å»ºç«‹åŸºç¡€è¯­è¨€èƒ½åŠ›&lt;/td&gt;
&lt;td&gt;è‡ªå›å½’/æ©ç LMã€æ··åˆç²¾åº¦è®­ç»ƒ&lt;/td&gt;
&lt;td&gt;Perplexityã€Zero-shotèƒ½åŠ›&lt;/td&gt;
&lt;td&gt;1000-10000 GPUå¤©&lt;/td&gt;
&lt;td&gt;æé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;SFTå¾®è°ƒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æŒ‡ä»¤è·Ÿéšå¯¹é½&lt;/td&gt;
&lt;td&gt;äº¤å‰ç†µä¼˜åŒ–ã€è¯¾ç¨‹å­¦ä¹ &lt;/td&gt;
&lt;td&gt;æŒ‡ä»¤éµå¾ªç‡ã€ä»»åŠ¡å®Œæˆåº¦&lt;/td&gt;
&lt;td&gt;10-100 GPUå¤©&lt;/td&gt;
&lt;td&gt;é«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;åå¥½å¯¹é½&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;äººç±»åå¥½ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;RLHF/DPOã€å¥–åŠ±å»ºæ¨¡&lt;/td&gt;
&lt;td&gt;åå¥½èƒœç‡ã€äººå·¥è¯„ä¼°åˆ†&lt;/td&gt;
&lt;td&gt;50-500 GPUå¤©&lt;/td&gt;
&lt;td&gt;å¾ˆé«˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;æ¨¡å‹è’¸é¦&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;éƒ¨ç½²æ•ˆç‡ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;çŸ¥è¯†è’¸é¦ã€å“åº”æ¨¡ä»¿&lt;/td&gt;
&lt;td&gt;æ¨¡å‹å¤§å°ã€æ¨ç†é€Ÿåº¦&lt;/td&gt;
&lt;td&gt;20-200 GPUå¤©&lt;/td&gt;
&lt;td&gt;ä¸­ç­‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;éƒ¨ç½²ä¼˜åŒ–&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”Ÿäº§å°±ç»ª&lt;/td&gt;
&lt;td&gt;é‡åŒ–ã€å‰ªæã€ç¼–è¯‘ä¼˜åŒ–&lt;/td&gt;
&lt;td&gt;å»¶è¿Ÿã€ååé‡ã€æˆæœ¬&lt;/td&gt;
&lt;td&gt;5-50 GPUå¤©&lt;/td&gt;
&lt;td&gt;ä½&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶"&gt;æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶&lt;/h3&gt;
&lt;h4 id="åœºæ™¯1èµ„æºå……è¶³çš„å®Œæ•´æµç¨‹"&gt;åœºæ™¯1ï¼šèµ„æºå……è¶³çš„å®Œæ•´æµç¨‹&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;é€‚ç”¨åœºæ™¯&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å¤§å‹ç§‘æŠ€å…¬å¸ã€ç ”ç©¶æœºæ„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ç›®æ ‡&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ‰“é€ é¡¶å°–æ€§èƒ½çš„é€šç”¨å¤§æ¨¡å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŠ€æœ¯æ ˆ&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;é¢„è®­ç»ƒ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ä¸‡äº¿tokenè§„æ¨¡ï¼Œåƒäº¿å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;SFT&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ•°åä¸‡é«˜è´¨é‡æŒ‡ä»¤æ ·æœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å¯¹é½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;RLHF + äººå·¥è¯„ä¼°å›¢é˜Ÿ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;è’¸é¦&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ•™å¸ˆ-å­¦ç”Ÿå¤šè½®è’¸é¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¼˜åŠ¿&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ€§èƒ½æœ€ä¼˜ï¼ŒæŠ€æœ¯é¢†å…ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŒ‘æˆ˜&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æˆæœ¬æé«˜ï¼Œå‘¨æœŸæ¼«é•¿&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä»£è¡¨æ¡ˆä¾‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;GPT-4ã€Claude 3ã€Gemini Ultra&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="åœºæ™¯2å¿«é€Ÿä¸šåŠ¡é€‚é…"&gt;åœºæ™¯2ï¼šå¿«é€Ÿä¸šåŠ¡é€‚é…&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;é€‚ç”¨åœºæ™¯&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ä¼ä¸šåº”ç”¨ã€å‚ç›´é¢†åŸŸ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ç›®æ ‡&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å¿«é€Ÿå°†é€šç”¨æ¨¡å‹é€‚é…åˆ°å…·ä½“ä¸šåŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŠ€æœ¯æ ˆ&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;åŸºç¡€æ¨¡å‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;é€‰æ‹©å¼€æºé¢„è®­ç»ƒæ¨¡å‹ï¼ˆLlamaã€Qwenç­‰ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å¾®è°ƒ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;LoRAé«˜æ•ˆé€‚é…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å¯¹é½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;DPOå¿«é€Ÿåå¥½ä¼˜åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ä¼˜åŒ–&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;é‡åŒ–+ç¼–è¯‘ä¼˜åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¼˜åŠ¿&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å¿«é€Ÿä¸Šçº¿ï¼Œæˆæœ¬å¯æ§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŒ‘æˆ˜&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ€§èƒ½æœ‰ä¸Šé™ï¼Œä¾èµ–åŸºç¡€æ¨¡å‹è´¨é‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä»£è¡¨æ¡ˆä¾‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ä¼ä¸šå®¢æœåŠ©æ‰‹ã€ä¸“ä¸šé¢†åŸŸé—®ç­”ç³»ç»Ÿ&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="åœºæ™¯3è¾¹ç¼˜ä¸ç§»åŠ¨ç«¯éƒ¨ç½²"&gt;åœºæ™¯3ï¼šè¾¹ç¼˜ä¸ç§»åŠ¨ç«¯éƒ¨ç½²&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;é€‚ç”¨åœºæ™¯&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ç§»åŠ¨åº”ç”¨ã€IoTè®¾å¤‡ã€å®æ—¶ç³»ç»Ÿ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ç›®æ ‡&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ä½å»¶è¿Ÿã€ä½åŠŸè€—æ¨ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŠ€æœ¯æ ˆ&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;æ¨¡å‹é€‰æ‹©&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å°å‹è’¸é¦æ¨¡å‹ï¼ˆ1-7Bå‚æ•°ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å‹ç¼©&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;é‡åŒ–ï¼ˆINT8/INT4ï¼‰ã€å‰ªæ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ä¼˜åŒ–&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ¨¡å‹ç¼–è¯‘ã€ç®—å­èåˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;éƒ¨ç½²&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ONNX Runtimeã€TensorRT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¼˜åŠ¿&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;éƒ¨ç½²çµæ´»ï¼Œèµ„æºè¦æ±‚ä½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŒ‘æˆ˜&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;èƒ½åŠ›æœ‰é™ï¼Œéœ€è¦ç²¾å¿ƒè®¾è®¡ä»»åŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä»£è¡¨æ¡ˆä¾‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ‰‹æœºè¯­éŸ³åŠ©æ‰‹ã€è¾¹ç¼˜AIè®¾å¤‡&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="åœºæ™¯4ç ”ç©¶ä¸å°è§„æ¨¡å®éªŒ"&gt;åœºæ™¯4ï¼šç ”ç©¶ä¸å°è§„æ¨¡å®éªŒ&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;é€‚ç”¨åœºæ™¯&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å­¦æœ¯ç ”ç©¶ã€åŸå‹éªŒè¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ç›®æ ‡&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å¿«é€ŸéªŒè¯æ–°ç®—æ³•ã€æ–°æ€è·¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŠ€æœ¯æ ˆ&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;æ¨¡å‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ä¸­å°è§„æ¨¡åŸºç¡€æ¨¡å‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å¾®è°ƒ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;LoRA/P-Tuningç­‰PEFTæ–¹æ³•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;è¯„ä¼°&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è‡ªåŠ¨åŒ–è¯„ä¼°+å°è§„æ¨¡äººå·¥è¯„ä¼°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;è¿­ä»£&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å¿«é€Ÿå®éªŒå¾ªç¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¼˜åŠ¿&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æˆæœ¬ä½ï¼Œè¿­ä»£å¿«&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŒ‘æˆ˜&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ç»“æœå¯èƒ½ä¸ç›´æ¥é€‚ç”¨äºç”Ÿäº§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä»£è¡¨æ¡ˆä¾‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ–°å¯¹é½ç®—æ³•éªŒè¯ã€ä»»åŠ¡ç‰¹å®šä¼˜åŒ–&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="æµç¨‹ä¼˜åŒ–ç­–ç•¥"&gt;æµç¨‹ä¼˜åŒ–ç­–ç•¥&lt;/h3&gt;
&lt;h4 id="1-è¿­ä»£å¼è®­ç»ƒç­–ç•¥"&gt;1. è¿­ä»£å¼è®­ç»ƒç­–ç•¥&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;iterative_training_pipeline&lt;/span&gt;(base_model, data_pipeline):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è¿­ä»£å¼è®­ç»ƒæµæ°´çº¿&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç¬¬ä¸€è½®ï¼šåŸºç¡€èƒ½åŠ›å»ºç«‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; pretrain(base_model, data_pipeline&lt;span style="color:#f92672"&gt;.&lt;/span&gt;pretrain_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç¬¬äºŒè½®ï¼šæŒ‡ä»¤è·Ÿéšèƒ½åŠ›&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; sft_finetune(model, data_pipeline&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sft_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç¬¬ä¸‰è½®ï¼šåå¥½å¯¹é½ä¼˜åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; preference_align(model, data_pipeline&lt;span style="color:#f92672"&gt;.&lt;/span&gt;preference_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç¬¬å››è½®ï¼šè’¸é¦å‹ç¼©&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; small_model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; distill(model, data_pipeline&lt;span style="color:#f92672"&gt;.&lt;/span&gt;distill_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç¬¬äº”è½®ï¼šéƒ¨ç½²ä¼˜åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimized_model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; deploy_optimize(small_model)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; optimized_model&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="2-è´¨é‡è¯„ä¼°é—­ç¯"&gt;2. è´¨é‡è¯„ä¼°é—­ç¯&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;TrainingQualityLoop&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è®­ç»ƒè´¨é‡è¯„ä¼°é—­ç¯&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;metrics &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;pretrain&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;perplexity&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;zero_shot_acc&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;sft&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;instruction_follow&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;task_completion&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;alignment&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;preference_win_rate&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;safety_score&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;distillation&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;size_reduction&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;speed_up&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;quality_drop&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;evaluate_stage&lt;/span&gt;(self, stage, model, test_data):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è¯„ä¼°ç‰¹å®šè®­ç»ƒé˜¶æ®µçš„è´¨é‡&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; results &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; metric &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;metrics[stage]:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; results[metric] &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;compute_metric(metric, model, test_data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å†³å®šæ˜¯å¦è¿›å…¥ä¸‹ä¸€é˜¶æ®µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;pass_criteria(stage, results):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;, results
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;False&lt;/span&gt;, results
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;pass_criteria&lt;/span&gt;(self, stage, results):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;å„é˜¶æ®µçš„é€šè¿‡æ ‡å‡†&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; criteria &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;pretrain&amp;#34;&lt;/span&gt;: results[&lt;span style="color:#e6db74"&gt;&amp;#34;perplexity&amp;#34;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;10.0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;sft&amp;#34;&lt;/span&gt;: results[&lt;span style="color:#e6db74"&gt;&amp;#34;instruction_follow&amp;#34;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0.85&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;alignment&amp;#34;&lt;/span&gt;: results[&lt;span style="color:#e6db74"&gt;&amp;#34;preference_win_rate&amp;#34;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0.7&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;distillation&amp;#34;&lt;/span&gt;: results[&lt;span style="color:#e6db74"&gt;&amp;#34;quality_drop&amp;#34;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0.05&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; criteria[stage]&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="å…«æœªæ¥å±•æœ›ä¸æŠ€æœ¯æŒ‘æˆ˜"&gt;å…«ã€æœªæ¥å±•æœ›ä¸æŠ€æœ¯æŒ‘æˆ˜&lt;/h2&gt;
&lt;h3 id="æŠ€æœ¯å‘å±•è¶‹åŠ¿é¢„æµ‹"&gt;æŠ€æœ¯å‘å±•è¶‹åŠ¿é¢„æµ‹&lt;/h3&gt;
&lt;h4 id="1-è®­ç»ƒæ•ˆç‡é©å‘½"&gt;1. è®­ç»ƒæ•ˆç‡é©å‘½&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;çŸ­æœŸè¶‹åŠ¿ï¼ˆ1-2å¹´ï¼‰&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;æ›´é«˜æ•ˆçš„PEFTæ–¹æ³•&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è¶…è¶ŠLoRAçš„å‚æ•°é«˜æ•ˆå¾®è°ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;æ··åˆä¸“å®¶MoEæ™®åŠ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ç¨€ç–æ¿€æ´»é™ä½è®¡ç®—æˆæœ¬&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;è®­ç»ƒç®—æ³•ä¼˜åŒ–&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ›´ç¨³å®šçš„RLHF/DPOå˜ä½“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¸­æœŸè¶‹åŠ¿ï¼ˆ3-5å¹´ï¼‰&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ç«¯åˆ°ç«¯ä¼˜åŒ–&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ä»æ•°æ®åˆ°éƒ¨ç½²çš„å…¨æµç¨‹è”åˆä¼˜åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;è‡ªåŠ¨åŒ–è®­ç»ƒ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;AIè‡ªåŠ¨è®¾è®¡è®­ç»ƒæµç¨‹å’Œè¶…å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ç»¿è‰²AI&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;èƒ½æ•ˆæ¯”æå‡10-100å€çš„è®­ç»ƒæ–¹æ³•&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="2-å¯¹é½èƒ½åŠ›çªç ´"&gt;2. å¯¹é½èƒ½åŠ›çªç ´&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;æŠ€æœ¯æ–¹å‘&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ä»·å€¼è§‚å¯¹é½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ›´ç²¾å‡†çš„æ–‡åŒ–å’Œä»·å€¼è§‚é€‚é…&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å®‰å…¨å¢å¼º&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;å¯¹æŠ—æ€§æ”»å‡»çš„é²æ£’æ€§æå‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å¯è§£é‡Šæ€§&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ¨¡å‹å†³ç­–è¿‡ç¨‹çš„å¯è§£é‡Šå’Œå¯æ§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;åº”ç”¨åœºæ™¯&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ä¸ªæ€§åŒ–åŠ©æ‰‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ·±åº¦ç†è§£ç”¨æˆ·ä¹ æƒ¯å’Œåå¥½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ä¸“ä¸šé¢†åŸŸ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;åŒ»å­¦ã€æ³•å¾‹ã€é‡‘èç­‰é«˜é£é™©é¢†åŸŸ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;åˆ›é€ æ€§å·¥ä½œ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è‰ºæœ¯åˆ›ä½œã€ç§‘å­¦å‘ç°çš„ååŒ&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="3-å¤šæ¨¡æ€ä¸è·¨é¢†åŸŸèåˆ"&gt;3. å¤šæ¨¡æ€ä¸è·¨é¢†åŸŸèåˆ&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;èåˆæ¨¡å¼&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ç»Ÿä¸€æ¶æ„&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘çš„ç»Ÿä¸€å»ºæ¨¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;è·¨æ¨¡æ€ç†è§£&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ·±åº¦ç†è§£ä¸åŒæ¨¡æ€é—´çš„è¯­ä¹‰å…³è”&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ä¸–ç•Œæ¨¡å‹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æ„å»ºå¯¹ç‰©ç†ä¸–ç•Œçš„ç†è§£å’Œæ¨ç†èƒ½åŠ›&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;åº”ç”¨å‰æ™¯&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;å…·èº«æ™ºèƒ½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æœºå™¨äººã€è‡ªåŠ¨é©¾é©¶çš„æ™ºèƒ½æ§åˆ¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;æ•°å­—å­ªç”Ÿ&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è™šæ‹Ÿä¸–ç•Œçš„åˆ›å»ºå’Œäº¤äº’&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; - &lt;span style="color:#f92672"&gt;ç§‘å­¦å‘ç°&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è·¨å­¦ç§‘çš„çŸ¥è¯†å‘ç°å’Œæ¨ç†&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="å½“å‰é‡å¤§æŒ‘æˆ˜ä¸åº”å¯¹ç­–ç•¥"&gt;å½“å‰é‡å¤§æŒ‘æˆ˜ä¸åº”å¯¹ç­–ç•¥&lt;/h3&gt;
&lt;h4 id="æŒ‘æˆ˜1è®¡ç®—æˆæœ¬ä¸å¯æŒç»­æ€§"&gt;æŒ‘æˆ˜1ï¼šè®¡ç®—æˆæœ¬ä¸å¯æŒç»­æ€§&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# æˆæœ¬ä¼˜åŒ–ç­–ç•¥æ¡†æ¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CostOptimizationFramework&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;strategies &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;é«˜æ•ˆæ•°æ®æ¸…æ´—&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ•°æ®å¢å¼º&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;è¯¾ç¨‹å­¦ä¹ &amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;model&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;æ¨¡å‹å‹ç¼©&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;ç¨€ç–åŒ–&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ··åˆä¸“å®¶&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;training&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;æ··åˆç²¾åº¦&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ¢¯åº¦æ£€æŸ¥ç‚¹&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;åˆ†å¸ƒå¼ä¼˜åŒ–&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;infrastructure&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;äº‘è®¡ç®—ä¼˜åŒ–&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;ä¸“ç”¨ç¡¬ä»¶&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;èƒ½æ•ˆç®¡ç†&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;estimate_cost_reduction&lt;/span&gt;(self, strategy_combo):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;ä¼°è®¡ä¸åŒç­–ç•¥ç»„åˆçš„æˆæœ¬é™ä½æ•ˆæœ&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; reduction_rate &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; category, strategies &lt;span style="color:#f92672"&gt;in&lt;/span&gt; strategy_combo&lt;span style="color:#f92672"&gt;.&lt;/span&gt;items():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; strategy &lt;span style="color:#f92672"&gt;in&lt;/span&gt; strategies:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; reduction_rate &lt;span style="color:#f92672"&gt;*=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;get_strategy_effect(strategy)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; reduction_rate
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;get_strategy_effect&lt;/span&gt;(self, strategy):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è·å–å•ä¸ªç­–ç•¥çš„æ•ˆæœç³»æ•°&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; effects &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;é«˜æ•ˆæ•°æ®æ¸…æ´—&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.8&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# å‡å°‘20%æ•°æ®éœ€æ±‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ¨¡å‹å‹ç¼©&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.5&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# å‡å°‘50%è®¡ç®—é‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ··åˆç²¾åº¦&amp;#34;&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;0.5&lt;/span&gt;, &lt;span style="color:#75715e"&gt;# å‡å°‘50%æ˜¾å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ... å…¶ä»–ç­–ç•¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; effects&lt;span style="color:#f92672"&gt;.&lt;/span&gt;get(strategy, &lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="æŒ‘æˆ˜2æ•°æ®è´¨é‡ä¸ç‰ˆæƒé—®é¢˜"&gt;æŒ‘æˆ˜2ï¼šæ•°æ®è´¨é‡ä¸ç‰ˆæƒé—®é¢˜&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# æ•°æ®è´¨é‡ç®¡ç†æ¡†æ¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;DataQualityFramework&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;quality_dimensions &lt;span style="color:#f92672"&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å‡†ç¡®æ€§&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å®Œæ•´æ€§&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;ä¸€è‡´æ€§&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ—¶æ•ˆæ€§&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;ç›¸å…³æ€§&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å¤šæ ·æ€§&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;build_sustainable_data_pipeline&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ„å»ºå¯æŒç»­çš„æ•°æ®ç®¡é“&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pipeline &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ•°æ®æ”¶é›†&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å…¬å¼€æ•°æ®é›†&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;åˆæˆæ•°æ®ç”Ÿæˆ&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;ç”¨æˆ·åé¦ˆæ”¶é›†&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;é¢†åŸŸä¸“å®¶æ ‡æ³¨&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;è´¨é‡æ§åˆ¶&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;è‡ªåŠ¨è¿‡æ»¤&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;äººå·¥å®¡æ ¸&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å¤šæ ·æ€§æ£€æŸ¥&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;åè§æ£€æµ‹&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;ç‰ˆæƒç®¡ç†&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å¼€æºè®¸å¯&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å•†ä¸šæˆæƒ&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;åˆç†ä½¿ç”¨&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ•°æ®è´¡çŒ®åè®®&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æŒç»­æ›´æ–°&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å¢é‡å­¦ä¹ &amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ•°æ®ç‰ˆæœ¬æ§åˆ¶&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;è´¨é‡ç›‘æ§&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;åé¦ˆé—­ç¯&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; pipeline&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="æŒ‘æˆ˜3å®‰å…¨ä¸ä¼¦ç†å¯¹é½"&gt;æŒ‘æˆ˜3ï¼šå®‰å…¨ä¸ä¼¦ç†å¯¹é½&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# å®‰å…¨å¯¹é½æ¡†æ¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;SafetyAlignmentFramework&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;safety_layers &lt;span style="color:#f92672"&gt;=&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;é¢„è®­ç»ƒå®‰å…¨è¿‡æ»¤&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å¾®è°ƒå®‰å…¨çº¦æŸ&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ¨ç†æ—¶å®‰å…¨ç›‘æ§&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;åè®­ç»ƒå®‰å…¨è¯„ä¼°&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;implement_defense_in_depth&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;å®æ–½æ·±åº¦é˜²å¾¡ç­–ç•¥&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; defenses &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;é¢„é˜²å±‚&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;æ•°æ®æ¸…æ´—&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å®‰å…¨æç¤º&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;ä»·å€¼å¯¹é½&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ£€æµ‹å±‚&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;å¼‚å¸¸æ£€æµ‹&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å†…å®¹è¿‡æ»¤&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ„å›¾è¯†åˆ«&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;å“åº”å±‚&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;å®‰å…¨ä¸­æ–­&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å†…å®¹ä¿®æ­£&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;ç”¨æˆ·é€šçŸ¥&amp;#34;&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ¢å¤å±‚&amp;#34;&lt;/span&gt;: [&lt;span style="color:#e6db74"&gt;&amp;#34;æ¨¡å‹å›æ»š&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;å®‰å…¨æ›´æ–°&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;æ¼æ´ä¿®å¤&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; defenses&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="ç»™ä»ä¸šè€…çš„å®è·µå»ºè®®"&gt;ç»™ä»ä¸šè€…çš„å®è·µå»ºè®®&lt;/h3&gt;
&lt;h4 id="1-æŠ€æœ¯æ ˆå»ºè®¾è·¯çº¿å›¾"&gt;1. æŠ€æœ¯æ ˆå»ºè®¾è·¯çº¿å›¾&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;pre tabindex="0"&gt;&lt;code class="language-mermaid" data-lang="mermaid"&gt;graph LR
A[å…¥é—¨é˜¶æ®µ] --&amp;gt; B[æŒæ¡é˜¶æ®µ]
B --&amp;gt; C[ç²¾é€šé˜¶æ®µ]
C --&amp;gt; D[ä¸“å®¶é˜¶æ®µ]
A --&amp;gt; A1[ç†è§£åŸºç¡€æ¦‚å¿µ&amp;lt;br&amp;gt;è¯•ç”¨API]
B --&amp;gt; B1[æŒæ¡å¾®è°ƒæŠ€æœ¯&amp;lt;br&amp;gt;æ„å»ºåŸå‹]
C --&amp;gt; C1[ä¼˜åŒ–è®­ç»ƒæµç¨‹&amp;lt;br&amp;gt;éƒ¨ç½²ç³»ç»Ÿ]
D --&amp;gt; D1[åˆ›æ–°ç®—æ³•&amp;lt;br&amp;gt;å¼•é¢†æ–¹å‘]
style A fill:#dfd,stroke:#333
style B fill:#ddf,stroke:#333
style C fill:#fdd,stroke:#333
style D fill:#ffd,stroke:#333&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;h4 id="2-å­¦ä¹ èµ„æºæ¨è"&gt;2. å­¦ä¹ èµ„æºæ¨è&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-markdown" data-lang="markdown"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;## æ ¸å¿ƒå­¦ä¹ è·¯å¾„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;### ç†è®ºåŸºç¡€
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; **å¿…è¯»è®ºæ–‡**:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; &amp;#34;Attention is All You Need&amp;#34; (Transformer)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; &amp;#34;Training language models to follow instructions&amp;#34; (InstructGPT)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; &amp;#34;LoRA: Low-Rank Adaptation of Large Language Models&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; &amp;#34;Direct Preference Optimization&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;### å®è·µæŠ€èƒ½
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; **å¼€æºé¡¹ç›®**:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; Hugging Face Transformers
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; PEFT (Parameter-Efficient Fine-Tuning)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; TRL (Transformer Reinforcement Learning)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; vLLM (é«˜æ•ˆæ¨ç†å¼•æ“)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;### ç¤¾åŒºèµ„æº
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; **è®ºå›ç¤¾åŒº**: Hugging Face, Reddit r/MachineLearning
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;-&lt;/span&gt; **æŠ€æœ¯åšå®¢**: OpenAI Blog, Anthropic Blog, å„å¤§å…¬å¸æŠ€æœ¯åšå®¢
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;- &lt;span style="font-weight:bold"&gt;**åœ¨çº¿è¯¾ç¨‹**&lt;/span&gt;: Coursera, Fast.ai, å›½å†…ä¼˜è´¨AIè¯¾ç¨‹&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="3-èŒä¸šå‘å±•å»ºè®®"&gt;3. èŒä¸šå‘å±•å»ºè®®&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;åˆçº§å·¥ç¨‹å¸ˆ (0-2å¹´)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;é‡ç‚¹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æŒæ¡å·¥å…·ä½¿ç”¨ï¼Œå®Œæˆå…·ä½“ä»»åŠ¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;æŠ€èƒ½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;Python, PyTorch, åŸºç¡€å¾®è°ƒï¼ŒAPIä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;äº§å‡º&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;åŠŸèƒ½å®ç°ï¼Œbugä¿®å¤ï¼Œç®€å•ä¼˜åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¸­çº§å·¥ç¨‹å¸ˆ (2-5å¹´)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;é‡ç‚¹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ç‹¬ç«‹è´Ÿè´£æ¨¡å—ï¼Œä¼˜åŒ–è®­ç»ƒæµç¨‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;æŠ€èƒ½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;åˆ†å¸ƒå¼è®­ç»ƒï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œæ¨¡å‹è¯„ä¼°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;äº§å‡º&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è®­ç»ƒæµæ°´çº¿ï¼Œæ€§èƒ½æå‡ï¼ŒæŠ€æœ¯æ–¹æ¡ˆ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;é«˜çº§å·¥ç¨‹å¸ˆ (5-8å¹´)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;é‡ç‚¹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼ŒæŠ€æœ¯åˆ›æ–°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;æŠ€èƒ½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;ç®—æ³•åˆ›æ–°ï¼Œå¤§è§„æ¨¡ç³»ç»Ÿï¼Œå›¢é˜Ÿç®¡ç†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;äº§å‡º&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æŠ€æœ¯ä¸“åˆ©ï¼Œå¼€æºé¡¹ç›®ï¼Œæ¶æ„è®¾è®¡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;ä¸“å®¶/æ€»ç›‘ (8å¹´ä»¥ä¸Š)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;é‡ç‚¹&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æŠ€æœ¯æˆ˜ç•¥ï¼Œè¡Œä¸šå½±å“&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;æŠ€èƒ½&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;æŠ€æœ¯è§„åˆ’ï¼Œè·¨é¢†åŸŸæ•´åˆï¼Œç”Ÿæ€å»ºè®¾&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;äº§å‡º&lt;/span&gt;: &lt;span style="color:#ae81ff"&gt;è¡Œä¸šæ ‡å‡†ï¼ŒæŠ€æœ¯å“ç‰Œï¼Œåˆ›æ–°ç”Ÿæ€&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="ç»“è¯­å¤§æ¨¡å‹æ—¶ä»£çš„å·¥ç¨‹å“²å­¦"&gt;ç»“è¯­ï¼šå¤§æ¨¡å‹æ—¶ä»£çš„å·¥ç¨‹å“²å­¦&lt;/h2&gt;
&lt;p&gt;å¤§è¯­è¨€æ¨¡å‹çš„è®­ç»ƒæµç¨‹æ¼”è¿›ï¼Œåæ˜ äº†ä¸€ä¸ªæ›´æ·±å±‚çš„&lt;strong&gt;å·¥ç¨‹å“²å­¦è½¬å˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;h3 id="ä»ä¸€æ¬¡æ€§è®­ç»ƒåˆ°æŒç»­è¿›åŒ–"&gt;ä»&amp;quot;ä¸€æ¬¡æ€§è®­ç»ƒ&amp;quot;åˆ°&amp;quot;æŒç»­è¿›åŒ–&amp;quot;&lt;/h3&gt;
&lt;p&gt;ä¼ ç»Ÿæœºå™¨å­¦ä¹ å¼ºè°ƒ&lt;strong&gt;ä¸€æ¬¡æ€§è®­ç»ƒå®Œç¾æ¨¡å‹&lt;/strong&gt;ï¼Œè€Œç°ä»£å¤§æ¨¡å‹å®è·µå€¡å¯¼&lt;strong&gt;æŒç»­è¿­ä»£å’Œè¿›åŒ–&lt;/strong&gt;ã€‚æ¨¡å‹ä¸å†æ˜¯é™æ€äº§ç‰©ï¼Œè€Œæ˜¯èƒ½å¤Ÿéšç€æ•°æ®ã€ä»»åŠ¡å’Œåé¦ˆä¸æ–­æˆé•¿çš„&lt;strong&gt;åŠ¨æ€ç³»ç»Ÿ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="ä»å•ä¸€ä¼˜åŒ–åˆ°å¤šç›®æ ‡å¹³è¡¡"&gt;ä»&amp;quot;å•ä¸€ä¼˜åŒ–&amp;quot;åˆ°&amp;quot;å¤šç›®æ ‡å¹³è¡¡&amp;quot;&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä¸å†å•çº¯è¿½æ±‚å‡†ç¡®ç‡æˆ– perplexity çš„æè‡´ï¼Œè€Œæ˜¯åœ¨&lt;strong&gt;æ€§èƒ½ã€æ•ˆç‡ã€å®‰å…¨ã€æˆæœ¬&lt;/strong&gt;ç­‰å¤šç»´åº¦å¯»æ‰¾æœ€ä¼˜å¹³è¡¡ç‚¹ã€‚è¿™è¦æ±‚å·¥ç¨‹å¸ˆå…·å¤‡ç³»ç»Ÿæ€ç»´å’Œæƒè¡¡èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h3 id="ä»æŠ€æœ¯é©±åŠ¨åˆ°ä»·å€¼é©±åŠ¨"&gt;ä»&amp;quot;æŠ€æœ¯é©±åŠ¨&amp;quot;åˆ°&amp;quot;ä»·å€¼é©±åŠ¨&amp;quot;&lt;/h3&gt;
&lt;p&gt;æŠ€æœ¯çš„æœ€ç»ˆç›®æ ‡æ˜¯åˆ›é€ ä»·å€¼ã€‚å¤§æ¨¡å‹è®­ç»ƒæµç¨‹çš„æ¯ä¸ªç¯èŠ‚éƒ½åº”è¯¥å›ç­”ï¼šè¿™ä¸ºç”¨æˆ·ã€ä¸ºç¤¾ä¼šåˆ›é€ äº†ä»€ä¹ˆä»·å€¼ï¼Ÿè¿™ç§&lt;strong&gt;ä»·å€¼å¯¼å‘&lt;/strong&gt;çš„å·¥ç¨‹æ€ç»´ï¼Œå°†å†³å®šæŠ€æœ¯èƒ½å¦çœŸæ­£æœåŠ¡äººç±»ã€‚&lt;/p&gt;
&lt;h3 id="ç»™æœªæ¥å·¥ç¨‹å¸ˆçš„å¯„è¯­"&gt;ç»™æœªæ¥å·¥ç¨‹å¸ˆçš„å¯„è¯­&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¿æŒå­¦ä¹ &lt;/strong&gt;ï¼šè¿™ä¸ªé¢†åŸŸå˜åŒ–æå¿«ï¼Œä»Šå¤©çš„æœ€ä½³å®è·µæ˜å¤©å¯èƒ½å°±è¿‡æ—¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ·±å…¥åŸç†&lt;/strong&gt;ï¼šä¸è¦åœç•™åœ¨APIè°ƒç”¨ï¼Œè¦ç†è§£èƒŒåçš„æ•°å­¦å’Œç®—æ³•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³æ³¨ä¼¦ç†&lt;/strong&gt;ï¼šèƒ½åŠ›è¶Šå¤§ï¼Œè´£ä»»è¶Šå¤§ï¼Œå§‹ç»ˆæ€è€ƒæŠ€æœ¯çš„è¾¹ç•Œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®è·µä¸ºç‹&lt;/strong&gt;ï¼šç†è®ºçŸ¥è¯†éœ€è¦åœ¨å®é™…é¡¹ç›®ä¸­éªŒè¯å’Œæ·±åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼€æ”¾åˆä½œ&lt;/strong&gt;ï¼šAIå‘å±•éœ€è¦å…¨çƒç¤¾åŒºçš„å…±åŒåŠªåŠ›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¤§è¯­è¨€æ¨¡å‹æ­£åœ¨é‡å¡‘æˆ‘ä»¬ä¸ä¿¡æ¯çš„äº¤äº’æ–¹å¼ï¼Œé‡æ–°å®šä¹‰æ™ºèƒ½çš„è¾¹ç•Œã€‚ä½œä¸ºè¿™ä¸ªæ—¶ä»£çš„å·¥ç¨‹å¸ˆï¼Œæˆ‘ä»¬ä¸ä»…æœ‰å¹¸è§è¯è¿™åœºå˜é©ï¼Œæ›´æœ‰è´£ä»»å¼•å¯¼å®ƒå‘æœ‰ç›Šäºäººç±»çš„æ–¹å‘å‘å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æŠ€æœ¯çš„æ˜Ÿè¾°å¤§æµ·å·²ç»å±•å¼€ï¼Œæ¢ç´¢çš„èˆªç¨‹åˆšåˆšå¼€å§‹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;æœ¬æ–‡åŸºäºå½“å‰ï¼ˆ2025å¹´ï¼‰å¤§è¯­è¨€æ¨¡å‹è®­ç»ƒçš„æœ€ä½³å®è·µç¼–å†™ã€‚æŠ€æœ¯ç»†èŠ‚ä¼šéšç ”ç©¶è¿›å±•ä¸æ–­æ›´æ–°ï¼Œå»ºè®®è¯»è€…ï¼š&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;em&gt;å…³æ³¨é¡¶çº§ä¼šè®®ï¼ˆNeurIPS, ICML, ICLRç­‰ï¼‰çš„æœ€æ–°è®ºæ–‡&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;å‚ä¸å¼€æºç¤¾åŒºï¼ˆHugging Face, GitHubç­‰ï¼‰çš„å®è·µé¡¹ç›®&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­éªŒè¯å’Œä¼˜åŒ–æŠ€æœ¯æ–¹æ¡ˆ&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ä¿æŒæ‰¹åˆ¤æ€§æ€ç»´ï¼Œä¸ç›²ç›®è¿½éšæŠ€æœ¯çƒ­æ½®&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;æ„¿æœ¬æ–‡èƒ½ä¸ºä½ çš„AIä¹‹æ—…æä¾›æœ‰ä»·å€¼çš„å‚è€ƒå’Œå¯å‘ã€‚&lt;/em&gt;&lt;/p&gt;</description></item><item><title>æ·±åº¦å­¦ä¹ ä¸­çš„æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸ï¼šä»æ•°å­¦åŸºç¡€åˆ°ç°ä»£è§£å†³æ–¹æ¡ˆ</title><link>http://localhost:1313/post/llm/llm-5/</link><pubDate>Mon, 18 Nov 2024 00:00:00 +0000</pubDate><author>cugbtang@sina.com (yesplease)</author><guid>http://localhost:1313/post/llm/llm-5/</guid><description>&lt;h1 id="æ·±åº¦å­¦ä¹ ä¸­çš„æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸ä»æ•°å­¦åŸºç¡€åˆ°ç°ä»£è§£å†³æ–¹æ¡ˆ"&gt;æ·±åº¦å­¦ä¹ ä¸­çš„æ¢¯åº¦æ¶ˆå¤±ä¸çˆ†ç‚¸ï¼šä»æ•°å­¦åŸºç¡€åˆ°ç°ä»£è§£å†³æ–¹æ¡ˆ&lt;/h1&gt;
&lt;h2 id="ä¸€æ•°å­¦åŸºç¡€æ¢¯åº¦ä¸åå‘ä¼ æ’­"&gt;ä¸€ã€æ•°å­¦åŸºç¡€ï¼šæ¢¯åº¦ä¸åå‘ä¼ æ’­&lt;/h2&gt;
&lt;h3 id="11-æ¢¯åº¦çš„æ•°å­¦æœ¬è´¨"&gt;1.1 æ¢¯åº¦çš„æ•°å­¦æœ¬è´¨&lt;/h3&gt;
&lt;p&gt;åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œ&lt;strong&gt;æ¢¯åº¦&lt;/strong&gt;æ˜¯æŸå¤±å‡½æ•°å¯¹å‚æ•°çš„åå¯¼æ•°å‘é‡ï¼Œè¡¨ç¤ºäº†æŸå¤±å‡½æ•°åœ¨å‚æ•°ç©ºé—´ä¸­æœ€é™¡å³­çš„ä¸Šå‡æ–¹å‘ã€‚å¯¹äºç¥ç»ç½‘ç»œä¸­çš„å‚æ•° $\theta$ï¼Œæ¢¯åº¦å®šä¹‰ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$\nabla_\theta \mathcal{L} = \left[ \frac{\partial \mathcal{L}}{\partial \theta_1}, \frac{\partial \mathcal{L}}{\partial \theta_2}, \ldots, \frac{\partial \mathcal{L}}{\partial \theta_n} \right]^T$$&lt;/p&gt;
&lt;p&gt;æ¢¯åº¦ä¸‹é™æ³•é€šè¿‡ä»¥ä¸‹è§„åˆ™æ›´æ–°å‚æ•°ï¼š&lt;/p&gt;
&lt;p&gt;$$\theta_{t+1} = \theta_t - \eta \cdot \nabla_\theta \mathcal{L}$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $\eta$ æ˜¯å­¦ä¹ ç‡ï¼Œæ§åˆ¶å‚æ•°æ›´æ–°çš„æ­¥é•¿ã€‚&lt;/p&gt;
&lt;h3 id="12-åå‘ä¼ æ’­çš„é“¾å¼æ³•åˆ™"&gt;1.2 åå‘ä¼ æ’­çš„é“¾å¼æ³•åˆ™&lt;/h3&gt;
&lt;p&gt;åå‘ä¼ æ’­ç®—æ³•çš„æ ¸å¿ƒæ˜¯&lt;strong&gt;é“¾å¼æ³•åˆ™&lt;/strong&gt;ã€‚å¯¹äºä¸€ä¸ªå¤åˆå‡½æ•° $f(g(x))$ï¼Œå…¶å¯¼æ•°ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$\frac{df}{dx} = \frac{df}{dg} \cdot \frac{dg}{dx}$$&lt;/p&gt;
&lt;p&gt;åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œå¯¹äº $L$ å±‚çš„ç½‘ç»œï¼Œç¬¬ $l$ å±‚çš„æ¢¯åº¦è®¡ç®—éœ€è¦é“¾å¼ä¼ é€’æ‰€æœ‰åç»­å±‚çš„æ¢¯åº¦ï¼š&lt;/p&gt;
&lt;p&gt;$$\frac{\partial \mathcal{L}}{\partial W^{(l)}} = \frac{\partial \mathcal{L}}{\partial z^{(L)}} \cdot \frac{\partial z^{(L)}}{\partial z^{(L-1)}} \cdots \frac{\partial z^{(l+1)}}{\partial z^{(l)}} \cdot \frac{\partial z^{(l)}}{\partial W^{(l)}}$$&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªè¿ä¹˜è¿‡ç¨‹æ­£æ˜¯æ¢¯åº¦é—®é¢˜çš„æ ¹æºã€‚&lt;/p&gt;
&lt;h2 id="äºŒæ¢¯åº¦é—®é¢˜çš„æœ¬è´¨ç°è±¡ä¸æ•°å­¦åˆ†æ"&gt;äºŒã€æ¢¯åº¦é—®é¢˜çš„æœ¬è´¨ï¼šç°è±¡ä¸æ•°å­¦åˆ†æ&lt;/h2&gt;
&lt;h3 id="21-æ¢¯åº¦æ¶ˆå¤±vanishing-gradient"&gt;2.1 æ¢¯åº¦æ¶ˆå¤±ï¼ˆVanishing Gradientï¼‰&lt;/h3&gt;
&lt;h4 id="ç°è±¡å®šä¹‰"&gt;ç°è±¡å®šä¹‰&lt;/h4&gt;
&lt;p&gt;æ¢¯åº¦æ¶ˆå¤±æ˜¯æŒ‡åœ¨æ·±å±‚ç½‘ç»œæˆ–é•¿åºåˆ— RNN ä¸­ï¼Œ&lt;strong&gt;é è¿‘è¾“å…¥å±‚çš„æ¢¯åº¦å˜å¾—æå°&lt;/strong&gt;ï¼ˆè¶‹è¿‘äº 0ï¼‰çš„ç°è±¡ã€‚&lt;/p&gt;
&lt;h4 id="æ•°å­¦åˆ†æ"&gt;æ•°å­¦åˆ†æ&lt;/h4&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸ªå…·æœ‰ $L$ å±‚çš„æ·±åº¦ç½‘ç»œï¼Œæ¯å±‚ä½¿ç”¨ç›¸åŒçš„æƒé‡çŸ©é˜µ $W$ å’Œæ¿€æ´»å‡½æ•° $\sigma$ã€‚ç¬¬ $l$ å±‚çš„æ¢¯åº¦å¯ä»¥è¡¨ç¤ºä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$\frac{\partial \mathcal{L}}{\partial W^{(l)}} = \delta^{(l)} \cdot a^{(l-1)^T}$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­è¯¯å·®é¡¹ $\delta^{(l)} = (W^{(l+1)})^T \delta^{(l+1)} \odot \sigma&amp;rsquo;(z^{(l)})$&lt;/p&gt;
&lt;p&gt;é€’å½’å±•å¼€åï¼š&lt;/p&gt;
&lt;p&gt;$$\delta^{(l)} = \left( \prod_{k=l}^{L-1} (W^{(k+1)})^T \cdot \text{diag}(\sigma&amp;rsquo;(z^{(k)})) \right) \delta^{(L)}$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®è§‚å¯Ÿ&lt;/strong&gt;ï¼šå¦‚æœ $|W| &amp;lt; 1$ ä¸” $|\sigma&amp;rsquo;(z)| &amp;lt; 1$ï¼Œé‚£ä¹ˆè¿ä¹˜é¡¹ $\prod_{k=l}^{L-1} W^T \cdot \text{diag}(\sigma&amp;rsquo;(z^{(k)}))$ ä¼šæŒ‡æ•°çº§è¡°å‡ã€‚&lt;/p&gt;
&lt;h4 id="å…¸å‹åœºæ™¯"&gt;å…¸å‹åœºæ™¯&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sigmoid æ¿€æ´»å‡½æ•°&lt;/strong&gt;ï¼š$\sigma&amp;rsquo;(x) = \sigma(x)(1-\sigma(x)) \leq 0.25$&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Tanh æ¿€æ´»å‡½æ•°&lt;/strong&gt;ï¼š$\tanh&amp;rsquo;(x) = 1 - \tanh^2(x) \leq 1$ï¼Œä½†é€šå¸¸è¿œå°äº 1&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ·±å±‚ç½‘ç»œ&lt;/strong&gt;ï¼šéšç€å±‚æ•°å¢åŠ ï¼Œæ¢¯åº¦è¿ä¹˜é¡¹æŒ‡æ•°çº§å‡å°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é•¿åºåˆ— RNN&lt;/strong&gt;ï¼šæ—¶é—´æ­¥é•¿å¢åŠ å¯¼è‡´æ¢¯åº¦è¿ä¹˜é¡¹ç´¯ç§¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åæœ"&gt;åæœ&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å‰é¢çš„å±‚å‡ ä¹ä¸æ›´æ–°å‚æ•°ï¼š$\Delta W^{(l)} = -\eta \frac{\partial \mathcal{L}}{\partial W^{(l)}} \approx 0$&lt;/li&gt;
&lt;li&gt;æ¨¡å‹æ— æ³•æœ‰æ•ˆå­¦ä¹ é•¿æœŸä¾èµ–å…³ç³»&lt;/li&gt;
&lt;li&gt;è®­ç»ƒæ—©æœŸé˜¶æ®µå°±é™·å…¥åœæ»&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="22-æ¢¯åº¦çˆ†ç‚¸exploding-gradient"&gt;2.2 æ¢¯åº¦çˆ†ç‚¸ï¼ˆExploding Gradientï¼‰&lt;/h3&gt;
&lt;h4 id="ç°è±¡å®šä¹‰-1"&gt;ç°è±¡å®šä¹‰&lt;/h4&gt;
&lt;p&gt;æ¢¯åº¦çˆ†ç‚¸æ˜¯æŒ‡æ¢¯åº¦åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­&lt;strong&gt;ä¸æ–­æ”¾å¤§&lt;/strong&gt;ï¼Œå˜å¾—éå¸¸å¤§ï¼ˆå¦‚ $1e10$ï¼‰çš„ç°è±¡ã€‚&lt;/p&gt;
&lt;h4 id="æ•°å­¦åˆ†æ-1"&gt;æ•°å­¦åˆ†æ&lt;/h4&gt;
&lt;p&gt;ä»ä¸Šè¿°æ¢¯åº¦è¡¨è¾¾å¼å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæƒé‡çŸ©é˜µçš„è°±èŒƒæ•° $|W| &amp;gt; 1$ï¼Œé‚£ä¹ˆè¿ä¹˜é¡¹ä¼šæŒ‡æ•°çº§å¢é•¿ï¼š&lt;/p&gt;
&lt;p&gt;$$|\delta^{(l)}| \propto \prod_{k=l}^{L-1} |W^{(k+1)}| \cdot |\sigma&amp;rsquo;(z^{(k)})|$$&lt;/p&gt;
&lt;p&gt;å½“ $|W| &amp;gt; 1$ æ—¶ï¼Œ$|W|^L$ ä¼šéšç€å±‚æ•° $L$ æŒ‡æ•°çº§å¢é•¿ã€‚&lt;/p&gt;
&lt;h4 id="å…¸å‹åœºæ™¯-1"&gt;å…¸å‹åœºæ™¯&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;RNN å¤„ç†é•¿åºåˆ—æ—¶ï¼Œæƒé‡çŸ©é˜µçš„ç‰¹å¾å€¼ &amp;gt; 1&lt;/li&gt;
&lt;li&gt;æƒé‡åˆå§‹åŒ–ä¸å½“ï¼Œåˆå§‹å€¼è¿‡å¤§&lt;/li&gt;
&lt;li&gt;æŸäº›ç‰¹æ®Šä»»åŠ¡å¯¼è‡´æ¢¯åº¦ç´¯ç§¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="åæœ-1"&gt;åæœ&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å‚æ•°æ›´æ–°å¹…åº¦è¿‡å¤§ï¼š$|\Delta W^{(l)}| = \eta |\frac{\partial \mathcal{L}}{\partial W^{(l)}}|$ å¯èƒ½è¾¾åˆ° $1e10$ é‡çº§&lt;/li&gt;
&lt;li&gt;æ•°å€¼ä¸ç¨³å®šï¼Œå¯¼è‡´ $\text{NaN}$ å€¼å‡ºç°&lt;/li&gt;
&lt;li&gt;è®­ç»ƒè¿‡ç¨‹å‘æ•£ï¼ŒæŸå¤±å‡½æ•°æ€¥å‰§å¢å¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="ä¸‰ä»£ç å®ç°ä¸å®éªŒéªŒè¯"&gt;ä¸‰ã€ä»£ç å®ç°ä¸å®éªŒéªŒè¯&lt;/h2&gt;
&lt;h3 id="31-æ¢¯åº¦æ¶ˆå¤±çš„å¯è§†åŒ–å®éªŒ"&gt;3.1 æ¢¯åº¦æ¶ˆå¤±çš„å¯è§†åŒ–å®éªŒ&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æ·±åº¦ç½‘ç»œæ¥å¯è§†åŒ–æ¢¯åº¦æ¶ˆå¤±ç°è±¡ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch.nn &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; nn
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; matplotlib.pyplot &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; plt
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; numpy &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; np
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;visualize_vanishing_gradient&lt;/span&gt;():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;å¯è§†åŒ–æ·±åº¦ç½‘ç»œä¸­æ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; depths &lt;span style="color:#f92672"&gt;=&lt;/span&gt; [&lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;20&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;30&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;50&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;100&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; avg_gradients &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; depth &lt;span style="color:#f92672"&gt;in&lt;/span&gt; depths:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ›å»ºæ·±åº¦ç½‘ç»œ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layers &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; i &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(depth):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear(&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Sigmoid()) &lt;span style="color:#75715e"&gt;# ä½¿ç”¨Sigmoidæ¿€æ´»å‡½æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Sequential(&lt;span style="color:#f92672"&gt;*&lt;/span&gt;layers)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å‰å‘ä¼ æ’­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;randn(&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; y &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; y&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sum()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åå‘ä¼ æ’­å¹¶æ”¶é›†æ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è®¡ç®—å„å±‚æ¢¯åº¦çš„å¹³å‡ç»å¯¹å€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradients &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; name, param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;named_parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;weight&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;in&lt;/span&gt; name &lt;span style="color:#f92672"&gt;and&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradients&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;abs()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;mean()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item())
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åªå–å‰5å±‚çš„æ¢¯åº¦ï¼ˆé¿å…å±‚æ•°ä¸åŒå¯¼è‡´çš„æ¯”è¾ƒé—®é¢˜ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradients &lt;span style="color:#f92672"&gt;=&lt;/span&gt; gradients[:&lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; avg_gradients&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(np&lt;span style="color:#f92672"&gt;.&lt;/span&gt;mean(gradients))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç»˜åˆ¶ç»“æœ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;figure(figsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;6&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;semilogy(depths, avg_gradients, &lt;span style="color:#e6db74"&gt;&amp;#39;b-o&amp;#39;&lt;/span&gt;, linewidth&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;, markersize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;xlabel(&lt;span style="color:#e6db74"&gt;&amp;#39;ç½‘ç»œå±‚æ•°&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;12&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ylabel(&lt;span style="color:#e6db74"&gt;&amp;#39;å¹³å‡æ¢¯åº¦ç»å¯¹å€¼ (log scale)&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;12&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;title(&lt;span style="color:#e6db74"&gt;&amp;#39;æ¢¯åº¦æ¶ˆå¤±ç°è±¡ï¼šç½‘ç»œå±‚æ•°å¯¹æ¢¯åº¦çš„å½±å“&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;14&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grid(&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;, alpha&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.3&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;show()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;visualize_vanishing_gradient()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;å®éªŒç»“æœåˆ†æ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éšç€ç½‘ç»œå±‚æ•°å¢åŠ ï¼Œæ¢¯åº¦å‘ˆæŒ‡æ•°çº§è¡°å‡&lt;/li&gt;
&lt;li&gt;åœ¨100å±‚ç½‘ç»œä¸­ï¼Œå‰å‡ å±‚çš„æ¢¯åº¦å¯èƒ½è¡°å‡åˆ° $10^{-8}$ é‡çº§&lt;/li&gt;
&lt;li&gt;è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆæ·±å±‚ç½‘ç»œéš¾ä»¥è®­ç»ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="32-æ¢¯åº¦çˆ†ç‚¸çš„æ•°å€¼å®éªŒ"&gt;3.2 æ¢¯åº¦çˆ†ç‚¸çš„æ•°å€¼å®éªŒ&lt;/h3&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;demonstrate_exploding_gradient&lt;/span&gt;():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ¼”ç¤ºæ¢¯åº¦çˆ†ç‚¸ç°è±¡&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; sequence_lengths &lt;span style="color:#f92672"&gt;=&lt;/span&gt; [&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;20&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;50&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;100&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;200&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; max_gradients &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; seq_len &lt;span style="color:#f92672"&gt;in&lt;/span&gt; sequence_lengths:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ›å»ºRNNå±‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; rnn &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;RNN(input_size&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;, hidden_size&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, num_layers&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;, batch_first&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ•…æ„è®¾ç½®è¾ƒå¤§çš„æƒé‡æ¥è¯±å¯¼æ¢¯åº¦çˆ†ç‚¸&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;with&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;no_grad():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; rnn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;weight_hh_l0&lt;span style="color:#f92672"&gt;.&lt;/span&gt;fill_(&lt;span style="color:#ae81ff"&gt;2.0&lt;/span&gt;) &lt;span style="color:#75715e"&gt;# è®¾ç½®æƒé‡å€¼è¾ƒå¤§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ›å»ºé•¿åºåˆ—è¾“å…¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;randn(&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;, seq_len, &lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å‰å‘ä¼ æ’­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output, hidden &lt;span style="color:#f92672"&gt;=&lt;/span&gt; rnn(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; output&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sum()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åå‘ä¼ æ’­&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è®°å½•æœ€å¤§æ¢¯åº¦å€¼&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; max_grad &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; rnn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; max_grad &lt;span style="color:#f92672"&gt;=&lt;/span&gt; max(max_grad, param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;abs()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;max()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item())
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; max_gradients&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(max_grad)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# é‡ç½®æ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; rnn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç»˜åˆ¶ç»“æœ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;figure(figsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;6&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;semilogy(sequence_lengths, max_gradients, &lt;span style="color:#e6db74"&gt;&amp;#39;r-s&amp;#39;&lt;/span&gt;, linewidth&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;, markersize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;8&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;xlabel(&lt;span style="color:#e6db74"&gt;&amp;#39;åºåˆ—é•¿åº¦&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;12&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ylabel(&lt;span style="color:#e6db74"&gt;&amp;#39;æœ€å¤§æ¢¯åº¦å€¼ (log scale)&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;12&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;title(&lt;span style="color:#e6db74"&gt;&amp;#39;æ¢¯åº¦çˆ†ç‚¸ç°è±¡ï¼šåºåˆ—é•¿åº¦å¯¹æ¢¯åº¦çš„å½±å“&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;14&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grid(&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;, alpha&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.3&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;show()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;demonstrate_exploding_gradient()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="33-å®é™…æ¡ˆä¾‹è¯­è¨€æ¨¡å‹è®­ç»ƒä¸­çš„æ¢¯åº¦ç›‘æ§"&gt;3.3 å®é™…æ¡ˆä¾‹ï¼šè¯­è¨€æ¨¡å‹è®­ç»ƒä¸­çš„æ¢¯åº¦ç›‘æ§&lt;/h3&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;GradientMonitor&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦ç›‘æ§å™¨&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self, model):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gradient_history &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layer_names &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è·å–æ‰€æœ‰éœ€è¦ç›‘æ§çš„å±‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; name, module &lt;span style="color:#f92672"&gt;in&lt;/span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;named_modules():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; isinstance(module, (nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;LSTM, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;GRU)):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layer_names&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(name)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;log_gradients&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è®°å½•å½“å‰æ—¶åˆ»å„å±‚çš„æ¢¯åº¦ç»Ÿè®¡ä¿¡æ¯&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; stats &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; name &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layer_names:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param_name, param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;named_parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; name &lt;span style="color:#f92672"&gt;in&lt;/span&gt; param_name &lt;span style="color:#f92672"&gt;and&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grad_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;norm()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grad_mean &lt;span style="color:#f92672"&gt;=&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;mean()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grad_std &lt;span style="color:#f92672"&gt;=&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;std()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; stats[&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;name&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;_&lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;param_name&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;norm&amp;#39;&lt;/span&gt;: grad_norm,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;mean&amp;#39;&lt;/span&gt;: grad_mean,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;std&amp;#39;&lt;/span&gt;: grad_std
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gradient_history&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(stats)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; stats
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;detect_gradient_issues&lt;/span&gt;(self, threshold_vanish&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-8&lt;/span&gt;, threshold_explode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10.0&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ£€æµ‹æ¢¯åº¦é—®é¢˜&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gradient_history:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; latest_stats &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gradient_history[&lt;span style="color:#f92672"&gt;-&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param_name, stats &lt;span style="color:#f92672"&gt;in&lt;/span&gt; latest_stats&lt;span style="color:#f92672"&gt;.&lt;/span&gt;items():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grad_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; stats[&lt;span style="color:#e6db74"&gt;&amp;#39;norm&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; grad_norm &lt;span style="color:#f92672"&gt;&amp;lt;&lt;/span&gt; threshold_vanish:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;æ¢¯åº¦æ¶ˆå¤±è­¦å‘Š: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;param_name&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt; = &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;grad_norm&lt;span style="color:#e6db74"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;.2e&lt;/span&gt;&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;elif&lt;/span&gt; grad_norm &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; threshold_explode:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;æ¢¯åº¦çˆ†ç‚¸è­¦å‘Š: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;param_name&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt; = &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;grad_norm&lt;span style="color:#e6db74"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;.2f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; issues &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; issues &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ä½¿ç”¨ç¤ºä¾‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;train_with_monitoring&lt;/span&gt;(model, train_loader, optimizer, criterion, epochs&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; monitor &lt;span style="color:#f92672"&gt;=&lt;/span&gt; GradientMonitor(model)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; epoch &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(epochs):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;train()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; batch_idx, (data, target) &lt;span style="color:#f92672"&gt;in&lt;/span&gt; enumerate(train_loader):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; criterion(output, target)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç›‘æ§æ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; grad_stats &lt;span style="color:#f92672"&gt;=&lt;/span&gt; monitor&lt;span style="color:#f92672"&gt;.&lt;/span&gt;log_gradients()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues &lt;span style="color:#f92672"&gt;=&lt;/span&gt; monitor&lt;span style="color:#f92672"&gt;.&lt;/span&gt;detect_gradient_issues()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; issues:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; print(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Epoch &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;epoch&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;, Batch &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;batch_idx&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;:&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; issue &lt;span style="color:#f92672"&gt;in&lt;/span&gt; issues:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; print(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34; - &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;issue&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åº”ç”¨æ¢¯åº¦è£å‰ªæ¥å¤„ç†æ¢¯åº¦çˆ†ç‚¸&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;utils&lt;span style="color:#f92672"&gt;.&lt;/span&gt;clip_grad_norm_(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_loss &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; print(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Epoch &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;epoch&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;, Average Loss: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;total_loss&lt;span style="color:#f92672"&gt;/&lt;/span&gt;len(train_loader)&lt;span style="color:#e6db74"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;.4f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="34-ä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦å¯¹æ¯”"&gt;3.4 ä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦å¯¹æ¯”&lt;/h3&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;compare_activation_gradients&lt;/span&gt;():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ¯”è¾ƒä¸åŒæ¿€æ´»å‡½æ•°çš„æ¢¯åº¦ç‰¹æ€§&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; activations &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;Sigmoid&amp;#39;&lt;/span&gt;: nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Sigmoid(),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;Tanh&amp;#39;&lt;/span&gt;: nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Tanh(),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ReLU&amp;#39;&lt;/span&gt;: nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ReLU(),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;LeakyReLU&amp;#39;&lt;/span&gt;: nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;LeakyReLU(&lt;span style="color:#ae81ff"&gt;0.01&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ELU&amp;#39;&lt;/span&gt;: nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ELU()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆ›å»ºæµ‹è¯•è¾“å…¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;linspace(&lt;span style="color:#f92672"&gt;-&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;1000&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;figure(figsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;15&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; i, (name, act) &lt;span style="color:#f92672"&gt;in&lt;/span&gt; enumerate(activations&lt;span style="color:#f92672"&gt;.&lt;/span&gt;items()):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è®¡ç®—æ¿€æ´»å€¼å’Œæ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;requires_grad_(&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; y &lt;span style="color:#f92672"&gt;=&lt;/span&gt; act(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; y&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sum()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç»˜åˆ¶æ¿€æ´»å‡½æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;subplot(&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;3&lt;/span&gt;, i&lt;span style="color:#f92672"&gt;+&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;plot(x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;detach()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;numpy(), y&lt;span style="color:#f92672"&gt;.&lt;/span&gt;detach()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;numpy(), &lt;span style="color:#e6db74"&gt;&amp;#39;b-&amp;#39;&lt;/span&gt;, linewidth&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;, label&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;æ¿€æ´»å‡½æ•°&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;plot(x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;detach()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;numpy(), x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;numpy(), &lt;span style="color:#e6db74"&gt;&amp;#39;r--&amp;#39;&lt;/span&gt;, linewidth&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;, label&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;æ¢¯åº¦&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;title(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;&lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;name&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt; å‡½æ•°åŠå…¶æ¢¯åº¦&amp;#39;&lt;/span&gt;, fontsize&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;12&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;xlabel(&lt;span style="color:#e6db74"&gt;&amp;#39;è¾“å…¥å€¼&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ylabel(&lt;span style="color:#e6db74"&gt;&amp;#39;è¾“å‡ºå€¼/æ¢¯åº¦å€¼&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;legend()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grid(&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;, alpha&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.3&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# é‡ç½®æ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;tight_layout()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; plt&lt;span style="color:#f92672"&gt;.&lt;/span&gt;show()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;compare_activation_gradients()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®è§‚å¯Ÿ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sigmoid/Tanh&lt;/strong&gt;: æ¢¯åº¦åœ¨é¥±å’ŒåŒºåŸŸæ¥è¿‘0ï¼Œå®¹æ˜“å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ReLU&lt;/strong&gt;: å¯¹äºæ­£è¾“å…¥ï¼Œæ¢¯åº¦æ’ä¸º1ï¼Œæœ‰æ•ˆç¼“è§£æ¢¯åº¦æ¶ˆå¤±&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LeakyReLU/ELU&lt;/strong&gt;: è´ŸåŒºåŸŸä¹Ÿæœ‰éé›¶æ¢¯åº¦ï¼Œè¿›ä¸€æ­¥æ”¹å–„æ¢¯åº¦æµåŠ¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å››ç°ä»£è§£å†³æ–¹æ¡ˆä»æ¶æ„è®¾è®¡åˆ°ä¼˜åŒ–æŠ€æœ¯"&gt;å››ã€ç°ä»£è§£å†³æ–¹æ¡ˆï¼šä»æ¶æ„è®¾è®¡åˆ°ä¼˜åŒ–æŠ€æœ¯&lt;/h2&gt;
&lt;h3 id="41-æ¶æ„å±‚é¢çš„è§£å†³æ–¹æ¡ˆ"&gt;4.1 æ¶æ„å±‚é¢çš„è§£å†³æ–¹æ¡ˆ&lt;/h3&gt;
&lt;h4 id="411-æ®‹å·®è¿æ¥resnet"&gt;4.1.1 æ®‹å·®è¿æ¥ï¼ˆResNetï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€æƒ³&lt;/strong&gt;ï¼šé€šè¿‡è·³è·ƒè¿æ¥è®©æ¢¯åº¦ç›´æ¥å›ä¼ åˆ°æµ…å±‚ï¼Œé¿å…è¿ä¹˜è¡°å‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ•°å­¦åŸç†&lt;/strong&gt;ï¼š
å¯¹äºä¼ ç»Ÿç½‘ç»œå±‚ï¼š$y = \sigma(Wx + b)$&lt;/p&gt;
&lt;p&gt;å¯¹äºæ®‹å·®å—ï¼š$y = \sigma(Wx + b) + x$&lt;/p&gt;
&lt;p&gt;æ¢¯åº¦è®¡ç®—ï¼š
$$\frac{\partial \mathcal{L}}{\partial x} = \frac{\partial \mathcal{L}}{\partial y} \cdot \frac{\partial y}{\partial x} = \frac{\partial \mathcal{L}}{\partial y} \cdot (W^T \text{diag}(\sigma&amp;rsquo;(z)) + I)$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³é”®ä¼˜åŠ¿&lt;/strong&gt;ï¼šå³ä½¿ $W^T \text{diag}(\sigma&amp;rsquo;(z))$ å¾ˆå°ï¼Œå•ä½çŸ©é˜µ $I$ ç¡®ä¿äº†æ¢¯åº¦è‡³å°‘ä¸º $\frac{\partial \mathcal{L}}{\partial y}$ã€‚&lt;/p&gt;
&lt;h4 id="412-é—¨æ§æœºåˆ¶lstmgru"&gt;4.1.2 é—¨æ§æœºåˆ¶ï¼ˆLSTM/GRUï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;LSTM çš„é—å¿˜é—¨&lt;/strong&gt;ï¼š
$$f_t = \sigma(W_f \cdot [h_{t-1}, x_t] + b_f)$$
$$i_t = \sigma(W_i \cdot [h_{t-1}, x_t] + b_i)$$
$$\tilde{C}&lt;em&gt;t = \tanh(W_C \cdot [h&lt;/em&gt;{t-1}, x_t] + b_C)$$
$$C_t = f_t \odot C_{t-1} + i_t \odot \tilde{C}_t$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¢¯åº¦åˆ†æ&lt;/strong&gt;ï¼š
LSTM é€šè¿‡åŠ æ³•è¿ç®—æ›¿ä»£ä¹˜æ³•è¿ç®—ï¼Œå¤§å¤§æ”¹å–„äº†æ¢¯åº¦æµåŠ¨ï¼š
$$\frac{\partial C_t}{\partial C_{t-1}} = f_t$$&lt;/p&gt;
&lt;p&gt;ç”±äº $f_t$ æ˜¯é—¨æ§å€¼ï¼ˆ0åˆ°1ä¹‹é—´ï¼‰ï¼Œæ¢¯åº¦è¦ä¹ˆå®Œå…¨ä¿ç•™ï¼Œè¦ä¹ˆå®Œå…¨è¡°å‡ï¼Œé¿å…äº†æŒ‡æ•°çº§è¡°å‡ã€‚&lt;/p&gt;
&lt;h4 id="413-transformer-æ¶æ„"&gt;4.1.3 Transformer æ¶æ„&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;è‡ªæ³¨æ„åŠ›æœºåˆ¶&lt;/strong&gt;ï¼š
$$\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¢¯åº¦ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ²¡æœ‰é€’å½’è¿æ¥ï¼Œé¿å…äº†æ¢¯åº¦è¿ä¹˜é—®é¢˜&lt;/li&gt;
&lt;li&gt;æ®‹å·®è¿æ¥ç¡®ä¿æ¢¯åº¦æµåŠ¨&lt;/li&gt;
&lt;li&gt;å±‚å½’ä¸€åŒ–ç¨³å®šè®­ç»ƒè¿‡ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="42-ä¼˜åŒ–ç®—æ³•å±‚é¢çš„è§£å†³æ–¹æ¡ˆ"&gt;4.2 ä¼˜åŒ–ç®—æ³•å±‚é¢çš„è§£å†³æ–¹æ¡ˆ&lt;/h3&gt;
&lt;h4 id="421-è‡ªé€‚åº”ä¼˜åŒ–å™¨"&gt;4.2.1 è‡ªé€‚åº”ä¼˜åŒ–å™¨&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Adam ä¼˜åŒ–å™¨&lt;/strong&gt;ï¼š
$$m_t = \beta_1 m_{t-1} + (1 - \beta_1) g_t$$
$$v_t = \beta_2 v_{t-1} + (1 - \beta_2) g_t^2$$
$$\hat{m}_t = \frac{m_t}{1 - \beta_1^t}$$
$$\hat{v}&lt;em&gt;t = \frac{v_t}{1 - \beta_2^t}$$
$$\theta&lt;/em&gt;{t+1} = \theta_t - \frac{\eta}{\sqrt{\hat{v}_t} + \epsilon} \hat{m}_t$$&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŠ¿&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªé€‚åº”å­¦ä¹ ç‡ç¼“è§£å°æ¢¯åº¦é—®é¢˜&lt;/li&gt;
&lt;li&gt;åŠ¨é‡é¡¹æœ‰åŠ©äºè·³å‡ºå±€éƒ¨æœ€ä¼˜&lt;/li&gt;
&lt;li&gt;å¯¹æ¢¯åº¦ç¼©æ”¾ä¸æ•æ„Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="422-æ¢¯åº¦è£å‰ªæŠ€æœ¯"&gt;4.2.2 æ¢¯åº¦è£å‰ªæŠ€æœ¯&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;å®ç°ä»£ç &lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;gradient_clipping&lt;/span&gt;(parameters, max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; æ¢¯åº¦è£å‰ªå®ç°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; :param parameters: æ¨¡å‹å‚æ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; :param max_norm: æœ€å¤§æ¢¯åº¦èŒƒæ•°
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#e6db74"&gt; &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;norm(torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;stack([torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;norm(p&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad) &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; p &lt;span style="color:#f92672"&gt;in&lt;/span&gt; parameters &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; p&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;]))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; total_norm &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; max_norm:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scale_factor &lt;span style="color:#f92672"&gt;=&lt;/span&gt; max_norm &lt;span style="color:#f92672"&gt;/&lt;/span&gt; (total_norm &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1e-6&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; p &lt;span style="color:#f92672"&gt;in&lt;/span&gt; parameters:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; p&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; p&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;mul_(scale_factor)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; total_norm
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ä½¿ç”¨ç¤ºä¾‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;current_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; gradient_clipping(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;print(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Clipped gradient norm: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;current_norm&lt;span style="color:#e6db74"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;.4f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="423-ç°ä»£å½’ä¸€åŒ–æŠ€æœ¯"&gt;4.2.3 ç°ä»£å½’ä¸€åŒ–æŠ€æœ¯&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;Layer Normalization&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;LayerNorm&lt;/span&gt;(nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self, features, eps&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-6&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; super()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gamma &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Parameter(torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ones(features))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;beta &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Parameter(torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zeros(features))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;eps &lt;span style="color:#f92672"&gt;=&lt;/span&gt; eps
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; mean &lt;span style="color:#f92672"&gt;=&lt;/span&gt; x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;mean(&lt;span style="color:#f92672"&gt;-&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;, keepdim&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std &lt;span style="color:#f92672"&gt;=&lt;/span&gt; x&lt;span style="color:#f92672"&gt;.&lt;/span&gt;std(&lt;span style="color:#f92672"&gt;-&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;, keepdim&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;gamma &lt;span style="color:#f92672"&gt;*&lt;/span&gt; (x &lt;span style="color:#f92672"&gt;-&lt;/span&gt; mean) &lt;span style="color:#f92672"&gt;/&lt;/span&gt; (std &lt;span style="color:#f92672"&gt;+&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;eps) &lt;span style="color:#f92672"&gt;+&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;beta&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;æ¢¯åº¦ç¨³å®šæœºåˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘å†…éƒ¨åå˜é‡åç§»ï¼ˆInternal Covariate Shiftï¼‰&lt;/li&gt;
&lt;li&gt;ç¨³å®šæ¯å±‚çš„è¾“å…¥åˆ†å¸ƒ&lt;/li&gt;
&lt;li&gt;å…è®¸ä½¿ç”¨æ›´é«˜çš„å­¦ä¹ ç‡&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="43-åˆå§‹åŒ–ç­–ç•¥"&gt;4.3 åˆå§‹åŒ–ç­–ç•¥&lt;/h3&gt;
&lt;h4 id="431-xavierglorot-åˆå§‹åŒ–"&gt;4.3.1 Xavier/Glorot åˆå§‹åŒ–&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šä¿æŒè¾“å…¥å’Œè¾“å‡ºçš„æ–¹å·®ä¸€è‡´ã€‚&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;xavier_init&lt;/span&gt;(layer):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; isinstance(layer, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; fan_in &lt;span style="color:#f92672"&gt;=&lt;/span&gt; layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;weight&lt;span style="color:#f92672"&gt;.&lt;/span&gt;size(&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; fan_out &lt;span style="color:#f92672"&gt;=&lt;/span&gt; layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;weight&lt;span style="color:#f92672"&gt;.&lt;/span&gt;size(&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init&lt;span style="color:#f92672"&gt;.&lt;/span&gt;xavier_uniform_(layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;weight, gain&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zeros_(layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;bias)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ä½¿ç”¨ç¤ºä¾‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Sequential(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear(&lt;span style="color:#ae81ff"&gt;784&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;512&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ReLU(),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear(&lt;span style="color:#ae81ff"&gt;512&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;256&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ReLU(),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear(&lt;span style="color:#ae81ff"&gt;256&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;apply(xavier_init)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="432-he-åˆå§‹åŒ–"&gt;4.3.2 He åˆå§‹åŒ–&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;é’ˆå¯¹ ReLU æ¿€æ´»å‡½æ•°çš„ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;he_init&lt;/span&gt;(layer):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; isinstance(layer, nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Linear):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init&lt;span style="color:#f92672"&gt;.&lt;/span&gt;kaiming_normal_(layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;weight, mode&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;fan_in&amp;#39;&lt;/span&gt;, nonlinearity&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zeros_(layer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;bias)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ReLU ç½‘ç»œæ¨èä½¿ç”¨ He åˆå§‹åŒ–&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;apply(he_init)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="44-å®è·µè°ƒä¼˜ç­–ç•¥"&gt;4.4 å®è·µè°ƒä¼˜ç­–ç•¥&lt;/h3&gt;
&lt;h4 id="441-å­¦ä¹ ç‡è°ƒåº¦"&gt;4.4.1 å­¦ä¹ ç‡è°ƒåº¦&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;from&lt;/span&gt; torch.optim.lr_scheduler &lt;span style="color:#f92672"&gt;import&lt;/span&gt; OneCycleLR, CosineAnnealingLR
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;create_optimizer_and_scheduler&lt;/span&gt;(model, train_loader, epochs&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;50&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;optim&lt;span style="color:#f92672"&gt;.&lt;/span&gt;AdamW(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), lr&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-3&lt;/span&gt;, weight_decay&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.01&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# OneCycle å­¦ä¹ ç‡è°ƒåº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scheduler &lt;span style="color:#f92672"&gt;=&lt;/span&gt; OneCycleLR(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; max_lr&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-3&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; epochs&lt;span style="color:#f92672"&gt;=&lt;/span&gt;epochs,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; steps_per_epoch&lt;span style="color:#f92672"&gt;=&lt;/span&gt;len(train_loader),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pct_start&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.3&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; anneal_strategy&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;cos&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; optimizer, scheduler
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# è®­ç»ƒå¾ªç¯ä¸­ä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;optimizer, scheduler &lt;span style="color:#f92672"&gt;=&lt;/span&gt; create_optimizer_and_scheduler(model, train_loader)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; epoch &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(epochs):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; batch_idx, (data, target) &lt;span style="color:#f92672"&gt;in&lt;/span&gt; enumerate(train_loader):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; criterion(output, target)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ¢¯åº¦è£å‰ª&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;utils&lt;span style="color:#f92672"&gt;.&lt;/span&gt;clip_grad_norm_(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scheduler&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="442-æ¢¯åº¦ç´¯ç§¯"&gt;4.4.2 æ¢¯åº¦ç´¯ç§¯&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;train_with_gradient_accumulation&lt;/span&gt;(model, train_loader, optimizer, criterion,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; accumulation_steps&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;4&lt;/span&gt;, epochs&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;train()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; epoch &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(epochs):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; batch_idx, (data, target) &lt;span style="color:#f92672"&gt;in&lt;/span&gt; enumerate(train_loader):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; criterion(output, target) &lt;span style="color:#f92672"&gt;/&lt;/span&gt; accumulation_steps
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (batch_idx &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;) &lt;span style="color:#f92672"&gt;%&lt;/span&gt; accumulation_steps &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ¢¯åº¦è£å‰ª&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;utils&lt;span style="color:#f92672"&gt;.&lt;/span&gt;clip_grad_norm_(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; batch_idx &lt;span style="color:#f92672"&gt;%&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;100&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; print(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Epoch &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;epoch&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;, Batch &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;batch_idx&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;, Loss: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item() &lt;span style="color:#f92672"&gt;*&lt;/span&gt; accumulation_steps&lt;span style="color:#e6db74"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;.4f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="45-ç°ä»£æ¡†æ¶çš„æ¢¯åº¦å¤„ç†"&gt;4.5 ç°ä»£æ¡†æ¶çš„æ¢¯åº¦å¤„ç†&lt;/h3&gt;
&lt;h4 id="451-æ··åˆç²¾åº¦è®­ç»ƒ"&gt;4.5.1 æ··åˆç²¾åº¦è®­ç»ƒ&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;from&lt;/span&gt; torch.cuda.amp &lt;span style="color:#f92672"&gt;import&lt;/span&gt; autocast, GradScaler
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;mixed_precision_training&lt;/span&gt;(model, train_loader, optimizer, criterion, epochs&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scaler &lt;span style="color:#f92672"&gt;=&lt;/span&gt; GradScaler()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; epoch &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(epochs):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;train()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; data, target &lt;span style="color:#f92672"&gt;in&lt;/span&gt; train_loader:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è‡ªåŠ¨æ··åˆç²¾åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;with&lt;/span&gt; autocast():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; criterion(output, target)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ç¼©æ”¾æŸå¤±ä»¥é¿å…æ¢¯åº¦ä¸‹æº¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scaler&lt;span style="color:#f92672"&gt;.&lt;/span&gt;scale(loss)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ¢¯åº¦è£å‰ª&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scaler&lt;span style="color:#f92672"&gt;.&lt;/span&gt;unscale_(optimizer)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;utils&lt;span style="color:#f92672"&gt;.&lt;/span&gt;clip_grad_norm_(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ›´æ–°å‚æ•°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scaler&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step(optimizer)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; scaler&lt;span style="color:#f92672"&gt;.&lt;/span&gt;update()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_loss &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; print(&lt;span style="color:#e6db74"&gt;f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;Epoch &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;epoch&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;, Average Loss: &lt;/span&gt;&lt;span style="color:#e6db74"&gt;{&lt;/span&gt;total_loss&lt;span style="color:#f92672"&gt;/&lt;/span&gt;len(train_loader)&lt;span style="color:#e6db74"&gt;:&lt;/span&gt;&lt;span style="color:#e6db74"&gt;.4f&lt;/span&gt;&lt;span style="color:#e6db74"&gt;}&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="452-åˆ†å¸ƒå¼è®­ç»ƒä¸­çš„æ¢¯åº¦å¤„ç†"&gt;4.5.2 åˆ†å¸ƒå¼è®­ç»ƒä¸­çš„æ¢¯åº¦å¤„ç†&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch.distributed &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; dist
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; torch.multiprocessing &lt;span style="color:#66d9ef"&gt;as&lt;/span&gt; mp
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;train_distributed&lt;/span&gt;(rank, world_size):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åˆå§‹åŒ–è¿›ç¨‹ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; dist&lt;span style="color:#f92672"&gt;.&lt;/span&gt;init_process_group(&lt;span style="color:#e6db74"&gt;&amp;#34;nccl&amp;#34;&lt;/span&gt;, rank&lt;span style="color:#f92672"&gt;=&lt;/span&gt;rank, world_size&lt;span style="color:#f92672"&gt;=&lt;/span&gt;world_size)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è®¾ç½®æ¨¡å‹å’Œæ•°æ®åŠ è½½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; create_model()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;to(rank)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parallel&lt;span style="color:#f92672"&gt;.&lt;/span&gt;DistributedDataParallel(model, device_ids&lt;span style="color:#f92672"&gt;=&lt;/span&gt;[rank])
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; train_loader &lt;span style="color:#f92672"&gt;=&lt;/span&gt; create_dataloader(rank, world_size)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;optim&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Adam(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), lr&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-3&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; epoch &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(epochs):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;train()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; data, target &lt;span style="color:#f92672"&gt;in&lt;/span&gt; train_loader:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; data, target &lt;span style="color:#f92672"&gt;=&lt;/span&gt; data&lt;span style="color:#f92672"&gt;.&lt;/span&gt;to(rank), target&lt;span style="color:#f92672"&gt;.&lt;/span&gt;to(rank)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; criterion(output, target)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ¢¯åº¦è£å‰ª&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;utils&lt;span style="color:#f92672"&gt;.&lt;/span&gt;clip_grad_norm_(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# åŒæ­¥æ‰€æœ‰è¿›ç¨‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; dist&lt;span style="color:#f92672"&gt;.&lt;/span&gt;barrier()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; dist&lt;span style="color:#f92672"&gt;.&lt;/span&gt;destroy_process_group()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="äº”å‰æ²¿è¿›å±•ä¸æœªæ¥å±•æœ›"&gt;äº”ã€å‰æ²¿è¿›å±•ä¸æœªæ¥å±•æœ›&lt;/h2&gt;
&lt;h3 id="51-å¤§è¯­è¨€æ¨¡å‹ä¸­çš„æ¢¯åº¦æŒ‘æˆ˜"&gt;5.1 å¤§è¯­è¨€æ¨¡å‹ä¸­çš„æ¢¯åº¦æŒ‘æˆ˜&lt;/h3&gt;
&lt;p&gt;éšç€æ¨¡å‹è§„æ¨¡çš„å¿«é€Ÿå¢é•¿ï¼Œæ¢¯åº¦é—®é¢˜å‘ˆç°å‡ºæ–°çš„æŒ‘æˆ˜ï¼š&lt;/p&gt;
&lt;h4 id="511-è¶…å¤§è§„æ¨¡æ¨¡å‹çš„æ¢¯åº¦é—®é¢˜"&gt;5.1.1 è¶…å¤§è§„æ¨¡æ¨¡å‹çš„æ¢¯åº¦é—®é¢˜&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;ç°è±¡&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¢¯åº¦å™ªå£°å¢åŠ ï¼šæ¨¡å‹å‚æ•°é‡è¾¾åˆ°ç™¾äº¿çº§åˆ«æ—¶ï¼Œæ¢¯åº¦ä¼°è®¡çš„ä¸ç¡®å®šæ€§å¢åŠ &lt;/li&gt;
&lt;li&gt;æ¢¯åº¦æ–¹å‘ä¸ä¸€è‡´ï¼šä¸åŒå±‚çš„æ¢¯åº¦å¯èƒ½æŒ‡å‘ç›¸åçš„æ–¹å‘&lt;/li&gt;
&lt;li&gt;å†…å­˜é™åˆ¶ï¼šæ¢¯åº¦ç´¯ç§¯å’Œåå‘ä¼ æ’­çš„å†…å­˜æ¶ˆè€—å·¨å¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# ZeRO ä¼˜åŒ–å™¨ç¤ºä¾‹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;from&lt;/span&gt; deepspeed &lt;span style="color:#f92672"&gt;import&lt;/span&gt; zero
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;configure_zero_optimizer&lt;/span&gt;(model, stage&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;é…ç½®ZeROä¼˜åŒ–å™¨&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;optim&lt;span style="color:#f92672"&gt;.&lt;/span&gt;AdamW(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), lr&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-3&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# Zero Redundancy Optimizer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer &lt;span style="color:#f92672"&gt;=&lt;/span&gt; zero&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Init(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; optimizer,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; zero_stage&lt;span style="color:#f92672"&gt;=&lt;/span&gt;stage, &lt;span style="color:#75715e"&gt;# Stage 2: åˆ†åŒºä¼˜åŒ–å™¨çŠ¶æ€+æ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; reduce_bucket_size&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5e7&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; allgather_bucket_size&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;5e7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; optimizer&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="512-æ¢¯åº¦æ£€æŸ¥ç‚¹gradient-checkpointing"&gt;5.1.2 æ¢¯åº¦æ£€æŸ¥ç‚¹ï¼ˆGradient Checkpointingï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;åŸç†&lt;/strong&gt;ï¼šé€šè¿‡ç‰ºç‰²è®¡ç®—æ—¶é—´æ¢å–å†…å­˜ç©ºé—´ï¼Œåœ¨åå‘ä¼ æ’­æ—¶é‡æ–°è®¡ç®—å‰å‘ä¼ æ’­çš„ç»“æœã€‚&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;from&lt;/span&gt; torch.utils.checkpoint &lt;span style="color:#f92672"&gt;import&lt;/span&gt; checkpoint
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CheckpointBlock&lt;/span&gt;(nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self, layers):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; super()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layers &lt;span style="color:#f92672"&gt;=&lt;/span&gt; layers
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ä½¿ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; checkpoint(self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;_forward_impl, x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_forward_impl&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; layer &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layers:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x &lt;span style="color:#f92672"&gt;=&lt;/span&gt; layer(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; x
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# åœ¨å¤§æ¨¡å‹ä¸­çš„åº”ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;create_large_model_with_checkpoint&lt;/span&gt;(num_layers&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;24&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layers &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; i &lt;span style="color:#f92672"&gt;in&lt;/span&gt; range(num_layers):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layer &lt;span style="color:#f92672"&gt;=&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;TransformerEncoderLayer(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; d_model&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;768&lt;/span&gt;, nhead&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;8&lt;/span&gt;, dim_feedforward&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;3072&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; )
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layers&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(CheckpointBlock(nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;ModuleList([layer])))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;Sequential(&lt;span style="color:#f92672"&gt;*&lt;/span&gt;layers)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="52-è‡ªé€‚åº”æ¢¯åº¦æŠ€æœ¯"&gt;5.2 è‡ªé€‚åº”æ¢¯åº¦æŠ€æœ¯&lt;/h3&gt;
&lt;h4 id="521-å±‚è‡ªé€‚åº”å­¦ä¹ ç‡"&gt;5.2.1 å±‚è‡ªé€‚åº”å­¦ä¹ ç‡&lt;/h4&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;LayerAdaptiveOptimizer&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__init__&lt;/span&gt;(self, model, base_lr&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1e-3&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_lr &lt;span style="color:#f92672"&gt;=&lt;/span&gt; base_lr
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layer_lrs &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;_compute_layer_lrs()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;_compute_layer_lrs&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è®¡ç®—å„å±‚çš„è‡ªé€‚åº”å­¦ä¹ ç‡&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layer_lrs &lt;span style="color:#f92672"&gt;=&lt;/span&gt; {}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; name, param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;named_parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ ¹æ®å±‚çš„æ·±åº¦è°ƒæ•´å­¦ä¹ ç‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;transformer&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;in&lt;/span&gt; name:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layer_num &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;_extract_layer_num(name)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ·±å±‚ä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lr_factor &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt; &lt;span style="color:#f92672"&gt;/&lt;/span&gt; (layer_num &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;) &lt;span style="color:#f92672"&gt;**&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0.5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layer_lrs[name] &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_lr &lt;span style="color:#f92672"&gt;*&lt;/span&gt; lr_factor
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layer_lrs[name] &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;base_lr
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; layer_lrs
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;step&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ‰§è¡Œå‚æ•°æ›´æ–°&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; name, param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;named_parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; lr &lt;span style="color:#f92672"&gt;=&lt;/span&gt; self&lt;span style="color:#f92672"&gt;.&lt;/span&gt;layer_lrs[name]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;data &lt;span style="color:#f92672"&gt;-=&lt;/span&gt; lr &lt;span style="color:#f92672"&gt;*&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;data&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="522-æ¢¯åº¦å™ªå£°æ³¨å…¥"&gt;5.2.2 æ¢¯åº¦å™ªå£°æ³¨å…¥&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šæ”¹å–„æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œé¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;gradient_noise_injection&lt;/span&gt;(model, noise_scale&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.01&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;å‘æ¢¯åº¦ä¸­æ³¨å…¥å™ªå£°&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# é«˜æ–¯å™ªå£°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; noise &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;randn_like(param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad) &lt;span style="color:#f92672"&gt;*&lt;/span&gt; noise_scale
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; noise
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# è®­ç»ƒä¸­ä½¿ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# æ³¨å…¥æ¢¯åº¦å™ªå£°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;gradient_noise_injection(model, noise_scale&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;0.01&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# æ¢¯åº¦è£å‰ª&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;nn&lt;span style="color:#f92672"&gt;.&lt;/span&gt;utils&lt;span style="color:#f92672"&gt;.&lt;/span&gt;clip_grad_norm_(model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters(), max_norm&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1.0&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;optimizer&lt;span style="color:#f92672"&gt;.&lt;/span&gt;step()&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id="53-æ–°å…´ç ”ç©¶æ–¹å‘"&gt;5.3 æ–°å…´ç ”ç©¶æ–¹å‘&lt;/h3&gt;
&lt;h4 id="531-ç¥ç»æ¶æ„æœç´¢nasä¸­çš„æ¢¯åº¦ä¼˜åŒ–"&gt;5.3.1 ç¥ç»æ¶æ„æœç´¢ï¼ˆNASï¼‰ä¸­çš„æ¢¯åº¦ä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;è‡ªåŠ¨æœç´¢æœ€ä½³æ¢¯åº¦æµæ¶æ„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;search_gradient_friendly_architecture&lt;/span&gt;(search_space, eval_epochs&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æœç´¢å¯¹æ¢¯åº¦å‹å¥½çš„æ¶æ„&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; best_architecture &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; best_gradient_score &lt;span style="color:#f92672"&gt;=&lt;/span&gt; float(&lt;span style="color:#e6db74"&gt;&amp;#39;-inf&amp;#39;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; arch &lt;span style="color:#f92672"&gt;in&lt;/span&gt; search_space:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ„å»ºå€™é€‰æ¶æ„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model &lt;span style="color:#f92672"&gt;=&lt;/span&gt; build_model(arch)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è¯„ä¼°æ¢¯åº¦æµåŠ¨æ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradient_score &lt;span style="color:#f92672"&gt;=&lt;/span&gt; evaluate_gradient_flow(model)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; gradient_score &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; best_gradient_score:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; best_gradient_score &lt;span style="color:#f92672"&gt;=&lt;/span&gt; gradient_score
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; best_architecture &lt;span style="color:#f92672"&gt;=&lt;/span&gt; arch
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; best_architecture
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;evaluate_gradient_flow&lt;/span&gt;(model):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;è¯„ä¼°æ¨¡å‹çš„æ¢¯åº¦æµåŠ¨æ€§èƒ½&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; x &lt;span style="color:#f92672"&gt;=&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;randn(&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; y &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; y&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sum()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è®¡ç®—æ¢¯åº¦ç»Ÿè®¡é‡&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradient_norms &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradient_norms&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;norm()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item())
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ¢¯åº¦åˆ†æ•°ï¼šå¹³å‡æ¢¯åº¦èŒƒæ•° + æ¢¯åº¦ç¨³å®šæ€§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; avg_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; np&lt;span style="color:#f92672"&gt;.&lt;/span&gt;mean(gradient_norms)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; std_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; np&lt;span style="color:#f92672"&gt;.&lt;/span&gt;std(gradient_norms)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æœŸæœ›ï¼šè¾ƒå¤§çš„å¹³å‡æ¢¯åº¦ + è¾ƒå°çš„æ ‡å‡†å·®&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradient_score &lt;span style="color:#f92672"&gt;=&lt;/span&gt; avg_norm &lt;span style="color:#f92672"&gt;/&lt;/span&gt; (std_norm &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1e-6&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; gradient_score&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="532-é‡å­æ¢¯åº¦ä¼˜åŒ–"&gt;5.3.2 é‡å­æ¢¯åº¦ä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;å‰æ²¿æ¢ç´¢&lt;/strong&gt;ï¼šåˆ©ç”¨é‡å­è®¡ç®—ä¼˜åŒ–æ¢¯åº¦è®¡ç®—è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# æ¦‚å¿µæ€§ä»£ç ï¼ˆå®é™…å®ç°éœ€è¦é‡å­è®¡ç®—ç¡¬ä»¶ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;quantum_gradient_estimation&lt;/span&gt;(circuit, parameters):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;é‡å­æ¢¯åº¦ä¼°è®¡&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# å‚æ•°ç§»ä½è§„åˆ™è®¡ç®—æ¢¯åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradients &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; epsilon &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0.01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; i, param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; enumerate(parameters):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# æ­£å‘ç§»ä½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; parameters_plus &lt;span style="color:#f92672"&gt;=&lt;/span&gt; parameters&lt;span style="color:#f92672"&gt;.&lt;/span&gt;copy()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; parameters_plus[i] &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; epsilon
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; expectation_plus &lt;span style="color:#f92672"&gt;=&lt;/span&gt; quantum_expectation(circuit, parameters_plus)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# è´Ÿå‘ç§»ä½&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; parameters_minus &lt;span style="color:#f92672"&gt;=&lt;/span&gt; parameters&lt;span style="color:#f92672"&gt;.&lt;/span&gt;copy()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; parameters_minus[i] &lt;span style="color:#f92672"&gt;-=&lt;/span&gt; epsilon
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; expectation_minus &lt;span style="color:#f92672"&gt;=&lt;/span&gt; quantum_expectation(circuit, parameters_minus)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# ä¸­å¿ƒå·®åˆ†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradient &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (expectation_plus &lt;span style="color:#f92672"&gt;-&lt;/span&gt; expectation_minus) &lt;span style="color:#f92672"&gt;/&lt;/span&gt; (&lt;span style="color:#ae81ff"&gt;2&lt;/span&gt; &lt;span style="color:#f92672"&gt;*&lt;/span&gt; epsilon)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradients&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(gradient)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; gradients&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="å…­æ€»ç»“ä¸æœ€ä½³å®è·µ"&gt;å…­ã€æ€»ç»“ä¸æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;h3 id="61-æ ¸å¿ƒè¦ç‚¹å›é¡¾"&gt;6.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ•°å­¦æœ¬è´¨&lt;/strong&gt;ï¼šæ¢¯åº¦æ¶ˆå¤±å’Œçˆ†ç‚¸çš„æ ¹æºåœ¨äºåå‘ä¼ æ’­ä¸­æ¢¯åº¦çš„è¿ä¹˜æ“ä½œ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¶æ„æ¼”è¿›&lt;/strong&gt;ï¼šä» RNN â†’ LSTM â†’ Transformer çš„æ¼”è¿›è¿‡ç¨‹å°±æ˜¯è§£å†³æ¢¯åº¦é—®é¢˜çš„è¿‡ç¨‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç°ä»£æ–¹æ¡ˆ&lt;/strong&gt;ï¼šæ®‹å·®è¿æ¥ã€å±‚å½’ä¸€åŒ–ã€è‡ªé€‚åº”ä¼˜åŒ–å™¨ã€æ¢¯åº¦è£å‰ªç­‰æŠ€æœ¯çš„ç»„åˆåº”ç”¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å·¥ç¨‹å®è·µ&lt;/strong&gt;ï¼šæ¢¯åº¦ç›‘æ§ã€å­¦ä¹ ç‡è°ƒåº¦ã€æ··åˆç²¾åº¦è®­ç»ƒç­‰å®ç”¨æŠ€å·§&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="62-å®è·µæŒ‡å—"&gt;6.2 å®è·µæŒ‡å—&lt;/h3&gt;
&lt;h4 id="621-é—®é¢˜è¯Šæ–­æ¸…å•"&gt;6.2.1 é—®é¢˜è¯Šæ–­æ¸…å•&lt;/h4&gt;
&lt;p&gt;åœ¨é‡åˆ°è®­ç»ƒå›°éš¾æ—¶ï¼ŒæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ£€æŸ¥æ¢¯åº¦é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class="highlight-container"&gt;
&lt;button class="copy-code-btn outline"&gt;Copy&lt;/button&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;diagnose_gradient_issues&lt;/span&gt;(model, data_loader):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ¢¯åº¦é—®é¢˜è¯Šæ–­æ¸…å•&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues &lt;span style="color:#f92672"&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 1. æ£€æŸ¥æ¢¯åº¦æ˜¯å¦æ¥è¿‘é›¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; avg_gradient_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; check_gradient_magnitude(model, data_loader)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; avg_gradient_norm &lt;span style="color:#f92672"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1e-8&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(&lt;span style="color:#e6db74"&gt;&amp;#34;ä¸¥é‡æ¢¯åº¦æ¶ˆå¤±&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 2. æ£€æŸ¥æ¢¯åº¦æ˜¯å¦è¿‡å¤§&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; max_gradient_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; check_gradient_explosion(model, data_loader)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; max_gradient_norm &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;100.0&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(&lt;span style="color:#e6db74"&gt;&amp;#34;æ¢¯åº¦çˆ†ç‚¸é£é™©&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 3. æ£€æŸ¥æ¢¯åº¦åˆ†å¸ƒ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; gradient_distribution &lt;span style="color:#f92672"&gt;=&lt;/span&gt; check_gradient_distribution(model, data_loader)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; gradient_distribution[&lt;span style="color:#e6db74"&gt;&amp;#39;std&amp;#39;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; gradient_distribution[&lt;span style="color:#e6db74"&gt;&amp;#39;mean&amp;#39;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;*&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;5&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(&lt;span style="color:#e6db74"&gt;&amp;#34;æ¢¯åº¦åˆ†å¸ƒä¸å‡åŒ€&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;# 4. æ£€æŸ¥ä¸åŒå±‚é—´çš„æ¢¯åº¦å·®å¼‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; layer_gradient_ratio &lt;span style="color:#f92672"&gt;=&lt;/span&gt; check_layer_gradient_ratio(model, data_loader)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; layer_gradient_ratio &lt;span style="color:#f92672"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;100.0&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; issues&lt;span style="color:#f92672"&gt;.&lt;/span&gt;append(&lt;span style="color:#e6db74"&gt;&amp;#34;å±‚é—´æ¢¯åº¦å·®å¼‚è¿‡å¤§&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; issues
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;check_gradient_magnitude&lt;/span&gt;(model, data_loader):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&amp;#34;æ£€æŸ¥æ¢¯åº¦å¤§å°&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_norm &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; count &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;eval()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;with&lt;/span&gt; torch&lt;span style="color:#f92672"&gt;.&lt;/span&gt;no_grad():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; data, _ &lt;span style="color:#f92672"&gt;in&lt;/span&gt; data_loader:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; output &lt;span style="color:#f92672"&gt;=&lt;/span&gt; model(data)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss &lt;span style="color:#f92672"&gt;=&lt;/span&gt; output&lt;span style="color:#f92672"&gt;.&lt;/span&gt;sum()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; loss&lt;span style="color:#f92672"&gt;.&lt;/span&gt;backward(retain_graph&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt; param &lt;span style="color:#f92672"&gt;in&lt;/span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad &lt;span style="color:#f92672"&gt;is&lt;/span&gt; &lt;span style="color:#f92672"&gt;not&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;None&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; total_norm &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; param&lt;span style="color:#f92672"&gt;.&lt;/span&gt;grad&lt;span style="color:#f92672"&gt;.&lt;/span&gt;norm()&lt;span style="color:#f92672"&gt;.&lt;/span&gt;item()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; count &lt;span style="color:#f92672"&gt;+=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; model&lt;span style="color:#f92672"&gt;.&lt;/span&gt;zero_grad()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;break&lt;/span&gt; &lt;span style="color:#75715e"&gt;# åªæ£€æŸ¥ç¬¬ä¸€ä¸ªbatch&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; total_norm &lt;span style="color:#f92672"&gt;/&lt;/span&gt; max(count, &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h4 id="622-è°ƒä¼˜ä¼˜å…ˆçº§"&gt;6.2.2 è°ƒä¼˜ä¼˜å…ˆçº§&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;é«˜ä¼˜å…ˆçº§&lt;/strong&gt;ï¼ˆå¿…é¡»å¤„ç†ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®æ–½æ¢¯åº¦è£å‰ªï¼ˆé˜²æ­¢è®­ç»ƒå´©æºƒï¼‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨é€‚å½“çš„æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ ReLU å˜ä½“ï¼‰&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨æ®‹å·®è¿æ¥ï¼ˆResNet/Transformerï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä¸­ä¼˜å…ˆçº§&lt;/strong&gt;ï¼ˆå»ºè®®å®æ–½ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è‡ªé€‚åº”ä¼˜åŒ–å™¨ï¼ˆAdam/AdamWï¼‰&lt;/li&gt;
&lt;li&gt;å®æ–½æ¢¯åº¦ç›‘æ§å’Œæ—¥å¿—è®°å½•&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨åˆé€‚çš„å­¦ä¹ ç‡è°ƒåº¦&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä½ä¼˜å…ˆçº§&lt;/strong&gt;ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ··åˆç²¾åº¦è®­ç»ƒ&lt;/li&gt;
&lt;li&gt;æ¢¯åº¦ç´¯ç§¯&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼è®­ç»ƒä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="63-æœªæ¥å±•æœ›"&gt;6.3 æœªæ¥å±•æœ›&lt;/h3&gt;
&lt;p&gt;æ¢¯åº¦é—®é¢˜çš„ç ”ç©¶æ­£åœ¨å‘ä»¥ä¸‹æ–¹å‘å‘å±•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è‡ªåŠ¨åŒ–ä¼˜åŒ–&lt;/strong&gt;ï¼šé€šè¿‡å¼ºåŒ–å­¦ä¹ å’Œå…ƒå­¦ä¹ è‡ªåŠ¨è°ƒæ•´æ¢¯åº¦å¤„ç†ç­–ç•¥&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯è§£é‡Šæ€§&lt;/strong&gt;ï¼šç†è§£æ¢¯åº¦æµä¸æ¨¡å‹æ€§èƒ½ä¹‹é—´çš„å…³ç³»&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¡¬ä»¶ååŒ&lt;/strong&gt;ï¼šè®¾è®¡ä¸“é—¨ç”¨äºæ¢¯åº¦è®¡ç®—çš„ç¡¬ä»¶åŠ é€Ÿå™¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç†è®ºçªç ´&lt;/strong&gt;ï¼šå»ºç«‹æ›´å®Œå–„çš„æ¢¯åº¦ä¼˜åŒ–ç†è®ºåŸºç¡€&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="64-ç»“è¯­"&gt;6.4 ç»“è¯­&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ¢¯åº¦æ¶ˆå¤±å’Œçˆ†ç‚¸çš„æœ¬è´¨æ˜¯ï¼šæ·±åº¦æˆ–é•¿åºåˆ—å¯¼è‡´åå‘ä¼ æ’­ä¸­çš„æ¢¯åº¦è¿ä¹˜é¡¹è¿‡å¤§æˆ–è¿‡å°ï¼Œä½¿å¾—ç½‘ç»œéš¾ä»¥æœ‰æ•ˆè®­ç»ƒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„é—®é¢˜ï¼Œæ¨åŠ¨äº†æ·±åº¦å­¦ä¹ ä»æµ…å±‚ç½‘ç»œåˆ°æ·±å±‚æ¶æ„ï¼Œä»ä¼ ç»ŸRNNåˆ°LSTM/GRUå†åˆ°Transformerçš„é©å‘½æ€§å‘å±•ã€‚ä»Šå¤©çš„å¤§è¯­è¨€æ¨¡å‹ã€å¤šæ¨¡æ€æ¨¡å‹ç­‰å¤æ‚ç³»ç»Ÿï¼Œå…¶æˆåŠŸçš„åŸºç¡€å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºå¯¹æ¢¯åº¦é—®é¢˜çš„æ·±åˆ»ç†è§£å’Œæœ‰æ•ˆè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;éšç€æ¨¡å‹è§„æ¨¡çš„ä¸æ–­æ‰©å¤§å’Œåº”ç”¨åœºæ™¯çš„æ—¥ç›Šå¤æ‚ï¼Œæ¢¯åº¦ä¼˜åŒ–å°†ç»§ç»­æ˜¯æ·±åº¦å­¦ä¹ ç ”ç©¶çš„æ ¸å¿ƒè¯¾é¢˜ã€‚æŒæ¡æ¢¯åº¦é—®é¢˜çš„åŸç†å’Œè§£å†³æ–¹æ¡ˆï¼Œä¸ä»…æ˜¯è®­ç»ƒæˆåŠŸæ¨¡å‹çš„å…³é”®ï¼Œæ›´æ˜¯ç†è§£æ·±åº¦å­¦ä¹ æœ¬è´¨çš„é‡è¦é€”å¾„ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ·±åº¦å­¦ä¹ çš„è‰ºæœ¯ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå°±æ˜¯ç†è§£å¹¶é©¾é©­æ¢¯åº¦çš„è‰ºæœ¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;</description></item></channel></rss>