<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Go test, how to play? - ✌yesplease's blog</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="yesplease"><meta name=description content="go 测试 go test 后面接着的应该是一个包名 go test 可以生成覆盖率的profile文件，这个文件可以被go tool cover工具解析(go tool cover -func=cover.out/go tool cover -html=cover.out) 1、Go top-level"><meta name=keywords content="yesplease,blog,technology"><meta name=generator content="Hugo 0.124.1"><link rel=canonical href=http://cugbtang.github.io/post/go/series-go-2/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css integrity="sha256-+ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media=screen crossorigin=anonymous><meta property="og:title" content="Go test, how to play?"><meta property="og:description" content="go 测试 go test 后面接着的应该是一个包名 go test 可以生成覆盖率的profile文件，这个文件可以被go tool cover工具解析(go tool cover -func=cover.out/go tool cover -html=cover.out) 1、Go top-level"><meta property="og:type" content="article"><meta property="og:url" content="http://cugbtang.github.io/post/go/series-go-2/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-01-04T16:01:23+08:00"><meta property="article:modified_time" content="2024-01-04T16:01:23+08:00"><meta itemprop=name content="Go test, how to play?"><meta itemprop=description content="go 测试 go test 后面接着的应该是一个包名 go test 可以生成覆盖率的profile文件，这个文件可以被go tool cover工具解析(go tool cover -func=cover.out/go tool cover -html=cover.out) 1、Go top-level"><meta itemprop=datePublished content="2024-01-04T16:01:23+08:00"><meta itemprop=dateModified content="2024-01-04T16:01:23+08:00"><meta itemprop=wordCount content="4501"><meta itemprop=keywords content="go,test,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go test, how to play?"><meta name=twitter:description content="go 测试 go test 后面接着的应该是一个包名 go test 可以生成覆盖率的profile文件，这个文件可以被go tool cover工具解析(go tool cover -func=cover.out/go tool cover -html=cover.out) 1、Go top-level"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>yesplease</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=http://cugbtang.github.io/>This is Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://cugbtang.github.io/post/>Archives</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://cugbtang.github.io/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://cugbtang.github.io/categories/>Categories</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://cugbtang.github.io/about/>About</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://github.com/cugbtang rel=noopener target=_blank>github
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>yesplease</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=http://cugbtang.github.io/>This is Home</a></li><li class=menu-item><a class=menu-item-link href=http://cugbtang.github.io/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=http://cugbtang.github.io/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=http://cugbtang.github.io/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=http://cugbtang.github.io/about/>About</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cugbtang rel=noopener target=_blank>github
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6 21.568 21.632 54.144 54.208 54.144 54.208C534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92.0.0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"/><path d="M841.152 457.152c-30.528.0-54.784 24.512-54.784 54.656V786.56H237.696V237.696h206.016c6.656.0 10.752.0 13.248.0 30.72.0 55.04-24.512 55.04-54.848C512 152.32 487.36 128 456.96 128H183.04C153.216 128 128 152.576 128 182.848c0 3.136.256 6.272.768 9.28C128.256 195.136 128 198.272 128 201.408v639.488c0 .064.0.192.0.256.0.128.0.192.0.32.0 30.528 24.512 54.784 54.784 54.784H829.76c6.592.0 9.728.0 11.712.0 28.736.0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344v-20.352V561.408v-49.28C896 481.792 871.424 457.152 841.152 457.152z"/></svg></i></a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>Go test, how to play?</h1><div class=post-meta><time datetime=2024-01-04 class=post-time>2024-01-04</time><div class=post-category><a href=http://cugbtang.github.io/categories/go/>go</a></div><span class=more-meta>4501 words </span><span class=more-meta>9 min read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Table of Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#1go-top-level-test>1、Go top-level test:</a></li><li><a href=#2go-17版本引入了subtest>2、Go 1.7版本引入了subtest！</a></li><li><a href=#3testify>3、testify</a></li><li><a href=#4test-double尽量使用fake-object而不是mock-object>4、Test Double(尽量使用fake object，而不是mock object)</a></li><li><a href=#5竞争检测race-detection>5、竞争检测(race detection)</a></li><li><a href=#6fuzz>6、fuzz</a></li><li><a href=#6使用场景>6、使用场景</a></li><li><a href=#引用>引用</a></li></ul></nav></div></div><div class=post-content><h1 id=go-测试>go 测试</h1><p>go test 后面接着的应该是一个包名
go test 可以生成覆盖率的profile文件，这个文件可以被go tool cover工具解析(go tool cover -func=cover.out/go tool cover -html=cover.out)</p><h2 id=1go-top-level-test>1、Go top-level test:</h2><ul><li><p>优点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>go test会将每个TestXxx放在单独的goroutine中执行，保持相互的隔离；
</span></span><span class=line><span class=cl>某个TestXxx用例未过，通过Errorf，甚至是Fatalf输出错误结果，都不会影响到其他TestXxx的执行；
</span></span><span class=line><span class=cl>某个TestXxx用例中的某个结果判断未过，如果通过Errorf输出错误结果，则该TestXxx会继续执行；
</span></span><span class=line><span class=cl>不过，如果TestXxx使用的是Fatal/Fatalf，这会导致该TestXxx的执行在调用Fatal/Fatalf的位置立即结束，TestXxx函数体内的后续测试代码将不会得到执行；
</span></span><span class=line><span class=cl>默认各个TestXxx按声明顺序逐一执行，即便它们是在各自的goroutine中执行的；
</span></span><span class=line><span class=cl>通过go test -shuffle=on可以让各个TestXxx按随机次序执行，这样可以检测出各个TestXxx之间是否存在执行顺序的依赖，我们要避免在测试代码中出现这种依赖；
</span></span><span class=line><span class=cl>通过“go test -run=正则式”的方式，可以选择执行某些TestXxx。
</span></span><span class=line><span class=cl>各个TestXxx函数可以调用t.Parallel方法(即testing.T.Parallel方法)来将TestXxx加入到可并行执行的用例集合中，注意：加入到并行执行集合后，这些TestXxx的执行顺序就不确定了。
</span></span></code></pre></td></tr></table></div></div></li><li><p>示例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Go top-level test
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 测试代码
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>TestAdd</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=mi>5</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Add(2, 3) got %d, want 5&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestAddZero</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Add(2, 0) got %d, want 2&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestAddOppositeNum</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Add(2, -2) got %d, want 0&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>Go最佳实践的表驱动(table-driven)测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>TestAddWithTable</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>cases</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>            <span class=nx>a</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>            <span class=nx>b</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>            <span class=nx>r</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>        <span class=p>}{</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s>&#34;2+3&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s>&#34;2+0&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s>&#34;2+(-2)&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=c1>//... ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>caze</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>cases</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>caze</span><span class=p>.</span><span class=nx>a</span><span class=p>,</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>r</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;%s got %d, want %d&#34;</span><span class=p>,</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>基于top-level test+表驱动的测试,可以满足大多数Gopher的常规单测需求,不足：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>表内的cases顺序执行，无法shuffle;
</span></span><span class=line><span class=cl>表内所有cases在同一个goroutine中执行，隔离性差；
</span></span><span class=line><span class=cl>如果使用fatal/fatalf，那么一旦某个case失败，后面的测试表项(cases)将不能得到执行；
</span></span><span class=line><span class=cl>表内test case无法并行(parallel)执行；
</span></span><span class=line><span class=cl>测试用例的组织只能平铺，不够灵活，无法建立起层次。
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=2go-17版本引入了subtest>2、Go 1.7版本引入了subtest！</h2><ul><li><p>优点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>go subtest也会放在单独的goroutine中执行，保持相互的隔离；
</span></span><span class=line><span class=cl>某个Subtest用例未过，通过Errorf，甚至是Fatalf输出错误结果，都不会影响到同一TestXxx下的其他Subtest的执行；
</span></span><span class=line><span class=cl>某个Subtest中的某个结果判断未过，如果通过Errorf输出错误结果，则该Subtest会继续执行；
</span></span><span class=line><span class=cl>不过，如果subtest使用的是Fatal/Fatalf，这会导致该subtest的执行在调用Fatal/Fatalf的位置立即结束，subtest函数体内的后续测试代码将不会得到执行；
</span></span><span class=line><span class=cl>默认各个TestXxx下的subtest将按声明顺序逐一执行，即便它们是在各自的goroutine中执行的；
</span></span><span class=line><span class=cl>到目前为止，subtest不支持shuffle方式的随机序执行；
</span></span><span class=line><span class=cl>通过“go test -run=TestXxx/正则式[/...]”的方式，我们可以选择执行TestXxx下的某个或某些subtest；
</span></span><span class=line><span class=cl>各个subtest可以调用t.Parallel方法(即testing.T.Parallel方法)来将subtest加入到可并行执行的用例集合中，注意：加入到并行执行集合后，这些subTest的执行顺序就不确定了。
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>更细粒度的测试：通过将测试用例分成多个小测试函数，可以更容易地定位问题和调试。
</span></span><span class=line><span class=cl>可读性更好：subtest可以让测试代码更加清晰和易于理解。
</span></span><span class=line><span class=cl>更灵活的测试：subtest可以根据需要进行组合和排列，以满足不同的测试需求。
</span></span><span class=line><span class=cl>更有层次的组织测试代码：通过subtest可以设计出更有层次的测试代码组织形式，更方便地共享资源和在某一组织层次上设置setup与teardown
</span></span></code></pre></td></tr></table></div></div></li><li><p>示例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// subtest
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>TestAddWithSubtest</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>cases</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>        <span class=nx>a</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>        <span class=nx>r</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=p>}{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;2+3&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;2+0&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;2+(-2)&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>//... ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>caze</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>cases</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>caze</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;g:&#34;</span><span class=p>,</span> <span class=nf>curGoroutineID</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=nx>got</span> <span class=o>:=</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>caze</span><span class=p>.</span><span class=nx>a</span><span class=p>,</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>got</span> <span class=o>!=</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>r</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;got %d, want %d&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>caze</span><span class=p>.</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>curGoroutineID</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>buf</span> <span class=p>[</span><span class=mi>64</span><span class=p>]</span><span class=kt>byte</span>
</span></span><span class=line><span class=cl>    <span class=nx>n</span> <span class=o>:=</span> <span class=nx>runtime</span><span class=p>.</span><span class=nf>Stack</span><span class=p>(</span><span class=nx>buf</span><span class=p>[:],</span> <span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span> <span class=o>:=</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>6</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>n</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>buf</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>==</span> <span class=mh>0x20</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>id</span> <span class=p>=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>buf</span><span class=p>[</span><span class=mi>6</span><span class=p>:</span><span class=nx>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>gid</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Atoi</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>gid</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p>Go testing包没有引入testsuite(测试套件)或testcase(测试用例)的概念，只有Test和SubTest</p><h2 id=3testify>3、testify</h2><p>testify的suite包为我们提供了一种基于suite/case结构组织测试代码的方式</p><ul><li><p>assert/require（十分全面的测试断言包）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>testify</span>
</span></span><span class=line><span class=cl><span class=k>func</span> <span class=n>TestAssert</span><span class=p>(</span><span class=n>t</span> <span class=o>*</span><span class=n>testing</span><span class=o>.</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=n>Equal断言</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=s2>&#34;The result should be 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sl1</span> <span class=p>:</span><span class=o>=</span> <span class=p>[]</span><span class=ne>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>sl2</span> <span class=p>:</span><span class=o>=</span> <span class=p>[]</span><span class=ne>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>sl3</span> <span class=p>:</span><span class=o>=</span> <span class=p>[]</span><span class=ne>int</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>sl1</span><span class=p>,</span> <span class=n>sl2</span><span class=p>,</span> <span class=s2>&#34;sl1 should equal to sl2 &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=p>:</span><span class=o>=</span> <span class=o>&amp;</span><span class=n>sl1</span>
</span></span><span class=line><span class=cl>    <span class=n>p2</span> <span class=p>:</span><span class=o>=</span> <span class=o>&amp;</span><span class=n>sl2</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>p1</span><span class=p>,</span> <span class=n>p2</span><span class=p>,</span> <span class=s2>&#34;the content which p1 point to should equal to which p2 point to&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>err</span> <span class=p>:</span><span class=o>=</span> <span class=n>errors</span><span class=o>.</span><span class=n>New</span><span class=p>(</span><span class=s2>&#34;demo error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>EqualError</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>err</span><span class=p>,</span> <span class=s2>&#34;demo error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=nb>assert</span><span class=o>.</span><span class=n>Exactly</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>int32</span><span class=p>(</span><span class=mi>123</span><span class=p>),</span> <span class=n>int64</span><span class=p>(</span><span class=mi>123</span><span class=p>))</span> <span class=o>//</span> <span class=n>failed</span><span class=o>!</span> <span class=n>both</span> <span class=n>type</span> <span class=ow>and</span> <span class=n>value</span> <span class=n>must</span> <span class=n>be</span> <span class=n>same</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>布尔断言</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>True</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>1</span><span class=o>+</span><span class=mi>1</span> <span class=o>==</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&#34;1+1 == 2 should be true&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>,</span> <span class=s2>&#34;World&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=p>[]</span><span class=n>string</span><span class=p>{</span><span class=s2>&#34;Hello&#34;</span><span class=p>,</span> <span class=s2>&#34;World&#34;</span><span class=p>},</span> <span class=s2>&#34;World&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Contains</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>map</span><span class=p>[</span><span class=n>string</span><span class=p>]</span><span class=n>string</span><span class=p>{</span><span class=s2>&#34;Hello&#34;</span><span class=p>:</span> <span class=s2>&#34;World&#34;</span><span class=p>},</span> <span class=s2>&#34;Hello&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>ElementsMatch</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=p>[]</span><span class=ne>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>},</span> <span class=p>[]</span><span class=ne>int</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>//</span> <span class=err>反向断言</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>NotEqual</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=s2>&#34;The result should not be 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>NotEqual</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=n>sl1</span><span class=p>,</span> <span class=n>sl3</span><span class=p>,</span> <span class=s2>&#34;sl1 should not equal to sl3 &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>False</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>1</span><span class=o>+</span><span class=mi>1</span> <span class=o>==</span> <span class=mi>3</span><span class=p>,</span> <span class=s2>&#34;1+1 == 3 should be false&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Never</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=k>func</span><span class=p>()</span> <span class=ne>bool</span> <span class=p>{</span> <span class=k>return</span> <span class=bp>false</span> <span class=p>},</span> <span class=n>time</span><span class=o>.</span><span class=n>Second</span><span class=p>,</span> <span class=mi>10</span><span class=o>*</span><span class=n>time</span><span class=o>.</span><span class=n>Millisecond</span><span class=p>)</span> <span class=o>//</span><span class=mi>1</span><span class=err>秒之内</span><span class=n>condition参数都不为true</span><span class=err>，每</span><span class=mi>10</span><span class=err>毫秒检查一次</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>NotContains</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=s2>&#34;Hello World&#34;</span><span class=p>,</span> <span class=s2>&#34;Go&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>func</span> <span class=n>TestAdd1</span><span class=p>(</span><span class=n>t</span> <span class=o>*</span><span class=n>testing</span><span class=o>.</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=p>:</span><span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=n>t</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>func</span> <span class=n>TestAdd2</span><span class=p>(</span><span class=n>t</span> <span class=o>*</span><span class=n>testing</span><span class=o>.</span><span class=n>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span> <span class=p>:</span><span class=o>=</span> <span class=nb>assert</span><span class=o>.</span><span class=n>New</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=p>:</span><span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 5&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>Add</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>assert</span><span class=o>.</span><span class=n>Equal</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>result</span><span class=p>,</span> <span class=s2>&#34;The result should be 0&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>suite（提供了一个类xUnit的Suite/Case的测试代码组织形式的实现方案）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ExampleSuite</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>Suite</span>
</span></span><span class=line><span class=cl>    <span class=nx>indent</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>indents</span><span class=p>()</span> <span class=p>(</span><span class=nx>result</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span> <span class=o>+=</span> <span class=s>&#34;----&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>SetupSuite</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Suite setup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>TearDownSuite</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Suite teardown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>SetupTest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Test setup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>TearDownTest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Test teardown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>BeforeTest</span><span class=p>(</span><span class=nx>suiteName</span><span class=p>,</span> <span class=nx>testName</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%sBefore %s.%s\n&#34;</span><span class=p>,</span> <span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=nx>suiteName</span><span class=p>,</span> <span class=nx>testName</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>AfterTest</span><span class=p>(</span><span class=nx>suiteName</span><span class=p>,</span> <span class=nx>testName</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%sAfter %s.%s\n&#34;</span><span class=p>,</span> <span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=nx>suiteName</span><span class=p>,</span> <span class=nx>testName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>SetupSubTest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;SubTest setup&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>TearDownSubTest</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;SubTest teardown&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>TestCase1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;End TestCase1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Begin TestCase1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;case1-subtest1&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Begin TestCase1.Subtest1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;End TestCase1.Subtest1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;case1-subtest2&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Begin TestCase1.Subtest2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;End TestCase1.Subtest2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>suite</span> <span class=o>*</span><span class=nx>ExampleSuite</span><span class=p>)</span> <span class=nf>TestCase2</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;End TestCase2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Begin TestCase2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;case2-subtest1&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;Begin TestCase2.Subtest1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>suite</span><span class=p>.</span><span class=nf>indents</span><span class=p>(),</span> <span class=s>&#34;End TestCase2.Subtest1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>suite</span><span class=p>.</span><span class=nx>indent</span><span class=o>--</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestExampleSuite</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>suite</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nb>new</span><span class=p>(</span><span class=nx>ExampleSuite</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>mock（不建议用mock。 但结合mockery工具和testify mock，我们可以针对接口为被测目标自动生成testify的mock部分代码，这会大大提交mock test的编写效率）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// mock
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ID</span>   <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>Name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>Age</span>  <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserRepository</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>user</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>GetUserById</span><span class=p>(</span><span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserService</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>repo</span> <span class=nx>UserRepository</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewUserService</span><span class=p>(</span><span class=nx>repo</span> <span class=nx>UserRepository</span><span class=p>)</span> <span class=o>*</span><span class=nx>UserService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>UserService</span><span class=p>{</span><span class=nx>repo</span><span class=p>:</span> <span class=nx>repo</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>UserService</span><span class=p>)</span> <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>name</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>age</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>Age</span><span class=p>:</span> <span class=nx>age</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>CreateUser</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span><span class=p>.</span><span class=nx>ID</span> <span class=p>=</span> <span class=nx>id</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>user</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>UserService</span><span class=p>)</span> <span class=nf>GetUserById</span><span class=p>(</span><span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>s</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nf>GetUserById</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserRepositoryMock</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>mock</span><span class=p>.</span><span class=nx>Mock</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>UserRepositoryMock</span><span class=p>)</span> <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>user</span> <span class=o>*</span><span class=nx>User</span><span class=p>)</span> <span class=p>(</span><span class=kt>int</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>args</span> <span class=o>:=</span> <span class=nx>m</span><span class=p>.</span><span class=nf>Called</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>args</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=mi>0</span><span class=p>),</span> <span class=nx>args</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>m</span> <span class=o>*</span><span class=nx>UserRepositoryMock</span><span class=p>)</span> <span class=nf>GetUserById</span><span class=p>(</span><span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>args</span> <span class=o>:=</span> <span class=nx>m</span><span class=p>.</span><span class=nf>Called</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>args</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=mi>0</span><span class=p>).(</span><span class=o>*</span><span class=nx>User</span><span class=p>),</span> <span class=nx>args</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestUserService_CreateUser</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>repo</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>UserRepositoryMock</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>service</span> <span class=o>:=</span> <span class=nf>NewUserService</span><span class=p>(</span><span class=nx>repo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>user</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>User</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span> <span class=nx>Age</span><span class=p>:</span> <span class=mi>30</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>repo</span><span class=p>.</span><span class=nf>On</span><span class=p>(</span><span class=s>&#34;CreateUser&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=p>).</span><span class=nf>Return</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>createdUser</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>service</span><span class=p>.</span><span class=nf>CreateUser</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span> <span class=nx>user</span><span class=p>.</span><span class=nx>Age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>createdUser</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=s>&#34;Alice&#34;</span><span class=p>,</span> <span class=nx>createdUser</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=nx>createdUser</span><span class=p>.</span><span class=nx>Age</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>repo</span><span class=p>.</span><span class=nf>AssertExpectations</span><span class=p>(</span><span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=4test-double尽量使用fake-object而不是mock-object>4、Test Double(尽量使用fake object，而不是mock object)</h2><p>fake object也是Go testing中最为常用的一类（fake object最容易理解，它是被测系统SUT(System Under Test)依赖的外部协作者的“替身”）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>以Go的标准库为例，我们在src/database/sql
</span></span><span class=line><span class=cl>Go标准库中还有net/dnsclient_unix_test.go中的fakeDNSServer
</span></span></code></pre></td></tr></table></div></div><p>stub可以理解为一种fake object的特例。(一个内置了预期值/响应值且可以在多个测试间复用的替身object)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Go标准库中的net/http/httptest就是一个提供创建stub的典型的测试辅助包
</span></span><span class=line><span class=cl>httptest还常用来做http.Handler的测试
</span></span></code></pre></td></tr></table></div></div><p>fake建立困难但使用简单。而mock object则是一种建立简单，使用简单程度因被测目标与外部协作者交互复杂程度而异的test double</p><p>mock object要与接口类型联合使用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>我们与fake object的交互方式与与真实外部协作者交互的方式相同，这让其显得更简单，更容易使用，也降低了测试的复杂性；
</span></span><span class=line><span class=cl>fake objet的行为更像真正的协作者，可以给开发人员更多的信心；
</span></span><span class=line><span class=cl>当真实协作者更新时，我们不需要更新使用fake object时设置的expection和结果验证条件，因此，使用fake object时，重构代码往往比使用其他test double更容易。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fake object的创建和维护可能很费时，就像上面的fakeDriver，源码有近2k行；
</span></span><span class=line><span class=cl>fake object可能无法提供与真实组件相同的功能覆盖水平，这与fake object的提供方式有关。
</span></span><span class=line><span class=cl>fake object的实现需要维护，每当真正的协作者更新时，都必须更新fake object。
</span></span></code></pre></td></tr></table></div></div><p>借助类似ChatGPT/copilot的工具快速构建出一个fake object</p><p>如果要更高的可信度和更高的功能覆盖水平，我们还可以借助docker来构建“真实版/无阉割版”的fake object。
借助github上开源的testcontainers-go可以更为简便的构建出一个fake object，并且testcontainer提供了常见的外部协作者的封装实现，比如：MySQL、Redis、Postgres等。
testcontainer更多也会被用在集成测试或冒烟测试上</p><h2 id=5竞争检测race-detection>5、竞争检测(race detection)</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ go test -race mypkg    // to test the package
</span></span><span class=line><span class=cl>$ go run -race mysrc.go  // to run the source file
</span></span><span class=line><span class=cl>$ go build -race mycmd   // to build the command
</span></span><span class=line><span class=cl>$ go install -race mypkg // to install the package
</span></span></code></pre></td></tr></table></div></div><h2 id=6fuzz>6、fuzz</h2><p>The unit test has limitations, namely that each input must be added to the test by the developer. One benefit of fuzzing is that it comes up with inputs for your code, and may identify edge cases that the test cases you came up with didn’t reach.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>//reverse.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>input</span> <span class=o>:=</span> <span class=s>&#34;The quick brown fox jumped over the lazy dog&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>rev</span> <span class=o>:=</span> <span class=nf>Reverse</span><span class=p>(</span><span class=nx>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>doubleRev</span> <span class=o>:=</span> <span class=nf>Reverse</span><span class=p>(</span><span class=nx>rev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;original: %q\n&#34;</span><span class=p>,</span> <span class=nx>input</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;reversed: %q\n&#34;</span><span class=p>,</span> <span class=nx>rev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;reversed again: %q\n&#34;</span><span class=p>,</span> <span class=nx>doubleRev</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Reverse</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=p>[]</span><span class=nb>rune</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=p>=</span> <span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=nx>j</span><span class=o>-</span><span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>r</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>r</span><span class=p>[</span><span class=nx>j</span><span class=p>]</span> <span class=p>=</span> <span class=nx>r</span><span class=p>[</span><span class=nx>j</span><span class=p>],</span> <span class=nx>r</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>string</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//reverse_test.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;unicode/utf8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestReverse</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>testcases</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>in</span><span class=p>,</span> <span class=nx>want</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=p>}{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;Hello, world&#34;</span><span class=p>,</span> <span class=s>&#34;dlrow ,olleH&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34; &#34;</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=s>&#34;!12345&#34;</span><span class=p>,</span> <span class=s>&#34;54321!&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tc</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>testcases</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>rev</span> <span class=o>:=</span> <span class=nf>Reverse</span><span class=p>(</span><span class=nx>tc</span><span class=p>.</span><span class=nx>in</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>rev</span> <span class=o>!=</span> <span class=nx>tc</span><span class=p>.</span><span class=nx>want</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Reverse: %q, want %q&#34;</span><span class=p>,</span> <span class=nx>rev</span><span class=p>,</span> <span class=nx>tc</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>FuzzReverse</span><span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>F</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>testcases</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Hello, world&#34;</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>,</span> <span class=s>&#34;!12345&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tc</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>testcases</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>f</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>tc</span><span class=p>)</span>  <span class=c1>// Use f.Add to provide a seed corpus
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=p>.</span><span class=nf>Fuzz</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>,</span> <span class=nx>orig</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>rev</span> <span class=o>:=</span> <span class=nf>Reverse</span><span class=p>(</span><span class=nx>orig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>doubleRev</span> <span class=o>:=</span> <span class=nf>Reverse</span><span class=p>(</span><span class=nx>rev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;Number of runes: orig=%d, rev=%d, doubleRev=%d&#34;</span><span class=p>,</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>RuneCountInString</span><span class=p>(</span><span class=nx>orig</span><span class=p>),</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>RuneCountInString</span><span class=p>(</span><span class=nx>rev</span><span class=p>),</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>RuneCountInString</span><span class=p>(</span><span class=nx>doubleRev</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>orig</span> <span class=o>!=</span> <span class=nx>doubleRev</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Before: %q, after: %q&#34;</span><span class=p>,</span> <span class=nx>orig</span><span class=p>,</span> <span class=nx>doubleRev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>utf8</span><span class=p>.</span><span class=nf>ValidString</span><span class=p>(</span><span class=nx>orig</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nx>utf8</span><span class=p>.</span><span class=nf>ValidString</span><span class=p>(</span><span class=nx>rev</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Reverse produced invalid UTF-8 string %q&#34;</span><span class=p>,</span> <span class=nx>rev</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=6使用场景>6、使用场景</h2><p>net/http/httptest包提供了许多帮助函数，用于测试那些发送或处理Http请求的代码。</p><h2 id=引用>引用</h2><ul><li><a href=https://tonybai.com/2023/04/20/provide-fake-object-for-external-collaborators/>单测时尽量用fake object</a></li><li><a href=https://go.dev/doc/tutorial/fuzz>fuzz</a></li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>yesplease</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2024-01-04</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=http://cugbtang.github.io/tags/go/>go</a>
<a href=http://cugbtang.github.io/tags/test/>test</a></div><nav class=post-nav><a class=prev href=/post/go/series-go-8/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i><span class="prev-text nav-default">Go 高级编程, how to play?</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/post/go/series-go-5/><span class="next-text nav-default">Go Effective, how to play?</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=icon-links><a href=http://cugbtang.github.io rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" style="" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a><a href=http://cugbtang.github.io rel="me noopener" class=iconfont title=bilibili target=_blank><svg class="icon" style="" viewBox="0 0 1024 1024" width="36" height="36" id="svg8"><path style="" d="M744.60599.00486267A41.779915 41.779915.0 00710.4184 18.673394L548.5048 255.32642h-11.70046a41.779915 41.779915.0 00-10.80295-7.84928L235.66 97.084498a41.779915 41.779915.0 00-20.07193-4.960864 41.779915 41.779915.0 00-18.3748 79.145436L359.4859 255.32642H128.16909c-49.458302.0-89.27932 39.82105-89.27932 89.27932v508.65224c0 49.4583 39.821018 89.27934 89.27932 89.27934h19.48445C149.12802 984.5043 179.92773 1024 224.79179 1024c44.86407.0 75.66379-39.4957 77.13826-81.46268H719.98116C721.45559 984.5043 752.25533 1024 797.1194 1024c44.86406.0 75.6638-39.4957 77.13824-81.46268h21.57323c49.45831.0 89.27936-39.82104 89.27936-89.27934V344.60574c0-49.45827-39.82105-89.27932-89.27936-89.27932H649.74567L779.38103 65.866924A41.779915 41.779915.0 00744.60599.00486267zM644.49108 418.70871c6.29985.21538 12.44451 2.01107 17.86888 5.22196l171.36218 98.10771c18.23417 10.21935 24.63334 33.34627 14.24614 51.48533-10.38726 18.13909-33.57344 24.32718-51.61587 13.77296L624.9903 489.18895c-15.21356-8.41858-22.66871-26.1765-18.03211-42.93436 4.63664-16.75784 20.15573-28.14465 37.53289-27.54588zM350.2006 432.31846c16.89952.0317 31.69582 11.33328 36.17844 27.62747 4.48262 16.2942-2.44981 33.57765-16.95507 42.24898l-140.7157 86.91312c-17.68528 11.18244-41.09629 5.77692-52.08912-12.02686-10.99282-17.80373-5.33855-41.15658 12.58167-51.95857L329.9002 438.2095c6.0643-3.86439 13.10951-5.90891 20.3004-5.89104zM501.605 641.53985c3.75002-.15248 7.48645.53903 10.93349 2.0235.15842.0637.31618.12888.47325.19582.59328.27092 1.17574.56489 1.74609.88121.15868.0854.31643.17233.47325.2611.55694.32165 1.10131.66458 1.63185 1.02807.16455.1123.32777.2265.48956.34269.50382.36781.99371.75428 1.46868 1.15864.18724.15504.37218.31282.55484.47323.43271.38784.8518.79061 1.25653 1.20756.15449.16114.30679.32437.45693.48959.40798.44266.79989.89988 1.17494 1.37076.17799.22544.35205.45395.5222.68538.25932.34701.50964.70071.75064 1.06071.26712.39516.52286.79784.76699 1.20757.16907.29043.33231.58424.48957.88123.21836.41297.42513.83199.62009 1.25653.14836.32333.28983.64976.42429.97911.21319.51552.40915 1.03801.58747 1.5666.0677.19499.13296.39085.19582.58748.18652.60823.34984 1.22334.48957 1.84399.0397.16277.0779.32601.11423.48957.1436.69112.25788 1.38801.34269 2.08877.005.0381.0111.0761.0163.11424.0857.78056.13474 1.56471.14687 2.34988.005.0543.0111.10879.0163.1632.0.0-.008 1.12132.0 1.45234.0.0-.14697 17.84761 5.89102 34.12231 3.01902 8.13734 7.33278 15.10615 12.61433 19.61501 5.28157 4.50889 11.42894 7.62081 23.64572 7.62081 12.2168.0 18.36416-3.11192 23.64573-7.62081 5.28154-4.50886 9.5953-11.47767 12.6143-19.61501 6.03799-16.2747 5.89103-34.12231 5.89103-34.12231-.44885-13.87045 10.45922-25.46302 24.3311-25.86506 13.87189-.40201 25.42828 10.53953 25.78348 24.41272.0.0 1.11929 25.7226-9.00791 53.01927-5.06359 13.64832-13.1986 28.46036-27.05631 40.29073-13.85772 11.83039-33.5454 19.63135-56.20142 19.63135-22.65603.0-42.34371-7.80096-56.20141-19.63135-4.1801-3.56856-7.78733-7.42433-10.99878-11.42303-3.21235 4.00037-6.81703 7.85309-10.99876 11.42303-13.85773 11.83039-33.5454 19.63135-56.20144 19.63135-22.65601.0-42.3437-7.80096-56.2014-19.63135-13.85775-11.83037-21.99272-26.64241-27.05632-40.29073-10.12725-27.29667-9.00789-53.01928-9.00789-53.01927.20714-13.83687 11.58744-24.88848 25.42444-24.69013 14.1263.19991 25.2971 12.0278 24.69011 26.14247.0.0-.14697 17.84761 5.89103 34.12231 3.01902 8.13734 7.31646 15.10615 12.598 19.61501 5.28155 4.50889 11.44526 7.62081 23.66203 7.62081 12.21681.0 18.36418-3.11192 23.64573-7.62081 5.28154-4.50886 9.57899-11.47767 12.598-19.61501 5.76352-15.53489 5.89112-32.05691 5.89103-33.56746.006-.37466.0111-1.05336.0163-1.20759-.0117-.74583.0105-1.49177.0652-2.23565.009-.15784.0204-.31561.0327-.47324.14204-1.56859.43163-3.12027.86487-4.63449.0213-.0763.0433-.15244.0652-.22848 3.0335-10.25748 12.24157-17.46007 22.92769-17.93417z" id="rect824"/></svg>
</a><a href=http://cugbtang.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span><span class=copyright-year>&copy;
2017 -
2024
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i></span><span class=author>cugbtang</span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script><script type=text/javascript src=/js/load-photoswipe.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script></body></html>