<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Go-micro, how to play introduction? - âœŒyesplease's blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=color-scheme content="light dark"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=generator content="Hugo 0.152.2"><link rel=canonical href=http://localhost:1313/post/micro/series-micro-1/><meta name=author content="yesplease"><meta name=description content="Go-micro ç®€ä»‹ï¼šæ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®Œæ•´æŒ‡å— ä¸€å¥è¯ä»‹ç» Go Micro is a framework for distributed systems development.
å¤šè¯´ä¸¤å¥ Go Micro provides the core requirements for distributed systems development including RPC and Event driven communication. The Go Micro philosophy is sane defaults with a pluggable architecture. We provide defaults to get you started quickly but everything can be easily swapped out.
"><meta name=keywords content="go,micro,go-micro"><meta property="og:url" content="http://localhost:1313/post/micro/series-micro-1/"><meta property="og:site_name" content="âœŒyesplease's blog"><meta property="og:title" content="Go-micro, how to play introduction?"><meta property="og:description" content="Go-micro ç®€ä»‹ï¼šæ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®Œæ•´æŒ‡å— ä¸€å¥è¯ä»‹ç» Go Micro is a framework for distributed systems development.
å¤šè¯´ä¸¤å¥ Go Micro provides the core requirements for distributed systems development including RPC and Event driven communication. The Go Micro philosophy is sane defaults with a pluggable architecture. We provide defaults to get you started quickly but everything can be easily swapped out."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-09-15T15:44:23+08:00"><meta property="article:modified_time" content="2023-09-15T16:44:23+08:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Micro"><meta property="article:tag" content="Go-Micro"><meta itemprop=name content="Go-micro, how to play introduction?"><meta itemprop=description content="Go-micro ç®€ä»‹ï¼šæ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®Œæ•´æŒ‡å— ä¸€å¥è¯ä»‹ç» Go Micro is a framework for distributed systems development.
å¤šè¯´ä¸¤å¥ Go Micro provides the core requirements for distributed systems development including RPC and Event driven communication. The Go Micro philosophy is sane defaults with a pluggable architecture. We provide defaults to get you started quickly but everything can be easily swapped out."><meta itemprop=datePublished content="2023-09-15T15:44:23+08:00"><meta itemprop=dateModified content="2023-09-15T16:44:23+08:00"><meta itemprop=wordCount content="5915"><meta itemprop=keywords content="Go,Micro,Go-Micro"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go-micro, how to play introduction?"><meta name=twitter:description content="Go-micro ç®€ä»‹ï¼šæ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®Œæ•´æŒ‡å— ä¸€å¥è¯ä»‹ç» Go Micro is a framework for distributed systems development.
å¤šè¯´ä¸¤å¥ Go Micro provides the core requirements for distributed systems development including RPC and Event driven communication. The Go Micro philosophy is sane defaults with a pluggable architecture. We provide defaults to get you started quickly but everything can be easily swapped out."><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/style.min.a0ae63bb9404f735c1a2045deae9e97f06e10118e5ad7befa80df30c5cd7fabc.css integrity="sha256-oK5ju5QE9zXBogRd6unpfwbhARjlrXvvqA3zDFzX+rw=" media=screen crossorigin=anonymous><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script>(function(){var e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script></head><body><div id=back-to-top></div><header class=site-header><div class=desktop-header><div class=desktop-header-logo><a href=/ class=logo>âœŒyesplease</a></div><nav class=desktop-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=http://localhost:1313/>This is Home</a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/about/>About</a></li><li class=menu-item><a class="theme-toggle menu-item-link" href=javascript:void(0);><svg aria-hidden="true" class="lucide lucide-sun hi-svg-inline theme-icon-light" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
<svg aria-hidden="true" class="lucide lucide-moon hi-svg-inline theme-icon-dark" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/index.xml rel="noopener alternate" type=application/rss+xml title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline icon--rss" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></li></ul></nav></div><div class=mobile-header><div id=mobile-navbar class=mobile-navbar><div id=mobile-navbar-icon class=mobile-navbar-icon><svg aria-hidden="true" class="lucide lucide-menu hi-svg-inline icon--menu" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg></div><div class=mobile-navbar-logo><a href=/ class=logo>âœŒyesplease</a></div></div><div id=mobile-menu-close-modal class=mobile-menu-close-modal></div><nav id=mobile-menu class=mobile-menu><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/>This is Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/post/>Archives</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/about/>About</a></li><li class=mobile-menu-item><a class="theme-toggle menu-item-link" href=javascript:void(0);><svg aria-hidden="true" class="lucide lucide-sun hi-svg-inline theme-icon-light" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
<svg aria-hidden="true" class="lucide lucide-moon hi-svg-inline theme-icon-dark" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/index.xml rel="noopener alternate" type=application/rss+xml title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline icon--rss" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></li></ul></nav></div></header><main id=main class="main pico container"><div class=content-wrapper><aside class=left-sidebar><nav class=toc id=toc><div class=toc-title>Table of Contents</div><div class="toc-content custom-scrollbar"><nav id=TableOfContents><ul><li><a href=#ä¸€å¥è¯ä»‹ç»>ä¸€å¥è¯ä»‹ç»</a></li><li><a href=#å¤šè¯´ä¸¤å¥>å¤šè¯´ä¸¤å¥</a></li><li><a href=#æ ¸å¿ƒåŠŸèƒ½æ·±åº¦è§£æ>æ ¸å¿ƒåŠŸèƒ½æ·±åº¦è§£æ</a><ul><li><a href=#-authentication---å†…ç½®èº«ä»½è®¤è¯ç³»ç»Ÿ>ğŸ” Authentication - å†…ç½®èº«ä»½è®¤è¯ç³»ç»Ÿ</a></li><li><a href=#-dynamic-config---åŠ¨æ€é…ç½®ç®¡ç†>âš™ï¸ Dynamic Config - åŠ¨æ€é…ç½®ç®¡ç†</a></li><li><a href=#-data-storage---ç»Ÿä¸€æ•°æ®å­˜å‚¨æ¥å£>ğŸ’¾ Data Storage - ç»Ÿä¸€æ•°æ®å­˜å‚¨æ¥å£</a></li><li><a href=#-service-discovery---æ™ºèƒ½æœåŠ¡å‘ç°>ğŸŒ Service Discovery - æ™ºèƒ½æœåŠ¡å‘ç°</a></li><li><a href=#-load-balancing---æ™ºèƒ½è´Ÿè½½å‡è¡¡>âš–ï¸ Load Balancing - æ™ºèƒ½è´Ÿè½½å‡è¡¡</a></li><li><a href=#-message-encoding---çµæ´»æ¶ˆæ¯ç¼–ç >ğŸ“¦ Message Encoding - çµæ´»æ¶ˆæ¯ç¼–ç </a></li><li><a href=#-rpc-clientserver---é«˜æ€§èƒ½rpcé€šä¿¡>ğŸ”„ RPC Client/Server - é«˜æ€§èƒ½RPCé€šä¿¡</a></li><li><a href=#-async-messaging---å¼‚æ­¥æ¶ˆæ¯ç³»ç»Ÿ>ğŸ“¨ Async Messaging - å¼‚æ­¥æ¶ˆæ¯ç³»ç»Ÿ</a></li><li><a href=#-event-streaming---é«˜çº§äº‹ä»¶æµå¤„ç†>ğŸŒŠ Event Streaming - é«˜çº§äº‹ä»¶æµå¤„ç†</a></li><li><a href=#-synchronization---åˆ†å¸ƒå¼åŒæ­¥>ğŸ”’ Synchronization - åˆ†å¸ƒå¼åŒæ­¥</a></li><li><a href=#-pluggable-interfaces---æ’ä»¶åŒ–æ¶æ„>ğŸ”Œ Pluggable Interfaces - æ’ä»¶åŒ–æ¶æ„</a></li></ul></li><li><a href=#ç”Ÿæ€å·¥å…·é“¾æ·±åº¦è§£æ>ç”Ÿæ€å·¥å…·é“¾æ·±åº¦è§£æ</a><ul><li><a href=#-api-gateway---ç»Ÿä¸€æœåŠ¡å…¥å£>ğŸŒ API Gateway - ç»Ÿä¸€æœåŠ¡å…¥å£</a></li><li><a href=#-cli-å·¥å…·---å‘½ä»¤è¡Œç®¡ç†ä¸­å¿ƒ>ğŸ› ï¸ CLI å·¥å…· - å‘½ä»¤è¡Œç®¡ç†ä¸­å¿ƒ</a></li><li><a href=#-demo-é¡¹ç›®---å­¦ä¹ æœ€ä½³å®è·µ>ğŸ¯ Demo é¡¹ç›® - å­¦ä¹ æœ€ä½³å®è·µ</a></li><li><a href=#-plugin-ç³»ç»Ÿ---æ— é™æ‰©å±•æ€§>ğŸ”Œ Plugin ç³»ç»Ÿ - æ— é™æ‰©å±•æ€§</a></li><li><a href=#-examples-é›†åˆ---å®æˆ˜åœºæ™¯è¦†ç›–>ğŸ“š Examples é›†åˆ - å®æˆ˜åœºæ™¯è¦†ç›–</a></li><li><a href=#-dashboard---å¯è§†åŒ–ç®¡ç†å¹³å°>ğŸ“Š Dashboard - å¯è§†åŒ–ç®¡ç†å¹³å°</a></li><li><a href=#-generator---ä»£ç ç”Ÿæˆå·¥å…·>âš¡ Generator - ä»£ç ç”Ÿæˆå·¥å…·</a></li></ul></li><li><a href=#æ€»ç»“ä¸å±•æœ›>æ€»ç»“ä¸å±•æœ›</a><ul><li><a href=#go-micro-çš„æ ¸å¿ƒä»·å€¼>Go Micro çš„æ ¸å¿ƒä»·å€¼</a></li><li><a href=#æœ€ä½³å®è·µå»ºè®®>æœ€ä½³å®è·µå»ºè®®</a></li><li><a href=#æœªæ¥å‘å±•è¶‹åŠ¿>æœªæ¥å‘å±•è¶‹åŠ¿</a></li><li><a href=#å­¦ä¹ è·¯å¾„å»ºè®®>å­¦ä¹ è·¯å¾„å»ºè®®</a></li><li><a href=#ç»“è¯­>ç»“è¯­</a></li></ul></li></ul></nav></div></nav></aside><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Go-micro, how to play introduction?</h1><div class=post-meta-list><div class="post-meta-item post-meta-author"><svg aria-hidden="true" class="lucide lucide-user-round-pen hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M2 21a8 8 0 0110.821-7.487"/><path d="M21.378 16.626a1 1 0 00-3.004-3.004l-4.01 4.012a2 2 0 00-.506.854l-.837 2.87a.5.5.0 00.62.62l2.87-.837a2 2 0 00.854-.506z"/><circle cx="10" cy="8" r="5"/></svg>
<a href=/about><span class=post-meta-author-name>yesplease</span></a></div><div class="post-meta-item post-meta-time"><svg aria-hidden="true" class="lucide lucide-calendar-days hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
<time datetime=2023-09-15>2023-09-15</time></div><div class=post-meta__right><div class="post-meta-item post-meta-category"><a href=http://localhost:1313/categories/go/>go</a>
<a href=http://localhost:1313/categories/micro/>micro</a>
<a href=http://localhost:1313/categories/go-micro/>go-micro</a></div></div></div></header><div class=post-content><h1 id=go-micro-ç®€ä»‹æ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—>Go-micro ç®€ä»‹ï¼šæ„å»ºä¸‹ä¸€ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®Œæ•´æŒ‡å—</h1><h2 id=ä¸€å¥è¯ä»‹ç»>ä¸€å¥è¯ä»‹ç»</h2><p>Go Micro is a framework for distributed systems development.</p><h2 id=å¤šè¯´ä¸¤å¥>å¤šè¯´ä¸¤å¥</h2><p>Go Micro provides the core requirements for distributed systems development including RPC and Event driven communication.
The Go Micro philosophy is sane defaults with a pluggable architecture. We provide defaults to get you started quickly but everything can be easily swapped out.</p><p>åœ¨äº‘åŸç”Ÿæ—¶ä»£ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå·²ç»æˆä¸ºæ„å»ºå¯æ‰©å±•ã€é«˜å¯ç”¨åº”ç”¨çš„æ ‡å‡†èŒƒå¼ã€‚Go Micro ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ›´æ˜¯ä¸€å¥—å®Œæ•´çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å“²å­¦ã€‚å®ƒé€šè¿‡æ’ä»¶åŒ–çš„æ¶æ„è®¾è®¡ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿæ„å»ºç”Ÿäº§çº§çš„å¾®æœåŠ¡ç³»ç»Ÿï¼ŒåŒæ—¶ä¿æŒè¶³å¤Ÿçš„çµæ´»æ€§æ¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯æ ˆã€‚</p><p>Go Micro çš„æ ¸å¿ƒæ€æƒ³æ˜¯"çº¦å®šä¼˜äºé…ç½®"ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€è‡´çš„æœåŠ¡å¼€å‘ä½“éªŒï¼Œä»æœåŠ¡å®šä¹‰ã€é€šä¿¡ã€å‘ç°åˆ°ç›‘æ§ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç”Ÿæ€ã€‚æ— è®ºæ˜¯æ„å»ºç®€å•çš„å¾®æœåŠ¡æ¶æ„ï¼Œè¿˜æ˜¯å¤æ‚çš„åˆ†å¸ƒå¼äº‹ä»¶é©±åŠ¨ç³»ç»Ÿï¼ŒGo Micro éƒ½èƒ½æä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚</p><h2 id=æ ¸å¿ƒåŠŸèƒ½æ·±åº¦è§£æ>æ ¸å¿ƒåŠŸèƒ½æ·±åº¦è§£æ</h2><h3 id=-authentication---å†…ç½®èº«ä»½è®¤è¯ç³»ç»Ÿ>ğŸ” Authentication - å†…ç½®èº«ä»½è®¤è¯ç³»ç»Ÿ</h3><p>Authentication ä½œä¸º Go Micro çš„ä¸€ç­‰å…¬æ°‘ï¼Œä¸ºæ„å»ºå®‰å…¨çš„é›¶ä¿¡ä»»ç½‘ç»œæä¾›äº†å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ¯ä¸ªæœåŠ¡éƒ½ä¼šè·å¾—å”¯ä¸€çš„èº«ä»½æ ‡è¯†å’Œè¯ä¹¦ï¼Œç¡®ä¿æœåŠ¡é—´é€šä¿¡çš„å®‰å…¨æ€§ã€‚</p><p><strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p><ul><li><strong>æœåŠ¡èº«ä»½ç®¡ç†</strong>ï¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªæœåŠ¡ç”Ÿæˆå’Œç®¡ç†èº«ä»½è¯ä¹¦</li><li><strong>åŸºäºè§„åˆ™çš„è®¿é—®æ§åˆ¶</strong>ï¼šæ”¯æŒç»†ç²’åº¦çš„æƒé™æ§åˆ¶ç­–ç•¥</li><li><strong>é›¶ä¿¡ä»»ç½‘ç»œ</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ä¸ä¿¡ä»»ä»»ä½•æœåŠ¡ï¼Œæ‰€æœ‰é€šä¿¡éƒ½éœ€è¦è®¤è¯</li><li><strong>è¯ä¹¦è½®æ¢</strong>ï¼šè‡ªåŠ¨å¤„ç†è¯ä¹¦çš„æ›´æ–°å’Œè½®æ¢</li></ul><p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// å¯ç”¨è®¤è¯çš„æœåŠ¡ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewService</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Name</span>(<span style=color:#e6db74>&#34;user-service&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Auth</span>(<span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>NewAuth</span>()),
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å…¶ä»–é…ç½®...</span>
</span></span><span style=display:flex><span>)</span></span></code></pre></div></div><p>åœ¨é‡‘èçº§åº”ç”¨ä¸­ï¼Œè®¤è¯ç³»ç»Ÿå°¤ä¸ºé‡è¦ã€‚Go Micro çš„è®¤è¯æœºåˆ¶ç¡®ä¿äº†å³ä½¿åœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡ä¾ç„¶ä¿æŒé«˜åº¦å®‰å…¨æ€§ã€‚</p><h3 id=-dynamic-config---åŠ¨æ€é…ç½®ç®¡ç†>âš™ï¸ Dynamic Config - åŠ¨æ€é…ç½®ç®¡ç†</h3><p>åŠ¨æ€é…ç½®ç³»ç»Ÿè®©åº”ç”¨èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶ä»å¤šç§æ¥æºåŠ è½½å’Œçƒ­é‡è½½é…ç½®ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯å“åº”é…ç½®å˜æ›´ã€‚</p><p><strong>æ”¯æŒçš„é…ç½®æºï¼š</strong></p><ul><li>ç¯å¢ƒå˜é‡</li><li>æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</li><li>åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼ˆetcdã€Consulï¼‰</li><li>é…ç½®ä¸­å¿ƒ</li><li>äº‘åŸç”Ÿé…ç½®æœåŠ¡</li></ul><p><strong>é«˜çº§ç‰¹æ€§ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// é…ç½®åˆå¹¶å’Œå›é€€ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>config</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>NewConfig</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>WithSource</span>(<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>NewSource</span>(<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>WithPath</span>(<span style=color:#e6db74>&#34;/path/to/config&#34;</span>))),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>WithSource</span>(<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>NewSource</span>()),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>WithFallback</span>(<span style=color:#66d9ef>true</span>), <span style=color:#75715e>// å¯ç”¨å›é€€æœºåˆ¶</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç›‘å¬é…ç½®å˜åŒ–</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>watcher</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>Watch</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>change</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>watcher</span>.<span style=color:#a6e22e>Next</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Config changed: %+v&#34;</span>, <span style=color:#a6e22e>change</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ‰§è¡Œé…ç½®çƒ­æ›´æ–°é€»è¾‘</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}()</span></span></code></pre></div></div><p><strong>å®é™…åº”ç”¨ï¼š</strong></p><ul><li>å¤šç¯å¢ƒé…ç½®ç®¡ç†ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰</li><li>A/B æµ‹è¯•é…ç½®åŠ¨æ€åˆ‡æ¢</li><li>ç‰¹æ€§å¼€å…³æ§åˆ¶</li><li>é™æµå’Œé™çº§ç­–ç•¥è°ƒæ•´</li></ul><h3 id=-data-storage---ç»Ÿä¸€æ•°æ®å­˜å‚¨æ¥å£>ğŸ’¾ Data Storage - ç»Ÿä¸€æ•°æ®å­˜å‚¨æ¥å£</h3><p>Go Micro æä¾›äº†ç®€å•è€Œå¼ºå¤§çš„æ•°æ®å­˜å‚¨æŠ½è±¡ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯çš„æ— ç¼åˆ‡æ¢ã€‚</p><p><strong>å†…ç½®å­˜å‚¨æ”¯æŒï¼š</strong></p><ul><li><strong>å†…å­˜å­˜å‚¨</strong>ï¼šé€‚åˆç¼“å­˜å’Œæµ‹è¯•åœºæ™¯</li><li><strong>æ–‡ä»¶å­˜å‚¨</strong>ï¼šè½»é‡çº§æŒä¹…åŒ–è§£å†³æ–¹æ¡ˆ</li><li><strong>CockroachDB</strong>ï¼šåˆ†å¸ƒå¼SQLæ•°æ®åº“</li><li><strong>MongoDB</strong>ï¼šæ–‡æ¡£æ•°æ®åº“</li><li><strong>Redis</strong>ï¼šå†…å­˜æ•°æ®ç»“æ„å­˜å‚¨</li></ul><p><strong>æ ¸å¿ƒæ¥å£è®¾è®¡ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Store</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Delete</span>(<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>List</span>() ([]<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Exists</span>(<span style=color:#a6e22e>key</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>store</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>memory</span>.<span style=color:#a6e22e>NewStore</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#e6db74>&#34;user:123&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>User</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ID</span>:    <span style=color:#ae81ff>123</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>:  <span style=color:#e6db74>&#34;John Doe&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Email</span>: <span style=color:#e6db74>&#34;john@example.com&#34;</span>,
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div><p><strong>é«˜çº§ç‰¹æ€§ï¼š</strong></p><ul><li><strong>äº‹åŠ¡æ”¯æŒ</strong>ï¼šç¡®ä¿æ•°æ®ä¸€è‡´æ€§</li><li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šæå‡æ€§èƒ½</li><li><strong>ç´¢å¼•æ”¯æŒ</strong>ï¼šåŠ é€ŸæŸ¥è¯¢</li><li><strong>äº‹ä»¶é©±åŠ¨</strong>ï¼šæ•°æ®å˜æ›´é€šçŸ¥</li></ul><h3 id=-service-discovery---æ™ºèƒ½æœåŠ¡å‘ç°>ğŸŒ Service Discovery - æ™ºèƒ½æœåŠ¡å‘ç°</h3><p>æœåŠ¡å‘ç°æ˜¯å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒç»„ä»¶ï¼ŒGo Micro æä¾›äº†è‡ªåŠ¨åŒ–çš„æœåŠ¡æ³¨å†Œå’Œåç§°è§£ææœºåˆ¶ã€‚</p><p><strong>å‘ç°æœºåˆ¶ï¼š</strong></p><ul><li><strong>é»˜è®¤æœºåˆ¶</strong>ï¼šå¤šæ’­ DNS (mdns)ï¼Œé›¶é…ç½®ç³»ç»Ÿ</li><li><strong>ç”Ÿäº§ç¯å¢ƒ</strong>ï¼šæ”¯æŒ Consulã€etcdã€Kubernetes</li><li><strong>æ··åˆæ¨¡å¼</strong>ï¼šå¯åŒæ—¶ä½¿ç”¨å¤šç§å‘ç°æœºåˆ¶</li></ul><p><strong>æœåŠ¡æ³¨å†Œç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// è‡ªåŠ¨æœåŠ¡æ³¨å†Œ</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewService</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Name</span>(<span style=color:#e6db74>&#34;payment-service&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Version</span>(<span style=color:#e6db74>&#34;1.0.0&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Metadata</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;region&#34;</span>: <span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tier&#34;</span>:   <span style=color:#e6db74>&#34;production&#34;</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æœåŠ¡è‡ªåŠ¨æ³¨å†Œåˆ°å‘ç°ç³»ç»Ÿ</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Init</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ‰‹åŠ¨æ³¨å†Œå…¶ä»–å®ä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>registry</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>NewRegistry</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Register</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Service</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>:    <span style=color:#e6db74>&#34;payment-service&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Version</span>: <span style=color:#e6db74>&#34;1.0.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Nodes</span>: []<span style=color:#f92672>*</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Node</span>{
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Id</span>:      <span style=color:#e6db74>&#34;payment-service-1&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Address</span>: <span style=color:#e6db74>&#34;10.0.0.1:9090&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Metadata</span>: <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;region&#34;</span>: <span style=color:#e6db74>&#34;us-east-1&#34;</span>,
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div><p><strong>å¥åº·æ£€æŸ¥ï¼š</strong></p><ul><li><strong>ä¸»åŠ¨æ£€æŸ¥</strong>ï¼šå®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€</li><li><strong>è¢«åŠ¨æ£€æµ‹</strong>ï¼šåŸºäºå¿ƒè·³æœºåˆ¶</li><li><strong>è‡ªåŠ¨æ‘˜é™¤</strong>ï¼šä¸å¥åº·æœåŠ¡è‡ªåŠ¨ä»æ³¨å†Œä¸­å¿ƒç§»é™¤</li></ul><h3 id=-load-balancing---æ™ºèƒ½è´Ÿè½½å‡è¡¡>âš–ï¸ Load Balancing - æ™ºèƒ½è´Ÿè½½å‡è¡¡</h3><p>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡åŸºäºæœåŠ¡å‘ç°ï¼Œä¸ºè¯·æ±‚åˆ†å‘æä¾›äº†å¤šç§ç­–ç•¥ã€‚</p><p><strong>è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</strong></p><ul><li><strong>éšæœºå“ˆå¸Œ</strong>ï¼šé»˜è®¤ç­–ç•¥ï¼Œæä¾›å‡åŒ€åˆ†å¸ƒ</li><li><strong>è½®è¯¢</strong>ï¼šä¾æ¬¡é€‰æ‹©å¯ç”¨èŠ‚ç‚¹</li><li><strong>æœ€å°‘è¿æ¥</strong>ï¼šé€‰æ‹©è¿æ¥æ•°æœ€å°‘çš„èŠ‚ç‚¹</li><li><strong>ä¸€è‡´æ€§å“ˆå¸Œ</strong>ï¼šé€‚åˆç¼“å­˜åœºæ™¯</li></ul><p><strong>é‡è¯•æœºåˆ¶ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>balancer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>balancer</span>.<span style=color:#a6e22e>NewRandomBalancer</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>balancer</span>.<span style=color:#a6e22e>WithRetries</span>(<span style=color:#ae81ff>3</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>balancer</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span><span style=color:#f92672>*</span><span style=color:#ae81ff>30</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>balancer</span>.<span style=color:#a6e22e>WithBackoff</span>(<span style=color:#a6e22e>backoff</span>.<span style=color:#a6e22e>NewExponentialBackoff</span>()),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// åœ¨æœåŠ¡ä¸­ä½¿ç”¨</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewService</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Name</span>(<span style=color:#e6db74>&#34;order-service&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Selector</span>(<span style=color:#a6e22e>selector</span>.<span style=color:#a6e22e>NewSelector</span>(<span style=color:#a6e22e>selector</span>.<span style=color:#a6e22e>WithBalancer</span>(<span style=color:#a6e22e>balancer</span>))),
</span></span><span style=display:flex><span>)</span></span></code></pre></div></div><p><strong>å®¹é”™ç‰¹æ€§ï¼š</strong></p><ul><li><strong>æ–­è·¯å™¨</strong>ï¼šé˜²æ­¢çº§è”æ•…éšœ</li><li><strong>è¶…æ—¶æ§åˆ¶</strong>ï¼šé¿å…é•¿æ—¶é—´ç­‰å¾…</li><li><strong>é‡è¯•ç­–ç•¥</strong>ï¼šæ™ºèƒ½é‡è¯•å¤±è´¥è¯·æ±‚</li></ul><h3 id=-message-encoding---çµæ´»æ¶ˆæ¯ç¼–ç >ğŸ“¦ Message Encoding - çµæ´»æ¶ˆæ¯ç¼–ç </h3><p>åŸºäºå†…å®¹ç±»å‹çš„åŠ¨æ€æ¶ˆæ¯ç¼–ç ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§åºåˆ—åŒ–æ ¼å¼çš„æ— ç¼åˆ‡æ¢ã€‚</p><p><strong>æ”¯æŒçš„ç¼–ç æ ¼å¼ï¼š</strong></p><ul><li><strong>Protocol Buffers</strong>ï¼šé«˜æ€§èƒ½äºŒè¿›åˆ¶æ ¼å¼</li><li><strong>JSON</strong>ï¼šé€šç”¨æ–‡æœ¬æ ¼å¼</li><li><strong>MessagePack</strong>ï¼šé«˜æ•ˆçš„äºŒè¿›åˆ¶JSON</li><li><strong>XML</strong>ï¼šä¼ ç»Ÿä¼ä¸šæ ¼å¼</li></ul><p><strong>è‡ªå®šä¹‰ç¼–ç å™¨ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰ç¼–ç å™¨ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CustomEncoder</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomEncoder</span>) <span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}) ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomEncoder</span>) <span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span> []<span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>v</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>v</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomEncoder</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;custom&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ³¨å†Œç¼–ç å™¨</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>codec</span>.<span style=color:#a6e22e>Register</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>CustomEncoder</span>{})</span></span></code></pre></div></div><p><strong>è‡ªåŠ¨åå•†ï¼š</strong></p><ul><li><strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨åå•†</strong>ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³ç¼–ç æ ¼å¼</li><li><strong>ç‰ˆæœ¬å…¼å®¹</strong>ï¼šæ”¯æŒä¸åŒç‰ˆæœ¬é—´çš„æ¶ˆæ¯å…¼å®¹</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä¼˜ç¼–ç </li></ul><h3 id=-rpc-clientserver---é«˜æ€§èƒ½rpcé€šä¿¡>ğŸ”„ RPC Client/Server - é«˜æ€§èƒ½RPCé€šä¿¡</h3><p>åŸºäºè¯·æ±‚å“åº”æ¨¡å¼çš„RPCç³»ç»Ÿï¼Œæ”¯æŒåŒå‘æµå¼é€šä¿¡ï¼Œä¸ºåŒæ­¥é€šä¿¡æä¾›äº†å¼ºå¤§æŠ½è±¡ã€‚</p><p><strong>æœåŠ¡å®šä¹‰ç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// æœåŠ¡æ¥å£å®šä¹‰</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GreeterHandler</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Hello</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloRequest</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloResponse</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Stream</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>GreeterStream</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è¯·æ±‚æ¶ˆæ¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>HelloRequest</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`protobuf:&#34;bytes,1,opt,name=name&#34; json:&#34;name,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å“åº”æ¶ˆæ¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>HelloResponse</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`protobuf:&#34;bytes,1,opt,name=message&#34; json:&#34;message,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æœåŠ¡å®ç°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Greeter</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Greeter</span>) <span style=color:#a6e22e>Hello</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloRequest</span>, <span style=color:#a6e22e>rsp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>HelloResponse</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rsp</span>.<span style=color:#a6e22e>Message</span> = <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Greeter</span>) <span style=color:#a6e22e>Stream</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>stream</span> <span style=color:#a6e22e>GreeterStream</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>HelloRequest</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>stream</span>.<span style=color:#a6e22e>Recv</span>(<span style=color:#a6e22e>req</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rsp</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>HelloResponse</span>{<span style=color:#a6e22e>Message</span>: <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Name</span>}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>stream</span>.<span style=color:#a6e22e>Send</span>(<span style=color:#a6e22e>rsp</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ³¨å†ŒæœåŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>RegisterHandler</span>(<span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Server</span>(), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Greeter</span>{})</span></span></code></pre></div></div><p><strong>æµå¼é€šä¿¡ï¼š</strong></p><ul><li><strong>åŒå‘æµ</strong>ï¼šå…¨åŒå·¥é€šä¿¡æ”¯æŒ</li><li><strong>æœåŠ¡ç«¯æµ</strong>ï¼šå•æ¬¡è¯·æ±‚ï¼Œå¤šæ¬¡å“åº”</li><li><strong>å®¢æˆ·ç«¯æµ</strong>ï¼šå¤šæ¬¡è¯·æ±‚ï¼Œå•æ¬¡å“åº”</li></ul><h3 id=-async-messaging---å¼‚æ­¥æ¶ˆæ¯ç³»ç»Ÿ>ğŸ“¨ Async Messaging - å¼‚æ­¥æ¶ˆæ¯ç³»ç»Ÿ</h3><p>PubSub ä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œä¸ºäº‹ä»¶é©±åŠ¨æ¶æ„æä¾›äº†å¼ºå¤§çš„å¼‚æ­¥é€šä¿¡èƒ½åŠ›ã€‚</p><p><strong>æ¶ˆæ¯å‘å¸ƒç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åˆ›å»ºæ¶ˆæ¯å‘å¸ƒè€…</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>publisher</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewEvent</span>(<span style=color:#e6db74>&#34;user.events&#34;</span>, <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Client</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å‘å¸ƒäº‹ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>publisher</span>.<span style=color:#a6e22e>Publish</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>UserCreatedEvent</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>UserID</span>:    <span style=color:#e6db74>&#34;123&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Username</span>:  <span style=color:#e6db74>&#34;johndoe&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Email</span>:     <span style=color:#e6db74>&#34;john@example.com&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Timestamp</span>: <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>(),
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è®¢é˜…æ¶ˆæ¯</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>subscriber</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewSubscriber</span>(<span style=color:#e6db74>&#34;user.events&#34;</span>, <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Server</span>())
</span></span><span style=display:flex><span><span style=color:#a6e22e>subscriber</span>.<span style=color:#a6e22e>Subscribe</span>(<span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>event</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserCreatedEvent</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;New user created: %s&#34;</span>, <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>Username</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¤„ç†ç”¨æˆ·åˆ›å»ºäº‹ä»¶</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div><p><strong>äº‹ä»¶æ¨¡å¼ï¼š</strong></p><ul><li><strong>é¢†åŸŸäº‹ä»¶</strong>ï¼šä¸šåŠ¡é¢†åŸŸçŠ¶æ€å˜æ›´</li><li><strong>é›†æˆäº‹ä»¶</strong>ï¼šç³»ç»Ÿé—´æ•°æ®åŒæ­¥</li><li><strong>é€šçŸ¥äº‹ä»¶</strong>ï¼šå¼‚æ­¥é€šçŸ¥å’Œæé†’</li></ul><h3 id=-event-streaming---é«˜çº§äº‹ä»¶æµå¤„ç†>ğŸŒŠ Event Streaming - é«˜çº§äº‹ä»¶æµå¤„ç†</h3><p>å¯¹äºéœ€è¦æŒä¹…åŒ–å’Œæœ‰åºæ¶ˆè´¹çš„åœºæ™¯ï¼ŒGo Micro æä¾›äº†ä¸“ä¸šçš„äº‹ä»¶æµå¤„ç†èƒ½åŠ›ã€‚</p><p><strong>æ”¯æŒçš„æµå¤„ç†ç³»ç»Ÿï¼š</strong></p><ul><li><strong>NATS Jetstream</strong>ï¼šé«˜æ€§èƒ½æµå¤„ç†ç³»ç»Ÿ</li><li><strong>Redis Streams</strong>ï¼šè½»é‡çº§æµå¤„ç†æ–¹æ¡ˆ</li><li><strong>Kafka</strong>ï¼šä¼ä¸šçº§æµå¤„ç†å¹³å°</li></ul><p><strong>æµå¤„ç†ç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åˆ›å»ºæµæ¶ˆè´¹è€…</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>stream</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>jetstream</span>.<span style=color:#a6e22e>NewStream</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jetstream</span>.<span style=color:#a6e22e>WithSubject</span>(<span style=color:#e6db74>&#34;orders&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jetstream</span>.<span style=color:#a6e22e>WithConsumer</span>(<span style=color:#e6db74>&#34;order-processor&#34;</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä»ç‰¹å®šåç§»é‡æ¶ˆè´¹</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>consumer</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>stream</span>.<span style=color:#a6e22e>Consume</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jetstream</span>.<span style=color:#a6e22e>WithOffset</span>(<span style=color:#a6e22e>jetstream</span>.<span style=color:#a6e22e>OffsetStart</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>jetstream</span>.<span style=color:#a6e22e>WithAck</span>(<span style=color:#66d9ef>true</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¤„ç†æ¶ˆæ¯</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>msg</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>consumer</span>.<span style=color:#a6e22e>Next</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error consuming message: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>Order</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>msg</span>.<span style=color:#a6e22e>Data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>order</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error unmarshaling order: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¤„ç†è®¢å•</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processOrder</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>order</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error processing order: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç¡®è®¤æ¶ˆæ¯</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>msg</span>.<span style=color:#a6e22e>Ack</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error acking message: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p><strong>æµå¤„ç†ç‰¹æ€§ï¼š</strong></p><ul><li><strong>æŒä¹…åŒ–å­˜å‚¨</strong>ï¼šæ¶ˆæ¯æŒä¹…åŒ–ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</li><li><strong>åç§»é‡ç®¡ç†</strong>ï¼šç²¾ç¡®æ§åˆ¶æ¶ˆè´¹ä½ç½®</li><li><strong>æ¶ˆæ¯ç¡®è®¤</strong>ï¼šå¯é çš„æ¶ˆæ¯ä¼ é€’ä¿è¯</li><li><strong>å›æ”¾èƒ½åŠ›</strong>ï¼šæ”¯æŒå†å²æ•°æ®å›æ”¾</li></ul><h3 id=-synchronization---åˆ†å¸ƒå¼åŒæ­¥>ğŸ”’ Synchronization - åˆ†å¸ƒå¼åŒæ­¥</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹ï¼ŒGo Micro æä¾›äº†åˆ†å¸ƒå¼é”å’Œé¢†å¯¼é€‰ä¸¾ç­‰åŒæ­¥åŸè¯­ã€‚</p><p><strong>åˆ†å¸ƒå¼é”ç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åˆ›å»ºåˆ†å¸ƒå¼é”</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>lock</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>NewLock</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WithId</span>(<span style=color:#e6db74>&#34;resource-lock&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WithTTL</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Minute</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è·å–é”</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lock</span>.<span style=color:#a6e22e>Acquire</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Failed to acquire lock: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç¡®ä¿æœ€ç»ˆé‡Šæ”¾é”</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>lock</span>.<span style=color:#a6e22e>Release</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ‰§è¡Œéœ€è¦åŒæ­¥çš„æ“ä½œ</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>performCriticalOperation</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Operation failed: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p><strong>é¢†å¯¼é€‰ä¸¾ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// å‚ä¸é¢†å¯¼é€‰ä¸¾</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>candidate</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>NewCandidate</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WithId</span>(<span style=color:#e6db74>&#34;leader-candidate-1&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WithElectionID</span>(<span style=color:#e6db74>&#34;service-leader&#34;</span>),
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç«é€‰é¢†å¯¼è€…</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>isLeader</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>candidate</span>.<span style=color:#a6e22e>Campaign</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Failed to campaign for leadership: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isLeader</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Elected as leader&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ‰§è¡Œé¢†å¯¼è€…èŒè´£</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>performLeaderDuties</span>()
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Became follower&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ‰§è¡Œè·Ÿéšè€…èŒè´£</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>performFollowerDuties</span>()
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p><strong>åŒæ­¥æ¨¡å¼ï¼š</strong></p><ul><li><strong>äº’æ–¥é”</strong>ï¼šç¡®ä¿èµ„æºç‹¬å è®¿é—®</li><li><strong>è¯»å†™é”</strong>ï¼šä¼˜åŒ–å¹¶å‘è¯»å–æ€§èƒ½</li><li><strong>ä¿¡å·é‡</strong>ï¼šæ§åˆ¶å¹¶å‘è®¿é—®æ•°é‡</li><li><strong>å±éšœ</strong>ï¼šåŒæ­¥å¤šä¸ªåç¨‹çš„æ‰§è¡Œ</li></ul><h3 id=-pluggable-interfaces---æ’ä»¶åŒ–æ¶æ„>ğŸ”Œ Pluggable Interfaces - æ’ä»¶åŒ–æ¶æ„</h3><p>Go Micro çš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯é€šè¿‡ Go æ¥å£å®ç°æ‰€æœ‰åˆ†å¸ƒå¼ç³»ç»ŸæŠ½è±¡ï¼Œä½¿å¾—æ•´ä¸ªæ¡†æ¶å…·æœ‰æå¼ºçš„å¯æ‰©å±•æ€§ã€‚</p><p><strong>æ¥å£è®¾è®¡ç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// å®šä¹‰æ’ä»¶æ¥å£</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Plugin</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Option</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Options</span>() <span style=color:#a6e22e>Options</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å®ç°è‡ªå®šä¹‰æ’ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CustomRegistry</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>Options</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;custom-registry&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>Option</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>opt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>opts</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>opt</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Register</span>(<span style=color:#a6e22e>service</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>, <span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>RegisterOption</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°è‡ªå®šä¹‰æ³¨å†Œé€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Deregister</span>(<span style=color:#a6e22e>service</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Service</span>, <span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>DeregisterOption</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°è‡ªå®šä¹‰æ³¨é”€é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// æ³¨å†Œæ’ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Register</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>CustomRegistry</span>{})</span></span></code></pre></div></div><p><strong>æ’ä»¶ç±»å‹ï¼š</strong></p><ul><li><strong>æ³¨å†Œä¸­å¿ƒ</strong>ï¼šæœåŠ¡å‘ç°æ’ä»¶</li><li><strong>æ¶ˆæ¯ä»£ç†</strong>ï¼šæ¶ˆæ¯ç³»ç»Ÿæ’ä»¶</li><li><strong>é…ç½®æº</strong>ï¼šé…ç½®ç®¡ç†æ’ä»¶</li><li><strong>å­˜å‚¨åç«¯</strong>ï¼šæ•°æ®å­˜å‚¨æ’ä»¶</li><li><strong>ç¼–ç å™¨</strong>ï¼šåºåˆ—åŒ–æ’ä»¶</li><li><strong>ä¼ è¾“å±‚</strong>ï¼šç½‘ç»œé€šä¿¡æ’ä»¶</li></ul><p><strong>ä¼˜åŠ¿ç‰¹æ€§ï¼š</strong></p><ul><li><strong>çƒ­æ’æ‹”</strong>ï¼šè¿è¡Œæ—¶æ›¿æ¢æ’ä»¶å®ç°</li><li><strong>å¤šå®ç°</strong>ï¼šåŒä¸€æ¥å£æ”¯æŒå¤šç§å®ç°</li><li><strong>å‘åå…¼å®¹</strong>ï¼šæ’ä»¶å‡çº§ä¸å½±å“ç°æœ‰ä»£ç </li><li><strong>æµ‹è¯•å‹å¥½</strong>ï¼šæ˜“äºmockå’Œæµ‹è¯•</li></ul><h2 id=ç”Ÿæ€å·¥å…·é“¾æ·±åº¦è§£æ>ç”Ÿæ€å·¥å…·é“¾æ·±åº¦è§£æ</h2><p>Go Micro ä¸ä»…ä»…æ˜¯æ ¸å¿ƒæ¡†æ¶ï¼Œæ›´åŒ…å«äº†ä¸€æ•´å¥—å®Œæ•´çš„å·¥å…·é“¾ï¼Œä¸ºå¾®æœåŠ¡å¼€å‘æä¾›äº†ä»å¼€å‘åˆ°éƒ¨ç½²çš„å…¨ç”Ÿå‘½å‘¨æœŸæ”¯æŒã€‚</p><h3 id=-api-gateway---ç»Ÿä¸€æœåŠ¡å…¥å£>ğŸŒ API Gateway - ç»Ÿä¸€æœåŠ¡å…¥å£</h3><p>API Gateway ä½œä¸ºæ‰€æœ‰å¤–éƒ¨è¯·æ±‚çš„ç»Ÿä¸€å…¥å£ï¼Œæä¾›äº†è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯ã€é™æµç­‰åŠŸèƒ½ã€‚</p><p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p><ul><li><strong>è·¯ç”±ç®¡ç†</strong>ï¼šåŸºäºè·¯å¾„ã€ä¸»æœºã€æ–¹æ³•çš„è·¯ç”±è§„åˆ™</li><li><strong>åè®®è½¬æ¢</strong>ï¼šæ”¯æŒ HTTPã€gRPCã€WebSocket ç­‰åè®®</li><li><strong>è®¤è¯æˆæƒ</strong>ï¼šç»Ÿä¸€çš„èº«ä»½éªŒè¯å’Œæƒé™æ§åˆ¶</li><li><strong>é™æµç†”æ–­</strong>ï¼šä¿æŠ¤åç«¯æœåŠ¡ä¸è¢«è¿‡è½½</li><li><strong>ç›‘æ§ç»Ÿè®¡</strong>ï¼šå®æ—¶ç›‘æ§ API è°ƒç”¨æƒ…å†µ</li></ul><p><strong>éƒ¨ç½²ç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨ API Gateway</span>
</span></span><span style=display:flex><span>micro api --handler<span style=color:#f92672>=</span>rpc --namespace<span style=color:#f92672>=</span>go.micro.api
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ·»åŠ è·¯ç”±è§„åˆ™</span>
</span></span><span style=display:flex><span>micro api add route --handler<span style=color:#f92672>=</span>rpc --namespace<span style=color:#f92672>=</span>go.micro.api <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --path<span style=color:#f92672>=</span>/user --method<span style=color:#f92672>=</span>POST --service<span style=color:#f92672>=</span>user-service
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¾ç½®é™æµ</span>
</span></span><span style=display:flex><span>micro api set limit --path<span style=color:#f92672>=</span>/user --requests<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span> --window<span style=color:#f92672>=</span>1m</span></span></code></pre></div></div><h3 id=-cli-å·¥å…·---å‘½ä»¤è¡Œç®¡ç†ä¸­å¿ƒ>ğŸ› ï¸ CLI å·¥å…· - å‘½ä»¤è¡Œç®¡ç†ä¸­å¿ƒ</h3><p>CLI å·¥å…·æ˜¯ Go Micro çš„ç‘å£«å†›åˆ€ï¼Œæä¾›äº†æœåŠ¡ç®¡ç†çš„æ‰€æœ‰å¿…è¦æ“ä½œã€‚</p><p><strong>å¸¸ç”¨å‘½ä»¤ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æœåŠ¡ç®¡ç†</span>
</span></span><span style=display:flex><span>micro list          <span style=color:#75715e># åˆ—å‡ºæ‰€æœ‰æœåŠ¡</span>
</span></span><span style=display:flex><span>micro status        <span style=color:#75715e># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span>micro call service-name method <span style=color:#e6db74>&#39;{&#34;data&#34;: &#34;value&#34;}&#39;</span>  <span style=color:#75715e># è°ƒç”¨æœåŠ¡</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®ç®¡ç†</span>
</span></span><span style=display:flex><span>micro config set key value     <span style=color:#75715e># è®¾ç½®é…ç½®</span>
</span></span><span style=display:flex><span>micro config get key          <span style=color:#75715e># è·å–é…ç½®</span>
</span></span><span style=display:flex><span>micro config list             <span style=color:#75715e># åˆ—å‡ºæ‰€æœ‰é…ç½®</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æœåŠ¡æ³¨å†Œ</span>
</span></span><span style=display:flex><span>micro register service-name --version<span style=color:#f92672>=</span>1.0.0 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --address<span style=color:#f92672>=</span>192.168.1.100:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --metadata<span style=color:#f92672>=</span>region<span style=color:#f92672>=</span>us-east-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¥åº·æ£€æŸ¥</span>
</span></span><span style=display:flex><span>micro health service-name     <span style=color:#75715e># æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€</span>
</span></span><span style=display:flex><span>micro stats                  <span style=color:#75715e># æŸ¥çœ‹æœåŠ¡ç»Ÿè®¡ä¿¡æ¯</span></span></span></code></pre></div></div><p><strong>è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e># æœåŠ¡éƒ¨ç½²è„šæœ¬</span>
</span></span><span style=display:flex><span>SERVICE_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;user-service&#34;</span>
</span></span><span style=display:flex><span>VERSION<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1.0.0&#34;</span>
</span></span><span style=display:flex><span>REGISTRY<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;consul://localhost:8500&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ„å»ºæœåŠ¡</span>
</span></span><span style=display:flex><span>go build -o $SERVICE_NAME main.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ³¨å†ŒæœåŠ¡</span>
</span></span><span style=display:flex><span>micro register $SERVICE_NAME <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --version<span style=color:#f92672>=</span>$VERSION <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --address<span style=color:#f92672>=</span>localhost:8080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --registry<span style=color:#f92672>=</span>$REGISTRY <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --metadata<span style=color:#f92672>=</span>env<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¥åº·æ£€æŸ¥</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i in <span style=color:#f92672>{</span>1..30<span style=color:#f92672>}</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> micro health $SERVICE_NAME; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Service is healthy&#34;</span>
</span></span><span style=display:flex><span>        break
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;Waiting for service to be healthy...&#34;</span>
</span></span><span style=display:flex><span>    sleep <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span></span></span></code></pre></div></div><h3 id=-demo-é¡¹ç›®---å­¦ä¹ æœ€ä½³å®è·µ>ğŸ¯ Demo é¡¹ç›® - å­¦ä¹ æœ€ä½³å®è·µ</h3><p>Demo é¡¹ç›®åŒ…å«äº†ä¸€ç³»åˆ—å®Œæ•´çš„å¾®æœåŠ¡ç¤ºä¾‹ï¼Œå±•ç¤ºäº† Go Micro çš„æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼ã€‚</p><p><strong>åŒ…å«çš„ç¤ºä¾‹ï¼š</strong></p><ul><li><strong>ç”¨æˆ·æœåŠ¡</strong>ï¼šå®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</li><li><strong>è®¢å•æœåŠ¡</strong>ï¼šè®¢å•å¤„ç†å’ŒçŠ¶æ€ç®¡ç†</li><li><strong>æ”¯ä»˜æœåŠ¡</strong>ï¼šæ”¯ä»˜é›†æˆå’Œäº‹åŠ¡å¤„ç†</li><li><strong>é€šçŸ¥æœåŠ¡</strong>ï¼šé‚®ä»¶å’ŒçŸ­ä¿¡é€šçŸ¥</li><li><strong>ç½‘å…³æœåŠ¡</strong>ï¼šAPI èšåˆå’Œè·¯ç”±</li></ul><p><strong>å¿«é€Ÿå¼€å§‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…‹éš†ç¤ºä¾‹é¡¹ç›®</span>
</span></span><span style=display:flex><span>git clone https://github.com/go-micro/demo.git
</span></span><span style=display:flex><span>cd demo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨ä¾èµ–æœåŠ¡ï¼ˆä½¿ç”¨ Docker Composeï¼‰</span>
</span></span><span style=display:flex><span>docker-compose up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ„å»ºå’Œå¯åŠ¨æ‰€æœ‰æœåŠ¡</span>
</span></span><span style=display:flex><span>make build
</span></span><span style=display:flex><span>make run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æµ‹è¯•æœåŠ¡</span>
</span></span><span style=display:flex><span>curl -X POST http://localhost:8080/user/create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -d <span style=color:#e6db74>&#39;{&#34;name&#34;: &#34;John Doe&#34;, &#34;email&#34;: &#34;john@example.com&#34;}&#39;</span></span></span></code></pre></div></div><h3 id=-plugin-ç³»ç»Ÿ---æ— é™æ‰©å±•æ€§>ğŸ”Œ Plugin ç³»ç»Ÿ - æ— é™æ‰©å±•æ€§</h3><p>Plugin ç³»ç»Ÿæ˜¯ Go Micro çš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµçš„ä¸­é—´ä»¶å’Œå­˜å‚¨ç³»ç»Ÿã€‚</p><p><strong>å¸¸ç”¨æ’ä»¶ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// åœ¨ main.go ä¸­å¼•å…¥æ’ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/plugins/v4/registry/consul&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/plugins/v4/broker/nats&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/plugins/v4/config/etcd&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/plugins/v4/transport/grpc&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/plugins/v4/store/redis&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ä½¿ç”¨æ’ä»¶åˆ›å»ºæœåŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨ Consul ä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>reg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>consul</span>.<span style=color:#a6e22e>NewRegistry</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Addrs</span>(<span style=color:#e6db74>&#34;127.0.0.1:8500&#34;</span>),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨ NATS ä½œä¸ºæ¶ˆæ¯ä»£ç†</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>brk</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>nats</span>.<span style=color:#a6e22e>NewBroker</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>broker</span>.<span style=color:#a6e22e>Addrs</span>(<span style=color:#e6db74>&#34;nats://127.0.0.1:4222&#34;</span>),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä½¿ç”¨ etcd ä½œä¸ºé…ç½®ä¸­å¿ƒ</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>conf</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>etcd</span>.<span style=color:#a6e22e>NewConfig</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>config</span>.<span style=color:#a6e22e>Endpoints</span>(<span style=color:#e6db74>&#34;127.0.0.1:2379&#34;</span>),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºæœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewService</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Name</span>(<span style=color:#e6db74>&#34;example-service&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Registry</span>(<span style=color:#a6e22e>reg</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Broker</span>(<span style=color:#a6e22e>brk</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Config</span>(<span style=color:#a6e22e>conf</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Transport</span>(<span style=color:#a6e22e>transport</span>.<span style=color:#a6e22e>NewTransport</span>()),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Init</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Run</span>()
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><p><strong>è‡ªå®šä¹‰æ’ä»¶å¼€å‘ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// å¼€å‘è‡ªå®šä¹‰æ³¨å†Œä¸­å¿ƒæ’ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>custom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/go-micro/v4/registry&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>CustomRegistry</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>options</span> <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Options</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Init</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Option</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>opt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>opts</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>opt</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>options</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Options</span>() <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Options</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>options</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Register</span>(<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Service</span>, <span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>RegisterOption</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°æ³¨å†Œé€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Deregister</span>(<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Service</span>, <span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>DeregisterOption</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°æ³¨é”€é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>GetService</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>GetOption</span>) ([]<span style=color:#f92672>*</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Service</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°æœåŠ¡å‘ç°é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>ListServices</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>ListOption</span>) ([]<span style=color:#f92672>*</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Service</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°æœåŠ¡åˆ—è¡¨é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>Watch</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>WatchOption</span>) (<span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Watcher</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å®ç°æœåŠ¡ç›‘æ§é€»è¾‘</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>CustomRegistry</span>) <span style=color:#a6e22e>String</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;custom-registry&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å·¥å‚å‡½æ•°</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewRegistry</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Option</span>) <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Registry</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>CustomRegistry</span>{}
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><h3 id=-examples-é›†åˆ---å®æˆ˜åœºæ™¯è¦†ç›–>ğŸ“š Examples é›†åˆ - å®æˆ˜åœºæ™¯è¦†ç›–</h3><p>Examples é¡¹ç›®åŒ…å«äº†å„ç§å®é™…åº”ç”¨åœºæ™¯çš„å®Œæ•´ç¤ºä¾‹ï¼Œæ˜¯å­¦ä¹  Go Micro çš„æœ€ä½³èµ„æºã€‚</p><p><strong>åˆ†ç±»ç¤ºä¾‹ï¼š</strong></p><ul><li><strong>åŸºç¡€ç¤ºä¾‹</strong>ï¼šæœåŠ¡å®šä¹‰ã€RPC è°ƒç”¨ã€äº‹ä»¶å¤„ç†</li><li><strong>è¿›é˜¶ç¤ºä¾‹</strong>ï¼šæµå¼é€šä¿¡ã€æ‰¹é‡å¤„ç†ã€é”™è¯¯å¤„ç†</li><li><strong>æ¶æ„ç¤ºä¾‹</strong>ï¼šCQRS æ¨¡å¼ã€äº‹ä»¶æº¯æºã€Saga æ¨¡å¼</li><li><strong>éƒ¨ç½²ç¤ºä¾‹</strong>ï¼šDocker å®¹å™¨åŒ–ã€Kubernetes éƒ¨ç½²ã€æœåŠ¡ç½‘æ ¼</li></ul><p><strong>æ ¸å¿ƒç¤ºä¾‹è§£æï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// å®Œæ•´çš„æœåŠ¡ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/go-micro/v4&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/go-micro/go-micro/v4/server&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>proto</span> <span style=color:#e6db74>&#34;github.com/go-micro/examples/service/proto&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Example</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Example</span>) <span style=color:#a6e22e>Call</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>proto</span>.<span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>rsp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>proto</span>.<span style=color:#a6e22e>Response</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rsp</span>.<span style=color:#a6e22e>Msg</span> = <span style=color:#e6db74>&#34;Hello &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Example</span>) <span style=color:#a6e22e>Stream</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>proto</span>.<span style=color:#a6e22e>StreamingRequest</span>, <span style=color:#a6e22e>stream</span> <span style=color:#a6e22e>proto</span>.<span style=color:#a6e22e>Example_StreamStream</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; int(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>Count</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>stream</span>.<span style=color:#a6e22e>Send</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>proto</span>.<span style=color:#a6e22e>StreamingResponse</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Count</span>: int64(<span style=color:#a6e22e>i</span>),
</span></span><span style=display:flex><span>        }); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆ›å»ºæœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>service</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewService</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Name</span>(<span style=color:#e6db74>&#34;go.micro.api.example&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Version</span>(<span style=color:#e6db74>&#34;latest&#34;</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Metadata</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;example&#34;</span>,
</span></span><span style=display:flex><span>        }),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆå§‹åŒ–æœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Init</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ³¨å†Œå¤„ç†å™¨</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>proto</span>.<span style=color:#a6e22e>RegisterExampleHandler</span>(<span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Server</span>(), <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Example</span>{})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>service</span>.<span style=color:#a6e22e>Run</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><h3 id=-dashboard---å¯è§†åŒ–ç®¡ç†å¹³å°>ğŸ“Š Dashboard - å¯è§†åŒ–ç®¡ç†å¹³å°</h3><p>Dashboard æä¾›äº† Web ç•Œé¢æ¥ç®¡ç†å’Œç›‘æ§å¾®æœåŠ¡ç³»ç»Ÿï¼Œè®©è¿ç»´å·¥ä½œæ›´åŠ ç›´è§‚å’Œé«˜æ•ˆã€‚</p><p><strong>åŠŸèƒ½ç‰¹æ€§ï¼š</strong></p><ul><li><strong>æœåŠ¡æ‹“æ‰‘å›¾</strong>ï¼šå¯è§†åŒ–æœåŠ¡é—´ä¾èµ–å…³ç³»</li><li><strong>å®æ—¶ç›‘æ§</strong>ï¼šæœåŠ¡å¥åº·çŠ¶æ€ã€æ€§èƒ½æŒ‡æ ‡</li><li><strong>é…ç½®ç®¡ç†</strong>ï¼šåœ¨çº¿ä¿®æ”¹é…ç½®å’ŒæŸ¥çœ‹å†å²</li><li><strong>æ—¥å¿—æŸ¥çœ‹</strong>ï¼šèšåˆæ—¥å¿—å’Œé”™è¯¯è¿½è¸ª</li><li><strong>æµé‡æ§åˆ¶</strong>ï¼šåŠ¨æ€è°ƒæ•´é™æµå’Œç†”æ–­ç­–ç•¥</li></ul><p><strong>éƒ¨ç½²å’Œä½¿ç”¨ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨ Dashboard</span>
</span></span><span style=display:flex><span>micro dashboard --address<span style=color:#f92672>=</span>:8080
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è®¿é—® Dashboard</span>
</span></span><span style=display:flex><span>open http://localhost:8080
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ·»åŠ æœåŠ¡ç›‘æ§</span>
</span></span><span style=display:flex><span>micro dashboard add service user-service <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --health-check<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --metrics-collection<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --log-collection<span style=color:#f92672>=</span>true</span></span></code></pre></div></div><h3 id=-generator---ä»£ç ç”Ÿæˆå·¥å…·>âš¡ Generator - ä»£ç ç”Ÿæˆå·¥å…·</h3><p>Generator å·¥å…·å¯ä»¥æ ¹æ® Protocol Buffers å®šä¹‰è‡ªåŠ¨ç”ŸæˆæœåŠ¡ä»£ç ï¼Œæå¤§æé«˜å¼€å‘æ•ˆç‡ã€‚</p><p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1. å®šä¹‰æœåŠ¡æ¥å£</span>
</span></span><span style=display:flex><span>syntax <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;proto3&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>package go.micro.api.user;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>service UserService <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    rpc CreateUser<span style=color:#f92672>(</span>CreateUserRequest<span style=color:#f92672>)</span> returns <span style=color:#f92672>(</span>CreateUserResponse<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>    rpc GetUser<span style=color:#f92672>(</span>GetUserRequest<span style=color:#f92672>)</span> returns <span style=color:#f92672>(</span>GetUserResponse<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>    rpc ListUsers<span style=color:#f92672>(</span>ListUsersRequest<span style=color:#f92672>)</span> returns <span style=color:#f92672>(</span>ListUsersResponse<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>    rpc UpdateUser<span style=color:#f92672>(</span>UpdateUserRequest<span style=color:#f92672>)</span> returns <span style=color:#f92672>(</span>UpdateUserResponse<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>    rpc DeleteUser<span style=color:#f92672>(</span>DeleteUserRequest<span style=color:#f92672>)</span> returns <span style=color:#f92672>(</span>DeleteUserResponse<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>message CreateUserRequest <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    string name <span style=color:#f92672>=</span> 1;
</span></span><span style=display:flex><span>    string email <span style=color:#f92672>=</span> 2;
</span></span><span style=display:flex><span>    string password <span style=color:#f92672>=</span> 3;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>message CreateUserResponse <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    string user_id <span style=color:#f92672>=</span> 1;
</span></span><span style=display:flex><span>    string message <span style=color:#f92672>=</span> 2;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// ... å…¶ä»–æ¶ˆæ¯å®šä¹‰</span></span></code></pre></div></div><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 2. ç”Ÿæˆä»£ç </span>
</span></span><span style=display:flex><span>micro new user-service --proto<span style=color:#f92672>=</span>user.proto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆçš„å†…å®¹ï¼š</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - user.pb.go       # Protocol Buffers ç”Ÿæˆçš„ä»£ç </span>
</span></span><span style=display:flex><span><span style=color:#75715e># - user.micro.go    # Micro ç”Ÿæˆçš„æœåŠ¡ä»£ç </span>
</span></span><span style=display:flex><span><span style=color:#75715e># - user_handler.go  # æœåŠ¡å¤„ç†å™¨æ¡†æ¶</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - user_client.go   # å®¢æˆ·ç«¯è°ƒç”¨ä»£ç </span>
</span></span><span style=display:flex><span><span style=color:#75715e># - main.go          # ä¸»ç¨‹åºå…¥å£</span></span></span></code></pre></div></div><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 3. å®ç°ä¸šåŠ¡é€»è¾‘</span>
</span></span><span style=display:flex><span>// user_handler.go
</span></span><span style=display:flex><span>type UserHandler struct<span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>func <span style=color:#f92672>(</span>h *UserHandler<span style=color:#f92672>)</span> CreateUser<span style=color:#f92672>(</span>ctx context.Context, req *pb.CreateUserRequest, rsp *pb.CreateUserResponse<span style=color:#f92672>)</span> error <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    // å®ç°ç”¨æˆ·åˆ›å»ºé€»è¾‘
</span></span><span style=display:flex><span>    user :<span style=color:#f92672>=</span> &amp;User<span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        ID:       generateUserID<span style=color:#f92672>()</span>,
</span></span><span style=display:flex><span>        Name:     req.Name,
</span></span><span style=display:flex><span>        Email:    req.Email,
</span></span><span style=display:flex><span>        Password: hashPassword<span style=color:#f92672>(</span>req.Password<span style=color:#f92672>)</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> err :<span style=color:#f92672>=</span> repository.CreateUser<span style=color:#f92672>(</span>ctx, user<span style=color:#f92672>)</span>; err !<span style=color:#f92672>=</span> nil <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> err
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    rsp.UserId <span style=color:#f92672>=</span> user.ID
</span></span><span style=display:flex><span>    rsp.Message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;User created successfully&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> nil
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// 4. å¯åŠ¨æœåŠ¡
</span></span><span style=display:flex><span>go run main.go</span></span></code></pre></div></div><p><strong>é«˜çº§ç‰¹æ€§ï¼š</strong></p><ul><li><strong>æ¨¡æ¿è‡ªå®šä¹‰</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰ä»£ç ç”Ÿæˆæ¨¡æ¿</li><li><strong>å¤šè¯­è¨€æ”¯æŒ</strong>ï¼šç”Ÿæˆ Goã€Javaã€Pythonã€JavaScript ç­‰å¤šç§è¯­è¨€çš„ä»£ç </li><li><strong>ç‰ˆæœ¬ç®¡ç†</strong>ï¼šæ”¯æŒ API ç‰ˆæœ¬ç®¡ç†å’Œå‘åå…¼å®¹</li><li><strong>æ–‡æ¡£ç”Ÿæˆ</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£å’Œ Swagger è§„èŒƒ</li></ul><h2 id=æ€»ç»“ä¸å±•æœ›>æ€»ç»“ä¸å±•æœ›</h2><h3 id=go-micro-çš„æ ¸å¿ƒä»·å€¼>Go Micro çš„æ ¸å¿ƒä»·å€¼</h3><p>Go Micro ä½œä¸ºä¸€ä¸ªæˆç†Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><h4 id=1-å¼€å‘æ•ˆç‡æå‡>1. <strong>å¼€å‘æ•ˆç‡æå‡</strong></h4><p>é€šè¿‡ç»Ÿä¸€çš„æœåŠ¡å®šä¹‰ã€è‡ªåŠ¨ä»£ç ç”Ÿæˆã€ä¸°å¯Œçš„å·¥å…·é“¾ï¼Œå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œè€Œä¸éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´åœ¨åŸºç¡€è®¾æ–½çš„æ­å»ºå’Œç»´æŠ¤ä¸Šã€‚</p><h4 id=2-æ¶æ„çµæ´»æ€§>2. <strong>æ¶æ„çµæ´»æ€§</strong></h4><p>æ’ä»¶åŒ–æ¶æ„è®©å›¢é˜Ÿå¯ä»¥æ ¹æ®æŠ€æœ¯é€‰å‹å’Œä¸šåŠ¡éœ€æ±‚ï¼Œè‡ªç”±é€‰æ‹©æœ€é€‚åˆçš„ç»„ä»¶ï¼Œé¿å…æŠ€æœ¯é”å®šï¼ŒåŒæ—¶ä¿æŒç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h4 id=3-ç”Ÿäº§çº§å¯é æ€§>3. <strong>ç”Ÿäº§çº§å¯é æ€§</strong></h4><p>å†…ç½®çš„å®¹é”™æœºåˆ¶ã€è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥ã€ç›‘æ§å‘Šè­¦ç­‰åŠŸèƒ½ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p><h4 id=4-ç”Ÿæ€ç³»ç»Ÿå®Œæ•´æ€§>4. <strong>ç”Ÿæ€ç³»ç»Ÿå®Œæ•´æ€§</strong></h4><p>ä»å¼€å‘å·¥å…·åˆ°éƒ¨ç½²è¿ç»´ï¼Œä»æœåŠ¡æ²»ç†åˆ°ç›‘æ§åˆ†æï¼ŒGo Micro æä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¾®æœåŠ¡å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><h3 id=æœ€ä½³å®è·µå»ºè®®>æœ€ä½³å®è·µå»ºè®®</h3><h4 id=1-æœåŠ¡è®¾è®¡åŸåˆ™>1. <strong>æœåŠ¡è®¾è®¡åŸåˆ™</strong></h4><ul><li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªæœåŠ¡åº”è¯¥èšç„¦äºå•ä¸€ä¸šåŠ¡é¢†åŸŸ</li><li><strong>è¾¹ç•Œæ¸…æ™°</strong>ï¼šæœåŠ¡é—´é€šè¿‡æ˜ç¡®å®šä¹‰çš„æ¥å£è¿›è¡Œé€šä¿¡</li><li><strong>æ— çŠ¶æ€è®¾è®¡</strong>ï¼šå°½å¯èƒ½ä¿æŒæœåŠ¡æ— çŠ¶æ€ï¼Œä¾¿äºæ°´å¹³æ‰©å±•</li><li><strong>ä¼˜é›…é™çº§</strong>ï¼šå®ç°é™çº§ç­–ç•¥ï¼Œæé«˜ç³»ç»Ÿå¯ç”¨æ€§</li></ul><h4 id=2-å¼€å‘è§„èŒƒ>2. <strong>å¼€å‘è§„èŒƒ</strong></h4><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// ç»Ÿä¸€çš„æœåŠ¡åˆå§‹åŒ–æ¨¡å¼</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewService</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Option</span>) <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Service</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// é»˜è®¤é…ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>defaultOpts</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Option</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Name</span>(<span style=color:#a6e22e>name</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Version</span>(<span style=color:#a6e22e>getVersion</span>()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Metadata</span>(<span style=color:#a6e22e>getMetadata</span>()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Registry</span>(<span style=color:#a6e22e>getRegistry</span>()),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>Broker</span>(<span style=color:#a6e22e>getBroker</span>()),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åˆå¹¶è‡ªå®šä¹‰é…ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>allOpts</span> <span style=color:#f92672>:=</span> append(<span style=color:#a6e22e>defaultOpts</span>, <span style=color:#a6e22e>opts</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>micro</span>.<span style=color:#a6e22e>NewService</span>(<span style=color:#a6e22e>allOpts</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ¨¡å¼</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>UserService</span>) <span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>CreateUserRequest</span>, <span style=color:#a6e22e>rsp</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>pb</span>.<span style=color:#a6e22e>CreateUserResponse</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‚æ•°éªŒè¯</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateCreateUserRequest</span>(<span style=color:#a6e22e>req</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>InvalidArgument</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>repo</span>.<span style=color:#a6e22e>CreateUser</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>Is</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>repository</span>.<span style=color:#a6e22e>ErrUserExists</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>AlreadyExists</span>, <span style=color:#e6db74>&#34;user already exists&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#a6e22e>codes</span>.<span style=color:#a6e22e>Internal</span>, <span style=color:#e6db74>&#34;failed to create user&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// æ„å»ºå“åº”</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rsp</span>.<span style=color:#a6e22e>UserId</span> = <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>ID</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rsp</span>.<span style=color:#a6e22e>Message</span> = <span style=color:#e6db74>&#34;User created successfully&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// å‘å¸ƒäº‹ä»¶</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>publishUserCreatedEvent</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>user</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;failed to publish user created event: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><h4 id=3-è¿ç»´ç­–ç•¥>3. <strong>è¿ç»´ç­–ç•¥</strong></h4><ul><li><strong>æ¸è¿›å¼éƒ¨ç½²</strong>ï¼šæ”¯æŒè“ç»¿éƒ¨ç½²ã€é‡‘ä¸é›€å‘å¸ƒç­‰ç­–ç•¥</li><li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»å’Œå‘Šè­¦æœºåˆ¶</li><li><strong>æ—¥å¿—èšåˆ</strong>ï¼šé›†ä¸­å¼æ—¥å¿—æ”¶é›†å’Œåˆ†æ</li><li><strong>å®¹é‡è§„åˆ’</strong>ï¼šåŸºäºç›‘æ§æ•°æ®è¿›è¡Œå®¹é‡è§„åˆ’</li></ul><h3 id=æœªæ¥å‘å±•è¶‹åŠ¿>æœªæ¥å‘å±•è¶‹åŠ¿</h3><h4 id=1-äº‘åŸç”Ÿé›†æˆ>1. <strong>äº‘åŸç”Ÿé›†æˆ</strong></h4><p>éšç€ Kubernetes å’Œ Service Mesh æŠ€æœ¯çš„æ™®åŠï¼ŒGo Micro å°†è¿›ä¸€æ­¥ä¸äº‘åŸç”Ÿç”Ÿæ€æ·±åº¦é›†æˆï¼Œæä¾›æ›´å¥½çš„å®¹å™¨åŒ–å’ŒæœåŠ¡ç½‘æ ¼æ”¯æŒã€‚</p><h4 id=2-aiml-æ”¯æŒ>2. <strong>AI/ML æ”¯æŒ</strong></h4><p>é›†æˆæœºå™¨å­¦ä¹ æ¨¡å‹æœåŠ¡åŒ–èƒ½åŠ›ï¼Œæ”¯æŒæ¨¡å‹çš„éƒ¨ç½²ã€ç‰ˆæœ¬ç®¡ç†ã€A/B æµ‹è¯•ç­‰åŠŸèƒ½ã€‚</p><h4 id=3-å®‰å…¨å¢å¼º>3. <strong>å®‰å…¨å¢å¼º</strong></h4><p>å¢å¼ºé›¶ä¿¡ä»»å®‰å…¨æ¨¡å‹ï¼Œæ”¯æŒæ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€æœåŠ¡é—´åŠ å¯†é€šä¿¡ã€å®‰å…¨å®¡è®¡ç­‰åŠŸèƒ½ã€‚</p><h4 id=4-å¤šè¿è¡Œæ—¶æ”¯æŒ>4. <strong>å¤šè¿è¡Œæ—¶æ”¯æŒ</strong></h4><p>é™¤äº† Go è¯­è¨€å¤–ï¼Œæ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€å’Œè¿è¡Œæ—¶ç¯å¢ƒï¼Œè®©å¤šè¯­è¨€å¾®æœåŠ¡æ¶æ„æ›´åŠ ä¾¿æ·ã€‚</p><h3 id=å­¦ä¹ è·¯å¾„å»ºè®®>å­¦ä¹ è·¯å¾„å»ºè®®</h3><h4 id=1-å…¥é—¨é˜¶æ®µ>1. <strong>å…¥é—¨é˜¶æ®µ</strong></h4><ul><li>å­¦ä¹  Go è¯­è¨€åŸºç¡€</li><li>ç†è§£å¾®æœåŠ¡æ¶æ„æ¦‚å¿µ</li><li>è¿è¡Œå®˜æ–¹ç¤ºä¾‹é¡¹ç›®</li><li>æŒæ¡åŸºæœ¬çš„æœåŠ¡å¼€å‘æµç¨‹</li></ul><h4 id=2-è¿›é˜¶é˜¶æ®µ>2. <strong>è¿›é˜¶é˜¶æ®µ</strong></h4><ul><li>æ·±å…¥å­¦ä¹ å„ä¸ªç»„ä»¶çš„å®ç°åŸç†</li><li>å®è·µæ’ä»¶å¼€å‘</li><li>æŒæ¡æœåŠ¡æ²»ç†å’Œè¿ç»´æŠ€èƒ½</li><li>å­¦ä¹ æ€§èƒ½ä¼˜åŒ–å’Œæ•…éšœæ’æŸ¥</li></ul><h4 id=3-ä¸“å®¶é˜¶æ®µ>3. <strong>ä¸“å®¶é˜¶æ®µ</strong></h4><ul><li>å‚ä¸ç¤¾åŒºè´¡çŒ®</li><li>è®¾è®¡å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿ</li><li>è§£å†³å¤æ‚çš„ä¸šåŠ¡åœºæ™¯</li><li>æ¨å¹¿æœ€ä½³å®è·µç»éªŒ</li></ul><h3 id=ç»“è¯­>ç»“è¯­</h3><p>Go Micro ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ›´æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘çš„æ€ç»´æ–¹å¼å’Œå·¥ç¨‹å®è·µã€‚å®ƒé€šè¿‡æä¾›ä¸€æ•´å¥—å®Œæ•´çš„å·¥å…·é“¾å’Œæœ€ä½³å®è·µï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿæ„å»ºå‡ºé«˜è´¨é‡ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚</p><p>åœ¨è¿™ä¸ªå¾®æœåŠ¡æ¶æ„æ—¥ç›Šé‡è¦çš„æ—¶ä»£ï¼ŒæŒæ¡ Go Micro ä¸ä»…èƒ½å¤Ÿæå‡ä¸ªäººçš„æŠ€æœ¯èƒ½åŠ›ï¼Œæ›´èƒ½ä¸ºå›¢é˜Ÿå’Œé¡¹ç›®å¸¦æ¥å®å®åœ¨åœ¨çš„ä»·å€¼ã€‚å¸Œæœ›é€šè¿‡è¿™ç¯‡æ·±å…¥çš„ä»‹ç»ï¼Œèƒ½å¤Ÿå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨ Go Microï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘çš„é“è·¯ä¸Šèµ°å¾—æ›´è¿œã€‚</p><p><strong>å¼€å§‹ä½ çš„ Go Micro ä¹‹æ—…ï¼š</strong></p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£… Go Micro</span>
</span></span><span style=display:flex><span>go install github.com/go-micro/go-micro/v4/cmd/micro@latest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åˆ›å»ºç¬¬ä¸€ä¸ªæœåŠ¡</span>
</span></span><span style=display:flex><span>micro new helloworld
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>cd helloworld <span style=color:#f92672>&amp;&amp;</span> go run main.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># è°ƒç”¨æœåŠ¡</span>
</span></span><span style=display:flex><span>micro call helloworld Helloworld.Call <span style=color:#e6db74>&#39;{&#34;name&#34;: &#34;World&#34;}&#39;</span></span></span></code></pre></div></div><p>è®©æˆ‘ä»¬ä¸€èµ·åœ¨ Go Micro çš„ä¸–ç•Œé‡Œï¼Œæ„å»ºæ›´ç¾å¥½çš„åˆ†å¸ƒå¼æœªæ¥ï¼</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>yesplease</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2023-09-15</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=http://localhost:1313/tags/go/>go</a>
<a href=http://localhost:1313/tags/micro/>micro</a>
<a href=http://localhost:1313/tags/go-micro/>go-micro</a></div><nav class=post-nav><a class=prev href=/post/micro/series-micro-2/><i class=iconfont><svg aria-hidden="true" class="lucide lucide-chevron-left hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="m15 18-6-6 6-6"/></svg>
</i><span class="prev-text nav-default">Go-micro advance, how to play?</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/post/devops/series-git-2/><span class="next-text nav-default">git ä»¥å‰çš„è®¸å¤šcommitä¸­æŸä¸ªæ–‡ä»¶å«æœ‰å¯†é’¥ï¼Œæ€ä¹ˆåŠï¼Ÿ</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg aria-hidden="true" class="lucide lucide-chevron-right hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"/></svg></i></a></nav></footer></article></div><aside class=right-sidebar></aside></div></main><footer id=footer class=site-footer><div class=social-icon-links><a href=mailto:cugbtang@sina.com rel="me noopener" class=social-icon-link title=email><svg aria-hidden="true" class="icon hi-svg-inline" fill="currentColor" height="1em" viewBox="0 0 1451 1024" width="1em" xlink="http://www.w3.org/1999/xlink"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a><a href=https://github.com/cugbtang rel="me noopener" class=social-icon-link title=github target=_blank><svg aria-hidden="true" class="icon hi-svg-inline" fill="currentColor" height="1em" viewBox="0 0 1024 1024" width="1em" xlink="http://www.w3.org/1999/xlink"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a><a href=http://localhost:1313/index.xml rel="noopener alternate" type=application/rss+xml class=social-icon-link title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span><span class=copyright-year>&copy;
2017 -
2025
<span class=heart><i class=iconfont><svg aria-hidden="true" class="lucide lucide-heart hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5.0 0016.5 3c-1.76.0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5.0 002 8.5c0 2.3 1.5 4.05 3 5.5l7 7z"/></svg>
</i></span><span class=author>yesplease</span></span></div></footer><script type=text/javascript src=/js/main.002d1a80e7bd914cb4592a8c6486c23920f3d9827531bd1c79b3b5716dcf0bd5.js integrity="sha256-AC0agOe9kUy0WSqMZIbCOSDz2YJ1Mb0cebO1cW3PC9U=" crossorigin=anonymous></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script></body></html>