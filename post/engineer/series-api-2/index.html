<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage data-theme=light><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>micro, how to play api? - ✌yesplease's blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=color-scheme content="light dark"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=generator content="Hugo 0.152.2"><link rel=canonical href=http://localhost:1313/post/engineer/series-api-2/><meta name=author content="yesplease"><meta name=description content="API工程化：基于Proto的IDL管理和文档生成 在现代软件开发中，API工程化变得愈发重要。使用Proto作为接口定义语言（IDL），可以帮助团队更好地管理API和生成相关文档。本文将介绍一种基于Proto的IDL管理方式以及如何生成API文档。
"><meta name=keywords content="api,IDL"><meta property="og:url" content="http://localhost:1313/post/engineer/series-api-2/"><meta property="og:site_name" content="✌yesplease's blog"><meta property="og:title" content="micro, how to play api?"><meta property="og:description" content="API工程化：基于Proto的IDL管理和文档生成 在现代软件开发中，API工程化变得愈发重要。使用Proto作为接口定义语言（IDL），可以帮助团队更好地管理API和生成相关文档。本文将介绍一种基于Proto的IDL管理方式以及如何生成API文档。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-11-29T15:44:23+08:00"><meta property="article:modified_time" content="2023-11-29T16:44:23+08:00"><meta property="article:tag" content="Api"><meta property="article:tag" content="IDL"><meta itemprop=name content="micro, how to play api?"><meta itemprop=description content="API工程化：基于Proto的IDL管理和文档生成 在现代软件开发中，API工程化变得愈发重要。使用Proto作为接口定义语言（IDL），可以帮助团队更好地管理API和生成相关文档。本文将介绍一种基于Proto的IDL管理方式以及如何生成API文档。"><meta itemprop=datePublished content="2023-11-29T15:44:23+08:00"><meta itemprop=dateModified content="2023-11-29T16:44:23+08:00"><meta itemprop=wordCount content="1827"><meta itemprop=keywords content="Api,IDL"><meta name=twitter:card content="summary"><meta name=twitter:title content="micro, how to play api?"><meta name=twitter:description content="API工程化：基于Proto的IDL管理和文档生成 在现代软件开发中，API工程化变得愈发重要。使用Proto作为接口定义语言（IDL），可以帮助团队更好地管理API和生成相关文档。本文将介绍一种基于Proto的IDL管理方式以及如何生成API文档。"><link rel=icon href=/favicon.ico><link rel=stylesheet href=/css/style.min.a0ae63bb9404f735c1a2045deae9e97f06e10118e5ad7befa80df30c5cd7fabc.css integrity="sha256-oK5ju5QE9zXBogRd6unpfwbhARjlrXvvqA3zDFzX+rw=" media=screen crossorigin=anonymous><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script>(function(){var e=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",e)})()</script></head><body><div id=back-to-top></div><header class=site-header><div class=desktop-header><div class=desktop-header-logo><a href=/ class=logo>✌yesplease</a></div><nav class=desktop-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=http://localhost:1313/>This is Home</a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/about/>About</a></li><li class=menu-item><a class="theme-toggle menu-item-link" href=javascript:void(0);><svg aria-hidden="true" class="lucide lucide-sun hi-svg-inline theme-icon-light" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
<svg aria-hidden="true" class="lucide lucide-moon hi-svg-inline theme-icon-dark" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></a></li><li class=menu-item><a class=menu-item-link href=http://localhost:1313/index.xml rel="noopener alternate" type=application/rss+xml title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline icon--rss" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></li></ul></nav></div><div class=mobile-header><div id=mobile-navbar class=mobile-navbar><div id=mobile-navbar-icon class=mobile-navbar-icon><svg aria-hidden="true" class="lucide lucide-menu hi-svg-inline icon--menu" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg></div><div class=mobile-navbar-logo><a href=/ class=logo>✌yesplease</a></div></div><div id=mobile-menu-close-modal class=mobile-menu-close-modal></div><nav id=mobile-menu class=mobile-menu><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/>This is Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/post/>Archives</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/about/>About</a></li><li class=mobile-menu-item><a class="theme-toggle menu-item-link" href=javascript:void(0);><svg aria-hidden="true" class="lucide lucide-sun hi-svg-inline theme-icon-light" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
<svg aria-hidden="true" class="lucide lucide-moon hi-svg-inline theme-icon-dark" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M12 3a6 6 0 009 9 9 9 0 11-9-9z"/></svg></a></li><li class=mobile-menu-item><a class=menu-item-link href=http://localhost:1313/index.xml rel="noopener alternate" type=application/rss+xml title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline icon--rss" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></li></ul></nav></div></header><main id=main class="main pico container"><div class=content-wrapper><aside class=left-sidebar><nav class=toc id=toc><div class=toc-title>Table of Contents</div><div class="toc-content custom-scrollbar"><nav id=TableOfContents><ul><li><a href=#proto的管理方式>Proto的管理方式</a></li><li><a href=#idl项目结构>IDL项目结构</a></li><li><a href=#idl错误处理>IDL错误处理</a></li><li><a href=#idl文档生成>IDL文档生成</a></li><li><a href=#参考>参考</a></li></ul></nav></div></nav></aside><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>micro, how to play api?</h1><div class=post-meta-list><div class="post-meta-item post-meta-author"><svg aria-hidden="true" class="lucide lucide-user-round-pen hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M2 21a8 8 0 0110.821-7.487"/><path d="M21.378 16.626a1 1 0 00-3.004-3.004l-4.01 4.012a2 2 0 00-.506.854l-.837 2.87a.5.5.0 00.62.62l2.87-.837a2 2 0 00.854-.506z"/><circle cx="10" cy="8" r="5"/></svg>
<a href=/about><span class=post-meta-author-name>yesplease</span></a></div><div class="post-meta-item post-meta-time"><svg aria-hidden="true" class="lucide lucide-calendar-days hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
<time datetime=2023-11-29>2023-11-29</time></div><div class=post-meta__right><div class="post-meta-item post-meta-category"><a href=http://localhost:1313/categories/api/>api</a></div></div></div></header><div class=post-content><h1 id=api工程化基于proto的idl管理和文档生成>API工程化：基于Proto的IDL管理和文档生成</h1><p>在现代软件开发中，API工程化变得愈发重要。使用Proto作为接口定义语言（IDL），可以帮助团队更好地管理API和生成相关文档。本文将介绍一种基于Proto的IDL管理方式以及如何生成API文档。</p><h2 id=proto的管理方式>Proto的管理方式</h2><p>在管理Proto文件时，可以采用多种方式，包括代码仓库、独立仓库、集中仓库和镜像仓库。其中，集中仓库的方式被提倡，有以下优点：</p><ul><li>方便跨部门协作：将所有Proto文件放在同一个仓库中，可以方便不同团队之间的协作。</li><li>版本管理：使用git对Proto文件进行版本控制，确保修改和变更可追溯。</li><li>规范化检查：使用API lint工具对Proto文件进行规范化检查，确保符合规范和最佳实践。</li><li>API设计评审：通过提交变更的diff，进行API设计评审，提高代码质量和设计性能。</li><li>权限管理：通过设定目录的OWNERS文件，对不同团队或个人设置读写权限，保护API的安全性。</li></ul><p>另外，可以使用Proto的git submodule方式，将Proto文件作为仓库的子模块进行管理。这种方式可以实现以下功能：</p><ul><li>将Proto文件作为代码仓库的一部分，保持其作为源数据的唯一性。</li><li>使用本地构建工具protoc依赖go module下的相对路径，方便在不同项目中引用Proto文件。</li><li>基于分支创建新的Proto文件，通过切换子模块分支生成相关代码，确保各个版本之间的兼容性。</li><li>维护Makefile来处理Proto文件的编译和构建工作，统一化处理流程。</li><li>使用声明式依赖方式，在yaml文件中指定protoc版本和Proto文件的依赖关系。</li></ul><h2 id=idl项目结构>IDL项目结构</h2><p>良好的IDL项目结构能够提高团队协作和代码维护的效率。建议将目录结构和package对齐，以便更好地组织和管理Proto文件以及生成的代码。</p><p>典型的IDL项目结构如下：</p><div class=highlight-container><button class="copy-code-btn outline">Copy</button><pre tabindex=0><code>├── api/
│   ├── user/
│   │   └── user.proto
│   ├── order/
│   │   └── order.proto
│   └── common/
│       └── common.proto
├── pkg/
│   ├── user/
│   │   └── user.go
│   ├── order/
│   │   └── order.go
│   └── common/
│       └── common.go</code></pre></div><p>在这个结构中，<code>api/</code>目录存放所有的Proto文件，按照业务功能划分为子目录。<code>pkg/</code>目录存放生成的代码，与<code>api/</code>目录一一对应。通过这种结构，可以清晰地区分Proto文件和生成的代码，便于团队进行开发和维护。</p><h2 id=idl错误处理>IDL错误处理</h2><p>在编写API时，处理错误是非常重要的一部分。为了使不同的API、协议和错误上下文之间保持一致的体验，建议使用简单的协议无关错误模型。具体做法包括：</p><ul><li>使用一小组标准错误，覆盖大量资源。</li><li>合理传播错误：如果你的API服务依赖其他服务，不应该盲目地将这些服务的错误传播给客户端。推荐的做法包括：<ul><li>隐藏实现详细信息和机密信息，避免暴露敏感数据。</li><li>根据错误责任方调整错误处理，对于感兴趣的翻译错误提供有意义的信息，对于不感兴趣的错误提供通用的"Unknown"错误提示。</li></ul></li></ul><p>通过以上方式，可以统一错误处理的规范，并提供更好的错误信息给客户端，提高用户体验和调试效率。</p><h2 id=idl文档生成>IDL文档生成</h2><p>为了方便使用和理解API，生成API文档是必不可少的。可以使用基于OpenAPI插件和Proto注释的方式生成文档，具体步骤如下：</p><ul><li>在Proto文件中添加注释，描述每个接口的用途、参数和返回值等信息。</li><li>使用OpenAPI插件，解析Proto文件和注释，生成OpenAPI规范的yaml文件。</li><li>在项目的Makefile中添加生成API文档的脚本，执行<code>make api</code>命令即可生成对应的OpenAPI文档。</li><li>可以通过GitLab或VS Code插件直接查看和编辑生成的OpenAPI文档，方便团队进行微服务治理、调试和测试等工作。</li></ul><p>通过以上方式，团队可以轻松生成和维护API文档，提高开发效率和团队协作能力。</p><p>本文介绍了基于Proto的IDL管理和文档生成的方法，包括Proto的管理方式、IDL项目结构、错误处理和文档生成等内容。通过合理规划和使用这些方法，可以提高API工程化水平，推动团队的协作和开发效率。</p><p>总结：</p><p>在API工程化中，Proto的管理方式、IDL项目结构、错误处理和文档生成是非常重要的一部分。通过集中管理Proto文件、规范项目结构、统一错误处理和生成易于理解的API文档，可以提高团队的开发效率和 API的质量。同时，不断优化和改进这些方法，可以实现持续集成和交付，适应快速迭代的开发环境。希望本文对您有所启发，让您的API工程化之路更加顺利！</p><h2 id=参考>参考</h2><ul><li><a href="https://www.bilibili.com/video/BV17m4y1f7qc/?spm_id_from=333.880.my_history.page.click&amp;vd_source=9573f6b9b39a65fed99157eefcfdfb74">API工程化分享 - 毛剑</a></li><li><a href=https://github.com/go-kratos/kratos>https://github.com/go-kratos/kratos</a></li><li><a href=https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto#L112>https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto#L112</a></li><li><a href=https://github.com/pkg/errors>https://github.com/pkg/errors</a></li><li><a href=https://mp.weixin.qq.com/s/cBXZjg_R8MLFDJyFtpjVVQ>https://mp.weixin.qq.com/s/cBXZjg_R8MLFDJyFtpjVVQ</a></li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>yesplease</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2023-11-29</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=http://localhost:1313/tags/api/>api</a>
<a href=http://localhost:1313/tags/idl/>IDL</a></div><nav class=post-nav><a class=prev href=/post/micro/series-micro-3/><i class=iconfont><svg aria-hidden="true" class="lucide lucide-chevron-left hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="m15 18-6-6 6-6"/></svg>
</i><span class="prev-text nav-default">micro quick, how to play?</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/post/engineer/series-api-0/><span class="next-text nav-default">micro, how to play engineer?</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg aria-hidden="true" class="lucide lucide-chevron-right hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="m9 18 6-6-6-6"/></svg></i></a></nav></footer></article></div><aside class=right-sidebar></aside></div></main><footer id=footer class=site-footer><div class=social-icon-links><a href=mailto:cugbtang@sina.com rel="me noopener" class=social-icon-link title=email><svg aria-hidden="true" class="icon hi-svg-inline" fill="currentColor" height="1em" viewBox="0 0 1451 1024" width="1em" xlink="http://www.w3.org/1999/xlink"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a><a href=https://github.com/cugbtang rel="me noopener" class=social-icon-link title=github target=_blank><svg aria-hidden="true" class="icon hi-svg-inline" fill="currentColor" height="1em" viewBox="0 0 1024 1024" width="1em" xlink="http://www.w3.org/1999/xlink"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a><a href=http://localhost:1313/index.xml rel="noopener alternate" type=application/rss+xml class=social-icon-link title=rss target=_blank><svg aria-hidden="true" class="lucide lucide-rss hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span><span class=copyright-year>&copy;
2017 -
2025
<span class=heart><i class=iconfont><svg aria-hidden="true" class="lucide lucide-heart hi-svg-inline" fill="none" height="1em" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="1em"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5.0 0016.5 3c-1.76.0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5.0 002 8.5c0 2.3 1.5 4.05 3 5.5l7 7z"/></svg>
</i></span><span class=author>yesplease</span></span></div></footer><script type=text/javascript src=/js/main.002d1a80e7bd914cb4592a8c6486c23920f3d9827531bd1c79b3b5716dcf0bd5.js integrity="sha256-AC0agOe9kUy0WSqMZIbCOSDz2YJ1Mb0cebO1cW3PC9U=" crossorigin=anonymous></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script></body></html>